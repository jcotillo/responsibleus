//     Underscore.js 1.6.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,g=e.filter,d=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,w=Object.keys,_=i.bind,j=function(n){return n instanceof j?n:this instanceof j?void(this._wrapped=n):new j(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):n._=j,j.VERSION="1.6.0";var A=j.each=j.forEach=function(n,t,e){if(null==n)return n;if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a=j.keys(n),u=0,i=a.length;i>u;u++)if(t.call(e,n[a[u]],a[u],n)===r)return;return n};j.map=j.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e.push(t.call(r,n,u,i))}),e)};var O="Reduce of empty array with no initial value";j.reduce=j.foldl=j.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=j.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},j.reduceRight=j.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=j.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=j.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},j.find=j.detect=function(n,t,r){var e;return k(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},j.filter=j.select=function(n,t,r){var e=[];return null==n?e:g&&n.filter===g?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&e.push(n)}),e)},j.reject=function(n,t,r){return j.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},j.every=j.all=function(n,t,e){t||(t=j.identity);var u=!0;return null==n?u:d&&n.every===d?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var k=j.some=j.any=function(n,t,e){t||(t=j.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};j.contains=j.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:k(n,function(n){return n===t})},j.invoke=function(n,t){var r=o.call(arguments,2),e=j.isFunction(t);return j.map(n,function(n){return(e?t:n[t]).apply(n,r)})},j.pluck=function(n,t){return j.map(n,j.property(t))},j.where=function(n,t){return j.filter(n,j.matches(t))},j.findWhere=function(n,t){return j.find(n,j.matches(t))},j.max=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);var e=-1/0,u=-1/0;return A(n,function(n,i,a){var o=t?t.call(r,n,i,a):n;o>u&&(e=n,u=o)}),e},j.min=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);var e=1/0,u=1/0;return A(n,function(n,i,a){var o=t?t.call(r,n,i,a):n;u>o&&(e=n,u=o)}),e},j.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=j.random(r++),e[r-1]=e[t],e[t]=n}),e},j.sample=function(n,t,r){return null==t||r?(n.length!==+n.length&&(n=j.values(n)),n[j.random(n.length-1)]):j.shuffle(n).slice(0,Math.max(0,t))};var E=function(n){return null==n?j.identity:j.isFunction(n)?n:j.property(n)};j.sortBy=function(n,t,r){return t=E(t),j.pluck(j.map(n,function(n,e,u){return{value:n,index:e,criteria:t.call(r,n,e,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={};return r=E(r),A(t,function(i,a){var o=r.call(e,i,a,t);n(u,o,i)}),u}};j.groupBy=F(function(n,t,r){j.has(n,t)?n[t].push(r):n[t]=[r]}),j.indexBy=F(function(n,t,r){n[t]=r}),j.countBy=F(function(n,t){j.has(n,t)?n[t]++:n[t]=1}),j.sortedIndex=function(n,t,r,e){r=E(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;r.call(e,n[o])<u?i=o+1:a=o}return i},j.toArray=function(n){return n?j.isArray(n)?o.call(n):n.length===+n.length?j.map(n,j.identity):j.values(n):[]},j.size=function(n){return null==n?0:n.length===+n.length?n.length:j.keys(n).length},j.first=j.head=j.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:0>t?[]:o.call(n,0,t)},j.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},j.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},j.rest=j.tail=j.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},j.compact=function(n){return j.filter(n,j.identity)};var M=function(n,t,r){return t&&j.every(n,j.isArray)?c.apply(r,n):(A(n,function(n){j.isArray(n)||j.isArguments(n)?t?a.apply(r,n):M(n,t,r):r.push(n)}),r)};j.flatten=function(n,t){return M(n,t,[])},j.without=function(n){return j.difference(n,o.call(arguments,1))},j.partition=function(n,t){var r=[],e=[];return A(n,function(n){(t(n)?r:e).push(n)}),[r,e]},j.uniq=j.unique=function(n,t,r,e){j.isFunction(t)&&(e=r,r=t,t=!1);var u=r?j.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:j.contains(a,r))||(a.push(r),i.push(n[e]))}),i},j.union=function(){return j.uniq(j.flatten(arguments,!0))},j.intersection=function(n){var t=o.call(arguments,1);return j.filter(j.uniq(n),function(n){return j.every(t,function(t){return j.contains(t,n)})})},j.difference=function(n){var t=c.apply(e,o.call(arguments,1));return j.filter(n,function(n){return!j.contains(t,n)})},j.zip=function(){for(var n=j.max(j.pluck(arguments,"length").concat(0)),t=new Array(n),r=0;n>r;r++)t[r]=j.pluck(arguments,""+r);return t},j.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},j.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=j.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},j.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},j.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=new Array(e);e>u;)i[u++]=n,n+=r;return i};var R=function(){};j.bind=function(n,t){var r,e;if(_&&n.bind===_)return _.apply(n,o.call(arguments,1));if(!j.isFunction(n))throw new TypeError;return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));R.prototype=n.prototype;var u=new R;R.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return Object(i)===i?i:u}},j.partial=function(n){var t=o.call(arguments,1);return function(){for(var r=0,e=t.slice(),u=0,i=e.length;i>u;u++)e[u]===j&&(e[u]=arguments[r++]);for(;r<arguments.length;)e.push(arguments[r++]);return n.apply(this,e)}},j.bindAll=function(n){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){n[t]=j.bind(n[t],n)}),n},j.memoize=function(n,t){var r={};return t||(t=j.identity),function(){var e=t.apply(this,arguments);return j.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},j.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},j.defer=function(n){return j.delay.apply(j,[n,1].concat(o.call(arguments,1)))},j.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var c=function(){o=r.leading===!1?0:j.now(),a=null,i=n.apply(e,u),e=u=null};return function(){var l=j.now();o||r.leading!==!1||(o=l);var f=t-(l-o);return e=this,u=arguments,0>=f?(clearTimeout(a),a=null,o=l,i=n.apply(e,u),e=u=null):a||r.trailing===!1||(a=setTimeout(c,f)),i}},j.debounce=function(n,t,r){var e,u,i,a,o,c=function(){var l=j.now()-a;t>l?e=setTimeout(c,t-l):(e=null,r||(o=n.apply(i,u),i=u=null))};return function(){i=this,u=arguments,a=j.now();var l=r&&!e;return e||(e=setTimeout(c,t)),l&&(o=n.apply(i,u),i=u=null),o}},j.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},j.wrap=function(n,t){return j.partial(t,n)},j.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},j.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},j.keys=function(n){if(!j.isObject(n))return[];if(w)return w(n);var t=[];for(var r in n)j.has(n,r)&&t.push(r);return t},j.values=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},j.pairs=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},j.invert=function(n){for(var t={},r=j.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},j.functions=j.methods=function(n){var t=[];for(var r in n)j.isFunction(n[r])&&t.push(r);return t.sort()},j.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},j.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},j.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)j.contains(r,u)||(t[u]=n[u]);return t},j.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]===void 0&&(n[r]=t[r])}),n},j.clone=function(n){return j.isObject(n)?j.isArray(n)?n.slice():j.extend({},n):n},j.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof j&&(n=n._wrapped),t instanceof j&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==String(t);case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;var a=n.constructor,o=t.constructor;if(a!==o&&!(j.isFunction(a)&&a instanceof a&&j.isFunction(o)&&o instanceof o)&&"constructor"in n&&"constructor"in t)return!1;r.push(n),e.push(t);var c=0,f=!0;if("[object Array]"==u){if(c=n.length,f=c==t.length)for(;c--&&(f=S(n[c],t[c],r,e)););}else{for(var s in n)if(j.has(n,s)&&(c++,!(f=j.has(t,s)&&S(n[s],t[s],r,e))))break;if(f){for(s in t)if(j.has(t,s)&&!c--)break;f=!c}}return r.pop(),e.pop(),f};j.isEqual=function(n,t){return S(n,t,[],[])},j.isEmpty=function(n){if(null==n)return!0;if(j.isArray(n)||j.isString(n))return 0===n.length;for(var t in n)if(j.has(n,t))return!1;return!0},j.isElement=function(n){return!(!n||1!==n.nodeType)},j.isArray=x||function(n){return"[object Array]"==l.call(n)},j.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){j["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),j.isArguments(arguments)||(j.isArguments=function(n){return!(!n||!j.has(n,"callee"))}),"function"!=typeof/./&&(j.isFunction=function(n){return"function"==typeof n}),j.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},j.isNaN=function(n){return j.isNumber(n)&&n!=+n},j.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},j.isNull=function(n){return null===n},j.isUndefined=function(n){return n===void 0},j.has=function(n,t){return f.call(n,t)},j.noConflict=function(){return n._=t,this},j.identity=function(n){return n},j.constant=function(n){return function(){return n}},j.property=function(n){return function(t){return t[n]}},j.matches=function(n){return function(t){if(t===n)return!0;for(var r in n)if(n[r]!==t[r])return!1;return!0}},j.times=function(n,t,r){for(var e=Array(Math.max(0,n)),u=0;n>u;u++)e[u]=t.call(r,u);return e},j.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},j.now=Date.now||function(){return(new Date).getTime()};var T={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};T.unescape=j.invert(T.escape);var I={escape:new RegExp("["+j.keys(T.escape).join("")+"]","g"),unescape:new RegExp("("+j.keys(T.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(n){j[n]=function(t){return null==t?"":(""+t).replace(I[n],function(t){return T[n][t]})}}),j.result=function(n,t){if(null==n)return void 0;var r=n[t];return j.isFunction(r)?r.call(n):r},j.mixin=function(n){A(j.functions(n),function(t){var r=j[t]=n[t];j.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(j,n))}})};var N=0;j.uniqueId=function(n){var t=++N+"";return n?n+t:t},j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(n,t,r){var e;r=j.defaults({},r,j.templateSettings);var u=new RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(D,function(n){return"\\"+B[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=new Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,j);var c=function(n){return e.call(this,n,j)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},j.chain=function(n){return j(n).chain()};var z=function(n){return this._chain?j(n).chain():n};j.mixin(j),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];j.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];j.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return j})}).call(this);
(function(){var t=this;var e=t.Backbone;var i=[];var r=i.push;var s=i.slice;var n=i.splice;var a;if(typeof exports!=="undefined"){a=exports}else{a=t.Backbone={}}a.VERSION="1.0.0";var h=t._;if(!h&&typeof require!=="undefined")h=require("underscore");a.$=t.jQuery||t.Zepto||t.ender||t.$;a.noConflict=function(){t.Backbone=e;return this};a.emulateHTTP=false;a.emulateJSON=false;var o=a.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);r.push({callback:e,context:i,ctx:i||this});return this},once:function(t,e,i){if(!l(this,"once",t,[e,i])||!e)return this;var r=this;var s=h.once(function(){r.off(t,s);e.apply(this,arguments)});s._callback=e;return this.on(t,s,i)},off:function(t,e,i){var r,s,n,a,o,u,c,f;if(!this._events||!l(this,"off",t,[e,i]))return this;if(!t&&!e&&!i){this._events={};return this}a=t?[t]:h.keys(this._events);for(o=0,u=a.length;o<u;o++){t=a[o];if(n=this._events[t]){this._events[t]=r=[];if(e||i){for(c=0,f=n.length;c<f;c++){s=n[c];if(e&&e!==s.callback&&e!==s.callback._callback||i&&i!==s.context){r.push(s)}}}if(!r.length)delete this._events[t]}}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t];var r=this._events.all;if(i)c(i,e);if(r)c(r,arguments);return this},stopListening:function(t,e,i){var r=this._listeners;if(!r)return this;var s=!e&&!i;if(typeof e==="object")i=this;if(t)(r={})[t._listenerId]=t;for(var n in r){r[n].off(e,i,this);if(s)delete this._listeners[n]}return this}};var u=/\s+/;var l=function(t,e,i,r){if(!i)return true;if(typeof i==="object"){for(var s in i){t[e].apply(t,[s,i[s]].concat(r))}return false}if(u.test(i)){var n=i.split(u);for(var a=0,h=n.length;a<h;a++){t[e].apply(t,[n[a]].concat(r))}return false}return true};var c=function(t,e){var i,r=-1,s=t.length,n=e[0],a=e[1],h=e[2];switch(e.length){case 0:while(++r<s)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<s)(i=t[r]).callback.call(i.ctx,n);return;case 2:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a);return;case 3:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a,h);return;default:while(++r<s)(i=t[r]).callback.apply(i.ctx,e)}};var f={listenTo:"on",listenToOnce:"once"};h.each(f,function(t,e){o[e]=function(e,i,r){var s=this._listeners||(this._listeners={});var n=e._listenerId||(e._listenerId=h.uniqueId("l"));s[n]=e;if(typeof i==="object")r=this;e[t](i,r,this);return this}});o.bind=o.on;o.unbind=o.off;h.extend(a,o);var d=a.Model=function(t,e){var i;var r=t||{};e||(e={});this.cid=h.uniqueId("c");this.attributes={};h.extend(this,h.pick(e,p));if(e.parse)r=this.parse(r,e)||{};if(i=h.result(this,"defaults")){r=h.defaults({},r,i)}this.set(r,e);this.changed={};this.initialize.apply(this,arguments)};var p=["url","urlRoot","collection"];h.extend(d.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return h.escape(this.get(t))},has:function(t){return this.get(t)!=null},set:function(t,e,i){var r,s,n,a,o,u,l,c;if(t==null)return this;if(typeof t==="object"){s=t;i=e}else{(s={})[t]=e}i||(i={});if(!this._validate(s,i))return false;n=i.unset;o=i.silent;a=[];u=this._changing;this._changing=true;if(!u){this._previousAttributes=h.clone(this.attributes);this.changed={}}c=this.attributes,l=this._previousAttributes;if(this.idAttribute in s)this.id=s[this.idAttribute];for(r in s){e=s[r];if(!h.isEqual(c[r],e))a.push(r);if(!h.isEqual(l[r],e)){this.changed[r]=e}else{delete this.changed[r]}n?delete c[r]:c[r]=e}if(!o){if(a.length)this._pending=true;for(var f=0,d=a.length;f<d;f++){this.trigger("change:"+a[f],this,c[a[f]],i)}}if(u)return this;if(!o){while(this._pending){this._pending=false;this.trigger("change",this,i)}}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,h.extend({},e,{unset:true}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,h.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!h.isEmpty(this.changed);return h.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?h.clone(this.changed):false;var e,i=false;var r=this._changing?this._previousAttributes:this.attributes;for(var s in t){if(h.isEqual(r[s],e=t[s]))continue;(i||(i={}))[s]=e}return i},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=this;var i=t.success;t.success=function(r){if(!e.set(e.parse(r,t),t))return false;if(i)i(e,r,t);e.trigger("sync",e,r,t)};R(this,t);return this.sync("read",this,t)},save:function(t,e,i){var r,s,n,a=this.attributes;if(t==null||typeof t==="object"){r=t;i=e}else{(r={})[t]=e}if(r&&(!i||!i.wait)&&!this.set(r,i))return false;i=h.extend({validate:true},i);if(!this._validate(r,i))return false;if(r&&i.wait){this.attributes=h.extend({},a,r)}if(i.parse===void 0)i.parse=true;var o=this;var u=i.success;i.success=function(t){o.attributes=a;var e=o.parse(t,i);if(i.wait)e=h.extend(r||{},e);if(h.isObject(e)&&!o.set(e,i)){return false}if(u)u(o,t,i);o.trigger("sync",o,t,i)};R(this,i);s=this.isNew()?"create":i.patch?"patch":"update";if(s==="patch")i.attrs=r;n=this.sync(s,this,i);if(r&&i.wait)this.attributes=a;return n},destroy:function(t){t=t?h.clone(t):{};var e=this;var i=t.success;var r=function(){e.trigger("destroy",e,e.collection,t)};t.success=function(s){if(t.wait||e.isNew())r();if(i)i(e,s,t);if(!e.isNew())e.trigger("sync",e,s,t)};if(this.isNew()){t.success();return false}R(this,t);var s=this.sync("delete",this,t);if(!t.wait)r();return s},url:function(){var t=h.result(this,"urlRoot")||h.result(this.collection,"url")||U();if(this.isNew())return t;return t+(t.charAt(t.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(t){return this._validate({},h.extend(t||{},{validate:true}))},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=h.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;if(!i)return true;this.trigger("invalid",this,i,h.extend(e||{},{validationError:i}));return false}});var v=["keys","values","pairs","invert","pick","omit"];h.each(v,function(t){d.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.attributes);return h[t].apply(h,e)}});var g=a.Collection=function(t,e){e||(e={});if(e.url)this.url=e.url;if(e.model)this.model=e.model;if(e.comparator!==void 0)this.comparator=e.comparator;this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,h.extend({silent:true},e))};var m={add:true,remove:true,merge:true};var y={add:true,merge:false,remove:false};h.extend(g.prototype,o,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return a.sync.apply(this,arguments)},add:function(t,e){return this.set(t,h.defaults(e||{},y))},remove:function(t,e){t=h.isArray(t)?t.slice():[t];e||(e={});var i,r,s,n;for(i=0,r=t.length;i<r;i++){n=this.get(t[i]);if(!n)continue;delete this._byId[n.id];delete this._byId[n.cid];s=this.indexOf(n);this.models.splice(s,1);this.length--;if(!e.silent){e.index=s;n.trigger("remove",n,this,e)}this._removeReference(n)}return this},set:function(t,e){e=h.defaults(e||{},m);if(e.parse)t=this.parse(t,e);if(!h.isArray(t))t=t?[t]:[];var i,s,a,o,u,l;var c=e.at;var f=this.comparator&&c==null&&e.sort!==false;var d=h.isString(this.comparator)?this.comparator:null;var p=[],v=[],g={};for(i=0,s=t.length;i<s;i++){if(!(a=this._prepareModel(t[i],e)))continue;if(u=this.get(a)){if(e.remove)g[u.cid]=true;if(e.merge){u.set(a.attributes,e);if(f&&!l&&u.hasChanged(d))l=true}}else if(e.add){p.push(a);a.on("all",this._onModelEvent,this);this._byId[a.cid]=a;if(a.id!=null)this._byId[a.id]=a}}if(e.remove){for(i=0,s=this.length;i<s;++i){if(!g[(a=this.models[i]).cid])v.push(a)}if(v.length)this.remove(v,e)}if(p.length){if(f)l=true;this.length+=p.length;if(c!=null){n.apply(this.models,[c,0].concat(p))}else{r.apply(this.models,p)}}if(l)this.sort({silent:true});if(e.silent)return this;for(i=0,s=p.length;i<s;i++){(a=p[i]).trigger("add",a,this,e)}if(l)this.trigger("sort",this,e);return this},reset:function(t,e){e||(e={});for(var i=0,r=this.models.length;i<r;i++){this._removeReference(this.models[i])}e.previousModels=this.models;this._reset();this.add(t,h.extend({silent:true},e));if(!e.silent)this.trigger("reset",this,e);return this},push:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:this.length},e));return t},pop:function(t){var e=this.at(this.length-1);this.remove(e,t);return e},unshift:function(t,e){t=this._prepareModel(t,e);this.add(t,h.extend({at:0},e));return t},shift:function(t){var e=this.at(0);this.remove(e,t);return e},slice:function(t,e){return this.models.slice(t,e)},get:function(t){if(t==null)return void 0;return this._byId[t.id!=null?t.id:t.cid||t]},at:function(t){return this.models[t]},where:function(t,e){if(h.isEmpty(t))return e?void 0:[];return this[e?"find":"filter"](function(e){for(var i in t){if(t[i]!==e.get(i))return false}return true})},findWhere:function(t){return this.where(t,true)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");t||(t={});if(h.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(h.bind(this.comparator,this))}if(!t.silent)this.trigger("sort",this,t);return this},sortedIndex:function(t,e,i){e||(e=this.comparator);var r=h.isFunction(e)?e:function(t){return t.get(e)};return h.sortedIndex(this.models,t,r,i)},pluck:function(t){return h.invoke(this.models,"get",t)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=t.success;var i=this;t.success=function(r){var s=t.reset?"reset":"set";i[s](r,t);if(e)e(i,r,t);i.trigger("sync",i,r,t)};R(this,t);return this.sync("read",this,t)},create:function(t,e){e=e?h.clone(e):{};if(!(t=this._prepareModel(t,e)))return false;if(!e.wait)this.add(t,e);var i=this;var r=e.success;e.success=function(s){if(e.wait)i.add(t,e);if(r)r(t,s,e)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(t,e){if(t instanceof d){if(!t.collection)t.collection=this;return t}e||(e={});e.collection=this;var i=new this.model(t,e);if(!i._validate(t,e)){this.trigger("invalid",this,t,e);return false}return i},_removeReference:function(t){if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,r);if(e&&t==="change:"+e.idAttribute){delete this._byId[e.previous(e.idAttribute)];if(e.id!=null)this._byId[e.id]=e}this.trigger.apply(this,arguments)}});var _=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(_,function(t){g.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.models);return h[t].apply(h,e)}});var w=["groupBy","countBy","sortBy"];h.each(w,function(t){g.prototype[t]=function(e,i){var r=h.isFunction(e)?e:function(t){return t.get(e)};return h[t](this.models,r,i)}});var b=a.View=function(t){this.cid=h.uniqueId("view");this._configure(t||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var x=/^(\S+)\s*(.*)$/;var E=["model","collection","el","id","attributes","className","tagName","events"];h.extend(b.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(t,e){if(this.$el)this.undelegateEvents();this.$el=t instanceof a.$?t:a.$(t);this.el=this.$el[0];if(e!==false)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=h.result(this,"events"))))return this;this.undelegateEvents();for(var e in t){var i=t[e];if(!h.isFunction(i))i=this[t[e]];if(!i)continue;var r=e.match(x);var s=r[1],n=r[2];i=h.bind(i,this);s+=".delegateEvents"+this.cid;if(n===""){this.$el.on(s,i)}else{this.$el.on(s,n,i)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(t){if(this.options)t=h.extend({},h.result(this,"options"),t);h.extend(this,h.pick(t,E));this.options=t},_ensureElement:function(){if(!this.el){var t=h.extend({},h.result(this,"attributes"));if(this.id)t.id=h.result(this,"id");if(this.className)t["class"]=h.result(this,"className");var e=a.$("<"+h.result(this,"tagName")+">").attr(t);this.setElement(e,false)}else{this.setElement(h.result(this,"el"),false)}}});a.sync=function(t,e,i){var r=k[t];h.defaults(i||(i={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var s={type:r,dataType:"json"};if(!i.url){s.url=h.result(e,"url")||U()}if(i.data==null&&e&&(t==="create"||t==="update"||t==="patch")){s.contentType="application/json";s.data=JSON.stringify(i.attrs||e.toJSON(i))}if(i.emulateJSON){s.contentType="application/x-www-form-urlencoded";s.data=s.data?{model:s.data}:{}}if(i.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){s.type="POST";if(i.emulateJSON)s.data._method=r;var n=i.beforeSend;i.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",r);if(n)return n.apply(this,arguments)}}if(s.type!=="GET"&&!i.emulateJSON){s.processData=false}if(s.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var o=i.xhr=a.ajax(h.extend(s,i));e.trigger("request",e,o,i);return o};var k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var S=a.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var $=/\((.*?)\)/g;var T=/(\(\?)?:\w+/g;var H=/\*\w+/g;var A=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(S.prototype,o,{initialize:function(){},route:function(t,e,i){if(!h.isRegExp(t))t=this._routeToRegExp(t);if(h.isFunction(e)){i=e;e=""}if(!i)i=this[e];var r=this;a.history.route(t,function(s){var n=r._extractParameters(t,s);i&&i.apply(r,n);r.trigger.apply(r,["route:"+e].concat(n));r.trigger("route",e,n);a.history.trigger("route",r,e,n)});return this},navigate:function(t,e){a.history.navigate(t,e);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=h.result(this,"routes");var t,e=h.keys(this.routes);while((t=e.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(A,"\\$&").replace($,"(?:$1)?").replace(T,function(t,e){return e?t:"([^/]+)"}).replace(H,"(.*?)");return new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return h.map(i,function(t){return t?decodeURIComponent(t):null})}});var I=a.History=function(){this.handlers=[];h.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var N=/^[#\/]|\s+$/g;var P=/^\/+|\/+$/g;var O=/msie [\w.]+/;var C=/\/$/;I.started=false;h.extend(I.prototype,o,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(t==null){if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(C,"");if(!t.indexOf(i))t=t.substr(i.length)}else{t=this.getHash()}}return t.replace(N,"")},start:function(t){if(I.started)throw new Error("Backbone.history has already been started");I.started=true;this.options=h.extend({},{root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var i=document.documentMode;var r=O.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(P,"/");if(r&&this._wantsHashChange){this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){a.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!r){a.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=e;var s=this.location;var n=s.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!n){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&n&&s.hash){this.fragment=this.getHash().replace(N,"");this.history.replaceState({},document.title,this.root+this.fragment+s.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);I.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getFragment(this.getHash(this.iframe))}if(e===this.fragment)return false;if(this.iframe)this.navigate(e);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(t){var e=this.fragment=this.getFragment(t);var i=h.any(this.handlers,function(t){if(t.route.test(e)){t.callback(e);return true}});return i},navigate:function(t,e){if(!I.started)return false;if(!e||e===true)e={trigger:e};t=this.getFragment(t||"");if(this.fragment===t)return;this.fragment=t;var i=this.root+t;if(this._hasPushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,i)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getFragment(this.getHash(this.iframe))){if(!e.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,t,e.replace)}}else{return this.location.assign(i)}if(e.trigger)this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else{t.hash="#"+e}}});a.history=new I;var j=function(t,e){var i=this;var r;if(t&&h.has(t,"constructor")){r=t.constructor}else{r=function(){return i.apply(this,arguments)}}h.extend(r,i,e);var s=function(){this.constructor=r};s.prototype=i.prototype;r.prototype=new s;if(t)h.extend(r.prototype,t);r.__super__=i.prototype;return r};d.extend=g.extend=S.extend=b.extend=I.extend=j;var U=function(){throw new Error('A "url" property or function must be specified')};var R=function(t,e){var i=e.error;e.error=function(r){if(i)i(t,r,e);t.trigger("error",t,r,e)}}}).call(this);
/*
//@ sourceMappingURL=backbone-min.map
*/
/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.8.1
*/
YAHOO.util.Attribute=function(B,A){if(A){this.owner=A;this.configure(B,true);}};YAHOO.util.Attribute.prototype={name:undefined,value:null,owner:null,readOnly:false,writeOnce:false,_initialConfig:null,_written:false,method:null,setter:null,getter:null,validator:null,getValue:function(){var A=this.value;if(this.getter){A=this.getter.call(this.owner,this.name,A);}return A;},setValue:function(F,B){var E,A=this.owner,C=this.name;var D={type:C,prevValue:this.getValue(),newValue:F};if(this.readOnly||(this.writeOnce&&this._written)){return false;}if(this.validator&&!this.validator.call(A,F)){return false;}if(!B){E=A.fireBeforeChangeEvent(D);if(E===false){return false;}}if(this.setter){F=this.setter.call(A,F,this.name);if(F===undefined){}}if(this.method){this.method.call(A,F,this.name);}this.value=F;this._written=true;D.type=C;if(!B){this.owner.fireChangeEvent(D);}return true;},configure:function(B,C){B=B||{};if(C){this._written=false;}this._initialConfig=this._initialConfig||{};for(var A in B){if(B.hasOwnProperty(A)){this[A]=B[A];if(C){this._initialConfig[A]=B[A];}}}},resetValue:function(){return this.setValue(this._initialConfig.value);},resetConfig:function(){this.configure(this._initialConfig,true);},refresh:function(A){this.setValue(this.value,A);}};(function(){var A=YAHOO.util.Lang;YAHOO.util.AttributeProvider=function(){};YAHOO.util.AttributeProvider.prototype={_configs:null,get:function(C){this._configs=this._configs||{};var B=this._configs[C];if(!B||!this._configs.hasOwnProperty(C)){return null;}return B.getValue();},set:function(D,E,B){this._configs=this._configs||{};var C=this._configs[D];if(!C){return false;}return C.setValue(E,B);},getAttributeKeys:function(){this._configs=this._configs;var C=[],B;for(B in this._configs){if(A.hasOwnProperty(this._configs,B)&&!A.isUndefined(this._configs[B])){C[C.length]=B;}}return C;},setAttributes:function(D,B){for(var C in D){if(A.hasOwnProperty(D,C)){this.set(C,D[C],B);}}},resetValue:function(C,B){this._configs=this._configs||{};if(this._configs[C]){this.set(C,this._configs[C]._initialConfig.value,B);return true;}return false;},refresh:function(E,C){this._configs=this._configs||{};var F=this._configs;E=((A.isString(E))?[E]:E)||this.getAttributeKeys();for(var D=0,B=E.length;D<B;++D){if(F.hasOwnProperty(E[D])){this._configs[E[D]].refresh(C);}}},register:function(B,C){this.setAttributeConfig(B,C);},getAttributeConfig:function(C){this._configs=this._configs||{};var B=this._configs[C]||{};var D={};for(C in B){if(A.hasOwnProperty(B,C)){D[C]=B[C];}}return D;},setAttributeConfig:function(B,C,D){this._configs=this._configs||{};C=C||{};if(!this._configs[B]){C.name=B;this._configs[B]=this.createAttribute(C);}else{this._configs[B].configure(C,D);}},configureAttribute:function(B,C,D){this.setAttributeConfig(B,C,D);},resetAttributeConfig:function(B){this._configs=this._configs||{};this._configs[B].resetConfig();},subscribe:function(B,C){this._events=this._events||{};if(!(B in this._events)){this._events[B]=this.createEvent(B);}YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments);},on:function(){this.subscribe.apply(this,arguments);},addListener:function(){this.subscribe.apply(this,arguments);},fireBeforeChangeEvent:function(C){var B="before";B+=C.type.charAt(0).toUpperCase()+C.type.substr(1)+"Change";C.type=B;return this.fireEvent(C.type,C);},fireChangeEvent:function(B){B.type+="Change";return this.fireEvent(B.type,B);},createAttribute:function(B){return new YAHOO.util.Attribute(B,this);}};YAHOO.augment(YAHOO.util.AttributeProvider,YAHOO.util.EventProvider);})();(function(){var B=YAHOO.util.Dom,D=YAHOO.util.AttributeProvider,C={mouseenter:true,mouseleave:true};var A=function(E,F){this.init.apply(this,arguments);};A.DOM_EVENTS={"click":true,"dblclick":true,"keydown":true,"keypress":true,"keyup":true,"mousedown":true,"mousemove":true,"mouseout":true,"mouseover":true,"mouseup":true,"mouseenter":true,"mouseleave":true,"focus":true,"blur":true,"submit":true,"change":true};A.prototype={DOM_EVENTS:null,DEFAULT_HTML_SETTER:function(G,E){var F=this.get("element");if(F){F[E]=G;}return G;},DEFAULT_HTML_GETTER:function(E){var F=this.get("element"),G;if(F){G=F[E];}return G;},appendChild:function(E){E=E.get?E.get("element"):E;return this.get("element").appendChild(E);},getElementsByTagName:function(E){return this.get("element").getElementsByTagName(E);},hasChildNodes:function(){return this.get("element").hasChildNodes();},insertBefore:function(E,F){E=E.get?E.get("element"):E;F=(F&&F.get)?F.get("element"):F;return this.get("element").insertBefore(E,F);},removeChild:function(E){E=E.get?E.get("element"):E;return this.get("element").removeChild(E);},replaceChild:function(E,F){E=E.get?E.get("element"):E;F=F.get?F.get("element"):F;return this.get("element").replaceChild(E,F);},initAttributes:function(E){},addListener:function(J,I,K,H){H=H||this;var E=YAHOO.util.Event,G=this.get("element")||this.get("id"),F=this;if(C[J]&&!E._createMouseDelegate){return false;}if(!this._events[J]){if(G&&this.DOM_EVENTS[J]){E.on(G,J,function(M,L){if(M.srcElement&&!M.target){M.target=M.srcElement;}if((M.toElement&&!M.relatedTarget)||(M.fromElement&&!M.relatedTarget)){M.relatedTarget=E.getRelatedTarget(M);}if(!M.currentTarget){M.currentTarget=G;}F.fireEvent(J,M,L);},K,H);}this.createEvent(J,{scope:this});}return YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments);},on:function(){return this.addListener.apply(this,arguments);},subscribe:function(){return this.addListener.apply(this,arguments);},removeListener:function(F,E){return this.unsubscribe.apply(this,arguments);},addClass:function(E){B.addClass(this.get("element"),E);},getElementsByClassName:function(F,E){return B.getElementsByClassName(F,E,this.get("element"));},hasClass:function(E){return B.hasClass(this.get("element"),E);},removeClass:function(E){return B.removeClass(this.get("element"),E);},replaceClass:function(F,E){return B.replaceClass(this.get("element"),F,E);},setStyle:function(F,E){return B.setStyle(this.get("element"),F,E);
},getStyle:function(E){return B.getStyle(this.get("element"),E);},fireQueue:function(){var F=this._queue;for(var G=0,E=F.length;G<E;++G){this[F[G][0]].apply(this,F[G][1]);}},appendTo:function(F,G){F=(F.get)?F.get("element"):B.get(F);this.fireEvent("beforeAppendTo",{type:"beforeAppendTo",target:F});G=(G&&G.get)?G.get("element"):B.get(G);var E=this.get("element");if(!E){return false;}if(!F){return false;}if(E.parent!=F){if(G){F.insertBefore(E,G);}else{F.appendChild(E);}}this.fireEvent("appendTo",{type:"appendTo",target:F});return E;},get:function(E){var G=this._configs||{},F=G.element;if(F&&!G[E]&&!YAHOO.lang.isUndefined(F.value[E])){this._setHTMLAttrConfig(E);}return D.prototype.get.call(this,E);},setAttributes:function(K,H){var F={},I=this._configOrder;for(var J=0,E=I.length;J<E;++J){if(K[I[J]]!==undefined){F[I[J]]=true;this.set(I[J],K[I[J]],H);}}for(var G in K){if(K.hasOwnProperty(G)&&!F[G]){this.set(G,K[G],H);}}},set:function(F,H,E){var G=this.get("element");if(!G){this._queue[this._queue.length]=["set",arguments];if(this._configs[F]){this._configs[F].value=H;}return;}if(!this._configs[F]&&!YAHOO.lang.isUndefined(G[F])){this._setHTMLAttrConfig(F);}return D.prototype.set.apply(this,arguments);},setAttributeConfig:function(E,F,G){this._configOrder.push(E);D.prototype.setAttributeConfig.apply(this,arguments);},createEvent:function(F,E){this._events[F]=true;return D.prototype.createEvent.apply(this,arguments);},init:function(F,E){this._initElement(F,E);},destroy:function(){var E=this.get("element");YAHOO.util.Event.purgeElement(E,true);this.unsubscribeAll();if(E&&E.parentNode){E.parentNode.removeChild(E);}this._queue=[];this._events={};this._configs={};this._configOrder=[];},_initElement:function(G,F){this._queue=this._queue||[];this._events=this._events||{};this._configs=this._configs||{};this._configOrder=[];F=F||{};F.element=F.element||G||null;var I=false;var E=A.DOM_EVENTS;this.DOM_EVENTS=this.DOM_EVENTS||{};for(var H in E){if(E.hasOwnProperty(H)){this.DOM_EVENTS[H]=E[H];}}if(typeof F.element==="string"){this._setHTMLAttrConfig("id",{value:F.element});}if(B.get(F.element)){I=true;this._initHTMLElement(F);this._initContent(F);}YAHOO.util.Event.onAvailable(F.element,function(){if(!I){this._initHTMLElement(F);}this.fireEvent("available",{type:"available",target:B.get(F.element)});},this,true);YAHOO.util.Event.onContentReady(F.element,function(){if(!I){this._initContent(F);}this.fireEvent("contentReady",{type:"contentReady",target:B.get(F.element)});},this,true);},_initHTMLElement:function(E){this.setAttributeConfig("element",{value:B.get(E.element),readOnly:true});},_initContent:function(E){this.initAttributes(E);this.setAttributes(E,true);this.fireQueue();},_setHTMLAttrConfig:function(E,G){var F=this.get("element");G=G||{};G.name=E;G.setter=G.setter||this.DEFAULT_HTML_SETTER;G.getter=G.getter||this.DEFAULT_HTML_GETTER;G.value=G.value||F[E];this._configs[E]=new YAHOO.util.Attribute(G,this);}};YAHOO.augment(A,D);YAHOO.util.Element=A;})();YAHOO.register("element",YAHOO.util.Element,{version:"2.8.1",build:"19"});/*
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.8.1
*/
/*
 * SWFObject v1.5: Flash Player detection and embed - http://blog.deconcept.com/swfobject/
 *
 * SWFObject is (c) 2007 Geoff Stearns and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 * @namespace YAHOO
 */
YAHOO.namespace("deconcept");YAHOO.deconcept=YAHOO.deconcept||{};if(typeof YAHOO.deconcept.util=="undefined"||!YAHOO.deconcept.util){YAHOO.deconcept.util={};}if(typeof YAHOO.deconcept.SWFObjectUtil=="undefined"||!YAHOO.deconcept.SWFObjectUtil){YAHOO.deconcept.SWFObjectUtil={};}YAHOO.deconcept.SWFObject=function(E,C,K,F,H,J,L,G,A,D){if(!document.getElementById){return;}this.DETECT_KEY=D?D:"detectflash";this.skipDetect=YAHOO.deconcept.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];if(E){this.setAttribute("swf",E);}if(C){this.setAttribute("id",C);}if(K){this.setAttribute("width",K);}if(F){this.setAttribute("height",F);}if(H){this.setAttribute("version",new YAHOO.deconcept.PlayerVersion(H.toString().split(".")));}this.installedVer=YAHOO.deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){YAHOO.deconcept.SWFObject.doPrepUnload=true;}if(J){this.addParam("bgcolor",J);}var B=L?L:"high";this.addParam("quality",B);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var I=(G)?G:window.location;this.setAttribute("xiRedirectUrl",I);this.setAttribute("redirectUrl","");if(A){this.setAttribute("redirectUrl",A);}};YAHOO.deconcept.SWFObject.prototype={useExpressInstall:function(A){this.xiSWFPath=!A?"expressinstall.swf":A;this.setAttribute("useExpressInstall",true);},setAttribute:function(A,B){this.attributes[A]=B;},getAttribute:function(A){return this.attributes[A];},addParam:function(A,B){this.params[A]=B;},getParams:function(){return this.params;},addVariable:function(A,B){this.variables[A]=B;},getVariable:function(A){return this.variables[A];},getVariables:function(){return this.variables;},getVariablePairs:function(){var A=[];var B;var C=this.getVariables();for(B in C){if(C.hasOwnProperty(B)){A[A.length]=B+"="+C[B];}}return A;},getSWFHTML:function(){var D="";var C={};var A="";var B="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}D='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';D+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';C=this.getParams();for(A in C){if(C.hasOwnProperty(A)){D+=[A]+'="'+C[A]+'" ';}}B=this.getVariablePairs().join("&");if(B.length>0){D+='flashvars="'+B+'"';}D+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}D='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';D+='<param name="movie" value="'+this.getAttribute("swf")+'" />';C=this.getParams();for(A in C){if(C.hasOwnProperty(A)){D+='<param name="'+A+'" value="'+C[A]+'" />';}}B=this.getVariablePairs().join("&");if(B.length>0){D+='<param name="flashvars" value="'+B+'" />';}D+="</object>";}return D;},write:function(A){if(this.getAttribute("useExpressInstall")){var B=new YAHOO.deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(B)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var C=(typeof A=="string")?document.getElementById(A):A;C.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute("redirectUrl")!==""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};YAHOO.deconcept.SWFObjectUtil.getPlayerVersion=function(){var D=null;var C=new YAHOO.deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var A=navigator.plugins["Shockwave Flash"];if(A&&A.description){C=new YAHOO.deconcept.PlayerVersion(A.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var B=3;while(D){try{B++;D=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+B);C=new YAHOO.deconcept.PlayerVersion([B,0,0]);}catch(E){D=null;}}}else{try{D=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(E){try{D=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");C=new YAHOO.deconcept.PlayerVersion([6,0,21]);D.AllowScriptAccess="always";}catch(E){if(C.major==6){return C;}}try{D=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(E){}}if(D!==null){C=new YAHOO.deconcept.PlayerVersion(D.GetVariable("$version").split(" ")[1].split(","));}}}return C;};YAHOO.deconcept.PlayerVersion=function(A){this.major=A[0]!==null?parseInt(A[0],0):0;this.minor=A[1]!==null?parseInt(A[1],0):0;this.rev=A[2]!==null?parseInt(A[2],0):0;};YAHOO.deconcept.PlayerVersion.prototype.versionIsValid=function(A){if(this.major<A.major){return false;}if(this.major>A.major){return true;}if(this.minor<A.minor){return false;}if(this.minor>A.minor){return true;}if(this.rev<A.rev){return false;}return true;};YAHOO.deconcept.util={getRequestParameter:function(D){var C=document.location.search||document.location.hash;if(D===null){return C;}if(C){var B=C.substring(1).split("&");for(var A=0;A<B.length;A++){if(B[A].substring(0,B[A].indexOf("="))==D){return B[A].substring((B[A].indexOf("=")+1));}}}return"";
}};YAHOO.deconcept.SWFObjectUtil.cleanupSWFs=function(){var C=document.getElementsByTagName("OBJECT");for(var B=C.length-1;B>=0;B--){C[B].style.display="none";for(var A in C[B]){if(typeof C[B][A]=="function"){C[B][A]=function(){};}}}};if(YAHOO.deconcept.SWFObject.doPrepUnload){if(!YAHOO.deconcept.unloadSet){YAHOO.deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",YAHOO.deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",YAHOO.deconcept.SWFObjectUtil.prepUnload);YAHOO.deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(A){return document.all[A];};}YAHOO.widget.FlashAdapter=function(E,A,B,C){this._queue=this._queue||[];this._events=this._events||{};this._configs=this._configs||{};B=B||{};this._id=B.id=B.id||YAHOO.util.Dom.generateId(null,"yuigen");B.version=B.version||"9.0.45";B.backgroundColor=B.backgroundColor||"#ffffff";this._attributes=B;this._swfURL=E;this._containerID=A;this._embedSWF(this._swfURL,this._containerID,B.id,B.version,B.backgroundColor,B.expressInstall,B.wmode,C);try{this.createEvent("contentReady");}catch(D){}};YAHOO.widget.FlashAdapter.owners=YAHOO.widget.FlashAdapter.owners||{};YAHOO.extend(YAHOO.widget.FlashAdapter,YAHOO.util.AttributeProvider,{_swfURL:null,_containerID:null,_swf:null,_id:null,_initialized:false,_attributes:null,toString:function(){return"FlashAdapter "+this._id;},destroy:function(){if(this._swf){var B=YAHOO.util.Dom.get(this._containerID);B.removeChild(this._swf);}var A=this._id;for(var C in this){if(YAHOO.lang.hasOwnProperty(this,C)){this[C]=null;}}},_embedSWF:function(J,I,E,C,F,G,B,H){var D=new YAHOO.deconcept.SWFObject(J,E,"100%","100%",C,F);if(G){D.useExpressInstall(G);}D.addParam("allowScriptAccess","always");if(B){D.addParam("wmode",B);}D.addParam("menu","false");D.addVariable("allowedDomain",document.location.hostname);D.addVariable("YUISwfId",E);D.addVariable("YUIBridgeCallback","YAHOO.widget.FlashAdapter.eventHandler");if(H){D.addVariable("buttonSkin",H);}var A=YAHOO.util.Dom.get(I);var K=D.write(A);if(K){this._swf=YAHOO.util.Dom.get(E);YAHOO.widget.FlashAdapter.owners[E]=this;}else{}},_eventHandler:function(B){var A=B.type;switch(A){case"swfReady":this._loadHandler();return;case"log":return;}this.fireEvent(A,B);},_loadHandler:function(){this._initialized=false;this._initAttributes(this._attributes);this.setAttributes(this._attributes,true);this._initialized=true;this.fireEvent("contentReady");},set:function(A,B){this._attributes[A]=B;YAHOO.widget.FlashAdapter.superclass.set.call(this,A,B);},_initAttributes:function(A){this.getAttributeConfig("altText",{method:this._getAltText});this.setAttributeConfig("altText",{method:this._setAltText});this.getAttributeConfig("swfURL",{method:this._getSWFURL});},_getSWFURL:function(){return this._swfURL;},_getAltText:function(){return this._swf.getAltText();},_setAltText:function(A){return this._swf.setAltText(A);}});YAHOO.widget.FlashAdapter.eventHandler=function(A,B){if(!YAHOO.widget.FlashAdapter.owners[A]){setTimeout(function(){YAHOO.widget.FlashAdapter.eventHandler(A,B);},0);}else{YAHOO.widget.FlashAdapter.owners[A]._eventHandler(B);}};YAHOO.widget.FlashAdapter.proxyFunctionCount=0;YAHOO.widget.FlashAdapter.createProxyFunction=function(B){var A=YAHOO.widget.FlashAdapter.proxyFunctionCount;YAHOO.widget.FlashAdapter["proxyFunction"+A]=function(){return B.apply(null,arguments);};YAHOO.widget.FlashAdapter.proxyFunctionCount++;return"YAHOO.widget.FlashAdapter.proxyFunction"+A.toString();};YAHOO.widget.FlashAdapter.removeProxyFunction=function(A){if(!A||A.indexOf("YAHOO.widget.FlashAdapter.proxyFunction")<0){return;}A=A.substr(26);YAHOO.widget.FlashAdapter[A]=null;};YAHOO.widget.Uploader=function(A,B,D){var C="window";if(!(B)||(B&&D)){C="transparent";}YAHOO.widget.Uploader.superclass.constructor.call(this,YAHOO.widget.Uploader.SWFURL,A,{wmode:C},B);this.createEvent("mouseDown");this.createEvent("mouseUp");this.createEvent("rollOver");this.createEvent("rollOut");this.createEvent("click");this.createEvent("fileSelect");this.createEvent("uploadStart");this.createEvent("uploadProgress");this.createEvent("uploadCancel");this.createEvent("uploadComplete");this.createEvent("uploadCompleteData");this.createEvent("uploadError");};YAHOO.widget.Uploader.SWFURL="assets/uploader.swf";YAHOO.extend(YAHOO.widget.Uploader,YAHOO.widget.FlashAdapter,{upload:function(A,B,E,C,D){this._swf.upload(A,B,E,C,D);},uploadThese:function(B,A,E,C,D){this._swf.uploadThese(B,A,E,C,D);},uploadAll:function(A,D,B,C){this._swf.uploadAll(A,D,B,C);},cancel:function(A){this._swf.cancel(A);},clearFileList:function(){this._swf.clearFileList();},removeFile:function(A){this._swf.removeFile(A);},setAllowLogging:function(A){this._swf.setAllowLogging(A);},setSimUploadLimit:function(A){this._swf.setSimUploadLimit(A);},setAllowMultipleFiles:function(A){this._swf.setAllowMultipleFiles(A);},setFileFilters:function(A){this._swf.setFileFilters(A);},enable:function(){this._swf.enable();},disable:function(){this._swf.disable();}});YAHOO.register("uploader",YAHOO.widget.Uploader,{version:"2.8.1",build:"19"});(function(){var b=LIModules.imports("i18n");
var a=(function(){var h={left:"right",right:"left",ltr:"rtl",rtl:"ltr"},m;
function c(o){return typeof o==="function"
}function e(o){return o===true||o===false||Object.prototype.toString.call(o)==="[object Boolean]"
}function d(o){return o===void 0
}function i(o){return c(o)?o():o
}function l(o){o=i(o);
if(e(o)){o=!o
}else{if(o&&h[o]){o=h[o]
}}return o
}function k(){return m
}function j(w){if((w===void 0)||(w===null)){return false
}var t=0,o,q=w.length,p=" \n\r\t\f\u00A0\u2028\u2029".split(""),x="~!@#$%^&*()_+`1234567890-={}|[]\\:\";'<>?,./".split(""),v=p.concat(x),u="\u0590",r="\u06FF";
function s(A,z){if(A===null){return false
}var y=Array.prototype.indexOf;
if(y&&A.indexOf===y){return A.indexOf(z)!==-1
}return Array.prototype.some(A,function(B){return B===z
})
}for(;
t<q;
t++){o=w.charAt(t);
if(!s(v,o)){break
}}if(t>=q){return false
}return(o>=u&&o<=r)?true:false
}function g(o,p){var q;
if(k()){if(d(p)){q=l(o)
}else{q=i(p)
}}else{q=i(o)
}return q
}function f(o){return this.flip(null,o)
}function n(){m=b&&b.page&&b.page.readsRTL()
}n();
return{init:n,flip:g,applyWhenRTL:f,isRtl:j}
}());
LIModules.exports("Bidi",a)
})();LI.define("Inbox");
LI.Inbox=function(d,t){dust.render("inbox_unavailable",{errorMsg:ajax_common_error_message},function(w,v){LI.Inbox.ErrorMsg=v
});
var u=t.data,i=new LI.Inbox.Model.PageModel({loginMember:u.loginMember,enableContentCache:t.enableContentCache,enablePreload:t.enablePreload}),l=new LI.Inbox.Alerts.Model(),a=new LI.Inbox.Router.PageRouter({model:i,alert:l});
LI.Inbox.Util.init({model:i,alert:l,i18nStrings:t.i18nStrings,trackingUrl:t.trackingUrl});
var c={model:i,alert:l,router:a},j=new LI.Inbox.Ads.View(_.extend(c,{disableAds:t.disableAds,disableOneAd:t.disableOneAd,swapAdPositions:t.swapAdPositions})),r=new LI.Inbox.Alerts.View(c),p=new LI.Inbox.Common.View(c),m=new LI.Inbox.Actions.View(c),n=new LI.Inbox.Sidebar.View(c),b=new LI.Inbox.Compose.View(_.extend(c,{showPromoSlot:t.showPromoSlot,ghostImgSrc:t.ghostImage})),s=new LI.Inbox.Messages.View(c),k=new LI.Inbox.Invitations.View(c),h=new LI.Inbox.MessageDetail.View(c),g=t.enableProps?new LI.Inbox.Props.View(_.extend(c,{enableProps:t.enableProps,ghostImgSrc:t.ghostImage,englishWorkAnniversary:t.propsEnglishWorkAnniversary,propsLimit:t.propsLimit})):null,e=(t.showPromoSlot?new LI.Inbox.Promo.PromoModel({inboxData:c,showPromoSlot:t.showPromoSlot}):null),f=new LI.Inbox.Context.View(_.extend(c,{enableContextualInbox:t.enableContextualInbox,enableContextualCompose:t.enableContextualCompose,sharedConnectionsUrl:t.sharedConnectionsUrl})),q=new LI.Inbox.InlineCompose.BaseView(_.extend(c,{enableInlineCompose:t.enableInlineCompose,jellyBeanImageUrl:t.jellyBeanImageUrl,showPromoSlot:t.showPromoSlot})),o=new LI.Inbox.ConnectionChooser.ConnectionChooserView(_.extend(c,{chooserState:new LI.Inbox.ConnectionChooser.ChooserState(),sharedConnections:new LI.Inbox.ConnectionChooser.SharedConnections()}));
if(document.documentMode&&document.documentMode===7&&LI.browser.ie7){LI.injectAlert({message:LI.Inbox.Util.getI18nString("ieCompModeErrorMessage"),type:"error",animate:false,dismissable:false});
return false
}LI.Inbox.Model.instance=i;
LI.Inbox.Router.instance=a;
Backbone.history.start();
$("#content-outer").on("click",".url-action-button",function(){var v=$(this).data("url");
window.location.replace(v)
});
$("#content-outer").on("click","button",function(x){var w=$(this),v=w.attr("type");
if(v!=="submit"){x.preventDefault()
}})
};LI.define("Inbox.Model");
LI.Inbox.Model={CONTENT_ID:"#content-outer",PageModel:Backbone.Model.extend({defaults:{page:"",prefix:"",tracking:"",counts:{messages:0,invitations:0},context:{folder:"",filter:"",keywords:"",count:0,startRow:0,pageSize:0},switchContext:true,readFromCache:false,composeByteLimit:7000,composeHeightLimit:312,composeHeightDeltaModifier:3},initialize:function(a){_.extend(this,a);
this.cache=new LI.Inbox.Cache(this,a.enableContentCache,a.enablePreload);
this.listenTo(this,"change:page",this.onPageChange)
},onPageChange:function(){var g=this.get("prefix"),f=this.get("page"),h=this.get("tracking"),d="/"+g+f,c=this,e;
if(h&&h!==""){d=d.replace(/trk=\w*/g,"");
d=d+((d.indexOf("?")>0)?"&trk=":"?trk=")+h
}if(!this.prefetch){this.prefetch=true;
e=$("#content");
if(e.length){this.onDataReady(g,f,null)
}}else{e=this.cache.getContent(g,f);
if(e){$("#content").replaceWith(e);
LI.Inbox.Util.cachePageTracking("full_page",h+"-cache",null);
this.set({readFromCache:true});
this.onDataReady(g,f,null)
}else{var a=f.indexOf("?");
var b="/"+g+f.substr(0,a>-1?a:f.length);
LI.Inbox.Util.sendAjax(b,{params:LI.Inbox.Util.getURLParams(d)}).done(function(k){var j=$(k).find("#global-error"),i=j.find(".success p strong"),l=i.length>0?i.text():null,m=LI.Inbox.Util.createPageString(k);
if(m.length){c.cache.storeContent(g,f,m);
$("#content").replaceWith(m)
}else{$("#content").html("")
}c.set({readFromCache:false});
c.onDataReady(g,f,l)
})
}}},onDataReady:function(d,c,b){if(typeof require==="function"){require(["externalTracking"],function(f){try{f.setDocumentPageKeyOverride(LI.Inbox.Util.getPageKey());
if(!$("#main").hasClass("firstLoad")){f.trackWithComScore(LI.Inbox.Util.getPageKey())
}}catch(g){}})
}var a=$("#content");
this.setContext(c,a);
if(LI.Inbox.Util.isComposePage(d,c)){LI.Controls.parseFragment($("#content-outer").html())
}$(".hidden-by-default").hide();
LI.Inbox.Util.toggleProgressIndicator(false);
this.cache.update(c);
this.trigger("inlinePageLoaded",{prefix:d,page:c,successMsg:b})
},setContext:function(k,e){var a=/^(messages|invitations|sent|archive|trash|search).*/;
var g=k.match(a);
var d=this.get("context");
var f,b;
if(g){b=g[1];
var c=(k.search(/subFilter=(\w+)/)>=0)?RegExp.$1:"none";
var n=(k.search(/startRow=(\d+)/)>=0)?parseInt(RegExp.$1,10):1;
var i=(k.search(/keywords=([^&]+)/)>=0)?RegExp.$1:"";
var h=e.find("#message-list");
if(!h.length){h=e.find("#invitations")
}var j=parseInt(h.attr("data-count"),10);
var l=parseInt(h.attr("page-size"),10);
f={"folder":b,"filter":c,"keywords":i,"count":j,"startRow":n,"pageSize":l};
if(f.folder!==d.folder||f.filter!==d.filter||f.keywords!==d.keywords||f.count!==d.count){this.cache.clear()
}this.set({context:f})
}else{if(e.hasClass("inbox-item-detail")&&this.get("switchContext")){b=e.attr("data-folder");
b=(b==="inbox")?"messages":b;
b=(b==="archived")?"archive":b;
if(b&&d.folder!==b){if(b){f={folder:b,filter:"",keywords:"",count:0,startRow:1,pageSize:0};
this.set({context:f})
}}}}this.set({switchContext:true})
}},Backbone.Events)};LI.define("Inbox.Router");
LI.Inbox.Router={PageRouter:Backbone.Router.extend({routes:{"*page":"displayPage"},navigationHistory:["messages"],initialize:function(a){_.bindAll(this,"displayPage","displayLeoPage","displayUnicornPage","addNavigationHistoryItem","navigateBack");
_.extend(this,a)
},displayPage:function(d){var c=this.model.get("prefix"),b=this.model.get("page"),f=LI.Inbox.Util.trackPage(c,b,"inbox/",d);
$(window).off("scroll");
if(!d){this.displayUnicornPage("messages",f)
}else{var a=d.match(/^(mbox|msgToConns|forwardProfileMsg|request|insideOpinionMsg)\?(.*)/);
var e=/^(compose|messages|invitations|sent|archive|trash|search|detail|action|compose-intro)?(?:[?][^<>]*)?$/;
if(a){this.displayLeoPage(a[1]+"?",a[2],f)
}else{if(e.test(d)){this.displayUnicornPage(d,f)
}else{LI.Inbox.Util.renderErrorPage();
LI.Inbox.Util.toggleProgressIndicator(false)
}}}},displayLeoPage:function(b,a,c){this.model.set({prefix:b,page:a+"&nrd=true",tracking:c})
},displayUnicornPage:function(a,b){this.model.set({prefix:"inbox/",page:a,tracking:b})
},addNavigationHistoryItem:function(a){this.navigationHistory.push(a)
},navigateBack:function(){var a=this.navigationHistory[this.navigationHistory.length-1];
this.navigate(a,{trigger:true})
}})};LI.define("Inbox.Cache");
LI.Inbox.Cache=function(c,d,e){var f="X-",a=this;
this.model=c;
this.cache=[];
this.contentCache=[];
this.enableContentCache=d;
this.enablePreload=e;
this.timeoutInterval=3600000;
this.setContext=function(m,k,j,l,h,g){var n={"folder":m,"filter":k,"keywords":j,"count":l,"startRow":h,"pageSize":g},i=this.model.get("context");
if(n.folder!==i.folder||n.filter!==i.filter||n.keywords!==i.keywords){this.cache=[]
}this.model.set({context:n})
};
this.add=function(g,i,h){this.cache[g]=h;
this.cache[i]=g
};
this.remove=function(l){var g=this.cache[l];
var h=[];
if(g){for(var i in this.cache){var j=this.cache[i];
if(i!==g&&j!==g){if($.isNumeric(i)){var k=(i>g)?1:0;
h[i-k]=j
}else{var k=(j>g)?1:0;
h[i]=j-k
}}}this.cache=h
}};
this.getRow=function(g){return this.cache[g]
};
this.getPrevious=function(h,i){var g=this.cache[h];
if(!g||g>1){this.find(h,-1,i)
}else{i(null)
}};
this.getNext=function(i,j){var g=this.cache[i];
var h=this.model.get("context").count;
if(!g||g<h){this.find(i,1,j)
}else{j(null)
}};
this.find=function(m,i,o){var h=this.model.get("context");
var l=h.pageSize;
var j=this.cache[m]||0;
var p=this;
var n=(i>0)?j+1:Math.max(j-l,1);
var g=this.cache[j+i];
if(this.cache[m]&&g){if(g.indexOf(f)===0){this.find(g.substring(f.length),i,o)
}else{o(g)
}return
}var k=function(r,q){var t="/inbox/";
var s=h.folder+"?startRow="+r+"&subFilter="+h.filter+"&keywords="+h.keywords;
LI.Inbox.Util.sendAjax(t+s).done(function(y){var w=$("<div/>").html(y).contents();
p.model.setContext(s,w);
p.update(s,w);
var x=p.cache[m];
if(x){var v=p.cache[x+i];
if(v.indexOf(f)===0){p.find(v.substring(f.length),i,o)
}else{o(v)
}}else{if(!q){var u=(i>0)?Math.max(j-l+1,1):j;
if(u!==r){k.call(p,u,true)
}else{o(null)
}}else{o(null)
}}})
};
k(n)
};
this.update=function(m,k){k=k?k:$(".content");
var i=k.find("#message-list .inbox-item");
var h=this.model.get("context").startRow;
var g=this;
var l=this.model.get("context").folder;
var j={};
i.each(function(r,v){var u=v.getAttribute("data-gid"),n=$(v).hasClass("unread");
if(u){var q=$(this).find(".detail-link");
if(q.length){var o=q.attr("href");
var p=o.match(/^\/inbox\/(.*)#(.+)/);
if(p&&p[2]){var t=p[2],w;
g.add(h+r,u,t);
if(n&&l==="messages"){if(/^detail/.test(t)){t="/inbox/"+t;
w="inbox"
}else{t="/"+t;
w="leo"
}var s=LI.Inbox.Util.getCanonicalUrl(t);
if(!g.contentCache[s]){j[u]=w
}}}else{g.add(h+r,u,f+u)
}}else{g.add(h+r,u,f+u)
}}});
if(this.enablePreload&&this.enableContentCache&&!jQuery.isEmptyObject(j)){$.ajax({type:"POST",url:"/inbox/detail/list",data:j,beforeSend:function(n){n.setRequestHeader("timeZone",LI.Inbox.Util.timeZone)
},success:function(o){var n=$(o).find(".message-detail");
n.each(function(){var q=$(this).attr("data-gid");
var t=g.cache[g.getRow(q)].replace("#","");
var p=t.match(/^(mbox|msgToConns|forwardProfileMsg|request|insideOpinionMsg)\?(.*)/);
var s,r;
if(p){s=p[1]+"?";
r=p[2]
}else{s="inbox/";
r=t
}g.storeContent(s,r,$(this).find("#content"))
})
}})
}};
this.clear=function(){this.cache=[]
};
this.getContent=function(j,i){if(this.enableContentCache){var h=LI.Inbox.Util.getCanonicalUrl("/"+j+i),g=this.contentCache[h];
if(g&&new Date().getTime()-g.savedTime<=this.timeoutInterval){if(LI.Inbox.Util.isComposePage(j,i)){return g.content.clone()
}return g.content
}}};
this.storeContent=function(j,i,h){if(this.enableContentCache){var g=LI.Inbox.Util.getCanonicalUrl("/"+j+i);
if(LI.Inbox.Util.isComposePage(j,i)){h=h.clone()
}this.contentCache[g]={content:h,savedTime:new Date().getTime()}
}};
this.removeContent=function(i,h){if(this.enableContentCache){var g=LI.Inbox.Util.getCanonicalUrl("/"+i+h);
delete this.contentCache[g]
}};
this.clearContent=function(){if(this.enableContentCache){this.contentCache=[]
}};
var b=_.functions(a);
_.each(b,function(g){a[g]=_.bind(a[g],a)
})
};LI.define("Inbox.Util");
LI.Inbox.Util={ERRORMSG:null,alert:null,model:null,timeZone:null,ajaxLoaded:false,spinnerDelay:500,spinnerMaxTimeout:15000,spinnerTimeoutId:null,i18nStrings:null,init:function(a){_.bindAll(this,"toggleProgressIndicator","decrementCounts","submitFormAjax","sendAjax","trackPage","getPageKey","cachePageTracking","getAllI18nStrings","getI18nString","getURLParams","isDetailPage","renderErrorPage");
this.i18nStrings=a.i18nStrings;
this.ERRORMSG=a.i18nStrings.errorMsg;
this.trackingUrl=a.trackingUrl;
this.alert=a.alert;
this.model=a.model;
this.timeZone=this.getGMTString()
},initGhostLabels:function(){$(".ghost-label").each(function(b,d){try{var a=$(d);
if(a.data("gl-done")!=="true"){LI.GhostLabel(d);
a.data("gl-done","true")
}}catch(c){}})
},getGMTString:function(){var a,c;
function b(e,d){var f=""+e;
while(f.length<d){f="0"+f
}return f
}a=new Date().getTimezoneOffset();
c="GMT"+((a<0?"+":"-")+b(parseInt(Math.abs(a/60),10),2)+b(Math.abs(a%60),2));
return c
},toggleProgressIndicator:function(a,c){var b=this;
if(a){b.ajaxLoaded=false;
setTimeout(function(){if(!b.ajaxLoaded){$(".progress-indicator, .progress-indicator-clear").show();
if(c===false){$(".progress-indicator").addClass("progress-indicator-clear")
}}},b.spinnerDelay)
}else{b.ajaxLoaded=true;
$(".progress-indicator, .progress-indicator-clear").hide();
if(c===false){$(".progress-indicator").removeClass("progress-indicator-clear")
}else{window.scrollTo(0,0)
}}},createPageString:function(b){var a=$(b),d,e,c;
if(a.find("#feed-wrapper").length){return LI.Inbox.ErrorMsg
}d=a.find("div#content"),e='<div id="main"',c;
if(!d.length){c=e+b.split(e)[1];
d=$("<div>"+c+"</div>").find("#content")
}if(!d.length){d=$('<div id="content"/>').append(a.find(".contain"))
}return d
},setCounts:function(d,b){var e=b.get("readFromCache");
if(!e&&d.attr("data-unread-msg")&&d.attr("data-pending-inv")){var c=d.data("unread-msg"),a=d.data("pending-inv");
b.set({counts:{messages:c,invitations:a}})
}},decrementCounts:function(c){var a=this.model.get("counts"),b=this.model.get("context"),d;
if(b.folder==="invitations"){d=(a.invitations-c<0)?0:a.invitations-c;
this.model.set({counts:{messages:a.messages,invitations:d}})
}else{if(b.folder==="messages"){d=(a.messages-c<0)?0:a.messages-c;
this.model.set({counts:{messages:d,invitations:a.invitations}})
}}},submitFormAjax:function(f,d){var b=$(f);
var g=b.find('input[type="submit"]');
var a=g.attr("name")||"submit";
var e={};
e[a]=g.val()||"";
var c={params:b.serialize()+"&"+$.param(e),getOrPost:b.attr("method")||"GET",isQueue:false,beforeSendFunction:function(i){var h=$('meta[name="treeID"]').attr("content");
i.setRequestHeader("X-IsAJAXForm",1);
if(h){i.setRequestHeader("X-LinkedIn-traceDataContext","X-LI-ORIGIN-UUID="+h)
}}};
return this.sendAjax(b.attr("action"),$.extend(c,d))
},sendAjax:function(c,d){var a=this;
var b={params:{},getOrPost:"GET",isQueue:false,beforeSendFunction:function(e){e.setRequestHeader("timeZone",a.timeZone);
e.setRequestHeader("X-FS-SSR-Embed-Render-Server",1)
}};
$.extend(b,d);
return $.ajax({url:c,type:b.getOrPost,data:b.params,beforeSend:function(f,e){a.toggleProgressIndicator(true);
b.beforeSendFunction.call(null,f,e)
}}).fail(function(){a.alert.show("failure",a.ERRORMSG)
}).always(function(){if(!b.isQueue){a.toggleProgressIndicator(false)
}})
},formatTime:function(d){var b=new Date(),a=new Date(),c=d.find(".date");
b.setHours(0,0,0,0);
a.setHours(0,0,0,0);
a.setDate(b.getDate()-1);
c.each(function(e,i){var h=$(i),g=h.find(".time-millis"),f=new Date(g.html());
f.setHours(0,0,0,0);
if(f.getTime()===b.getTime()){h.find(".today").removeClass("hidden")
}else{if(f.getTime()===a.getTime()){h.find(".yesterday").removeClass("hidden")
}else{if(f.getYear()===b.getYear()){h.find(".this-year").removeClass("hidden")
}else{h.find(".past").removeClass("hidden")
}}}});
c.find("span.hidden").remove()
},trackAction:function(c,d,b){if(WebTracking){var a=[];
a.push("action:"+d);
a.push("folder:"+b);
WebTracking.trackUserAction(c,a.join("|"),true)
}},trackPage:function(b,e,m,i){var d=(i&&i.search(/trk=(\w+)/)>=0)?RegExp.$1:"";
if(d.length!==0){if(d==="COMM_NI"){d=""
}else{return null
}}var j=b+e,l=m+i,c={"^inbox/detail|mbox\\?(?!.*inmailReply)":"inbox_detail","^(inbox/compose|msgToConns\\?|mbox\\?.*inmailReply|inbox/action)":"inbox_compose","^inbox/messages":"inbox_messages","^inbox/invitations":"inbox_invitations","^inbox/sent":"inbox_sent","^inbox/archive":"inbox_archive","^inbox/trash":"inbox_trash","^inbox/search":"inbox_search"},k={"replyToSender|displayReply|inmailReply":"msg-reply","^inbox/detail|displayMBoxItem":"msg-detail","replyAllMEBC|displayReplyAll":"msg-replyall","forward|displayForward":"msg-frwd","^(inbox/compose|msgToConns\\?)":"left_nav-compose","^inbox/messages":"left_nav-messages","^inbox/invitations":"left_nav-invitations","^inbox/sent":"left_nav-sent","^inbox/archive":"left_nav-archive","^inbox/trash":"left_nav-trash","^inbox/search":"left_nav-search"};
for(var f in c){if(c.hasOwnProperty(f)){if(new RegExp(f).test(j)){d=c[f];
break
}}}if(d){d+="-comm-"
}for(var a in k){if(k.hasOwnProperty(a)){if(new RegExp(a).test(l)){if(d){d+=k[a];
var h=(l.search(/(itemID|mboxItemGID|itemId)=(\w+)/)>=0)?RegExp.$2:"";
if(h.length!==0){var g=this.model.cache.getRow(h);
g=(g-1)%this.model.get("context").pageSize+1;
if(g){d+="-"+g
}}}break
}}}return d
},isComposePage:function(b,a){return(/^compose.*/.test(a)||b==="msgToConns?"||/.*(replyToSender|replyAllMEBC|forward|inmailReply|introductionProceed).*/.test(a))
},isDetailPage:function(){return this.getPageKey()==="inbox-detail"||this.getPageKey()==="mbox_item_details_katy"
},getCanonicalUrl:function(b){var f=b.split("?"),d=f[0];
if(f.length>1){var h=f[1].replace(/&?trk=[^&]*/,"");
if(h){var g=h.split("&"),c=["subFilter=","subFilter=none","keywords=","startRow=","sortBy=","nrd=true",""],a="",e="";
g.sort();
$.each(g,function(i,j){if($.inArray(j,c)===-1){a+=e+j;
e="&"
}});
if(a){d=d+"?"+a
}}}return d
},getPageKey:function(){var b=this.model.get("prefix")+this.model.get("page"),a={"^inbox/detail":"inbox-detail","^(inbox/compose|inbox/action)":"inbox-compose","^inbox/messages":"inbox-messages","^inbox/invitations":"inbox-invitations","^inbox/sent":"inbox-sent","^inbox/archive":"inbox-archive","^inbox/trash":"inbox-trash","^inbox/search":"inbox-search","^mbox\\?(?!.*inmailReply)":"mbox_item_details_katy","^msgToConns\\?":"reply_mebc_katy","^mbox\\?.*inmailReply":"accept_proposal_dc_katy"};
for(var c in a){if(a.hasOwnProperty(c)){if(new RegExp(c).test(b)){return a[c]
}}}return"inbox-default"
},fixLink:function(a){if(/ipad/.test(navigator.userAgent.toLowerCase())){var c=/(.*?\/inbox\/)(#.*)/,b=window.location.search;
$(a).find("a").each(function(f,e){var d=c.exec(e.href);
if(d!==null){e.href=d[1]+b+d[2]
}})
}},cachePageTracking:function(a,e,f){var c=LI.readCookie("bcookie"),b,d;
if(!c||!a){return
}if(!JSON||!JSON.stringify){return
}d=f&&JSON&&JSON.stringify?JSON.stringify(f):"";
b=this.trackingUrl.replace("pageTypePlaceholder",a).replace("pageKeyPlaceholder",LI.Inbox.Util.getPageKey()).replace("trackingCodePlaceholder",e||"").replace("trackingInfoPlaceholder",d);
$.ajax({type:"GET",url:b})
},updatePagination:function(a){if(a.attr("data-count")&&a.attr("data-count")==="0"){$(".pageIndex > ul").remove()
}},getAllI18nStrings:function(){return $.extend(true,{},this.i18nStrings)
},getI18nString:function(a){return(a&&this.i18nStrings)?this.i18nStrings[a]:""
},getURLParams:function(c){var a={};
var b=c||window.location.hash||window.location.search;
b=b.substr(b.indexOf("?")+1);
if(b.length>0){try{for(var d,f=0,h=b.split("&");
f<h.length;
f++){d=h[f].split("=");
a[decodeURIComponent(d[0])]=d.length>1?decodeURIComponent(d[1]).split("+").join(" "):""
}}catch(g){this.alert.show("failure",this.ERRORMSG);
return{}
}}return a
},encodeHTMLOnce:function(d){var c=d;
var b=LI.htmlUnencode(c);
for(var a=0;
a<5;
a++){if(c===b){return LI.htmlEncode(b)
}else{c=b;
b=LI.htmlUnencode(c)
}}return LI.htmlEncode(b)
},renderErrorPage:function(a){dust.render("inbox_unavailable",{errorMsg:a||this.ERRORMSG},function(c,b){$("#content").replaceWith(b)
})
},signalPromo:function(a,b){a.trigger("messageSuccessful",{recipientId:b,messageSent:true})
},i18nReplace:function(b,a){return i18n.substitute(a,b)
},encodeUrl:function(a){return encodeURIComponent(a).replace(/!/g,"%21")
},addWhiteSpaceReply:function(c){var a=$(c),b;
if(!a.length){return false
}b=a.val().split("\n");
if(b.length>2){b[2]=b[2]+" \t ";
a.val(b.join("\n"))
}}};LI.define("Inbox.Alerts");
LI.Inbox.Alerts={NO_ALERTS:{visible:false,msg:"",type:""},Model:Backbone.Model.extend({defaults:this.NO_ALERTS,timerEvent:null,persist:false,initialize:function(){_.bindAll(this,"clear","show")
},clear:function(){this.set(LI.Inbox.Alerts.NO_ALERTS)
},show:function(a,c,b){b=(typeof b==="undefined")?true:b;
if(!b){this.persist=true
}this.clear();
this.set({visible:b,type:a,msg:c})
}}),View:Backbone.View.extend({events:{"click #global-error-dismiss":function(){this.alert.clear()
}},initialize:function(a){_.bindAll(this,"render","onInlinePageLoaded","showAlert","fadeOutAlert");
_.extend(this,a);
this.listenTo(this.alert,"change",this.render);
this.listenTo(this.model,"inlinePageLoaded",this.onInlinePageLoaded);
this.setElement("#global-error")
},render:function(){$(this.el).show();
if(this.alert.get("visible")){this.showAlert()
}else{LI.removeAlert()
}},onInlinePageLoaded:function(){if(this.alert.persist){this.alert.persist=false;
if((this.alert!==LI.Inbox.Alerts.NO_ALERTS)&&!this.alert.get("visible")){this.alert.set("visible",true)
}}else{this.alert.clear()
}},showAlert:function(){var a=this;
LI.injectAlert({message:a.alert.get("msg"),type:a.alert.get("type"),dismissable:true,autoHide:false,animated:true});
if(a.alert.timerEvent){clearTimeout(a.alert.timerEvent)
}a.fadeOutAlert()
},fadeOutAlert:function(){var a=this;
this.alert.timerEvent=setTimeout(function(){LI.removeAlert();
a.alert.timerEvent=null
},5000)
}})};LI.define("Inbox.Ads");
LI.Inbox.Ads={View:Backbone.View.extend({randomNumberMultiplier:1000001,cspAdsUrl:"/csp/ads?f=f300x250_exp_2_8&fk=true&p=1&c=35&r=",initialize:function(a){_.bindAll(this,"reloadAds");
_.extend(this,a);
if(!this.disableAds){this.topAds=$("#ad-inbox-top-ads-1");
if(this.swapAdPositions){this.rightAds1=$("#ad-inbox-ads-2");
this.rightAds2=$("#ad-inbox-ads-1")
}else{this.rightAds1=$("#ad-inbox-ads-1");
this.rightAds2=$("#ad-inbox-ads-2")
}this.topAds.css("visibility","hidden").load(function(){$(this).css("visibility","visible")
});
this.topAdsDiv=$("div.textad");
this.rightAdsDiv=$("div.extra .ads").find("div");
this.$sponsoredInMailAd=$("#sponsored-inmail-ad");
this.listenTo(this.model,"inlinePageLoaded",this.reloadAds)
}},reloadAds:function(){var a=this;
if(this.isSponsoredInmail()){a.toggleSponsoredInmailAd(true)
}else{window.setTimeout(function(){try{var d=Math.floor(Math.random()*a.randomNumberMultiplier),b=a.topAds.attr("src"),j=a.rightAds1.attr("src"),i=/(.*z=)[\w\-]*(.*)/g,h=LI.Inbox.Util.getPageKey(),c=$("#content.inbox-item-detail"),g=a.disableOneAd&&(($(".inbox-compose").length>0)||((c.length>0)&&(c.find(".inmail-header").length<1)));
a.topAds=a.topAds.css("visibility","hidden").detach();
a.rightAds1=a.rightAds1.detach();
a.rightAds2=a.rightAds2.detach();
a.toggleSponsoredInmailAd(false);
a.topAds.attr("src",b.replace(i,"$1"+h+"$2"));
a.rightAds1.attr("src",j.replace(i,"$1"+h+"$2")+"&r="+d);
a.rightAds2.attr("src",a.cspAdsUrl+d);
a.topAdsDiv.append(a.topAds);
if(a.swapAdPositions){a.rightAdsDiv.append(a.rightAds2);
if(!g){a.rightAdsDiv.append(a.rightAds1)
}}else{a.rightAdsDiv.append(a.rightAds1);
if(!g){a.rightAdsDiv.append(a.rightAds2)
}}}catch(f){}},0)
}},isSponsoredInmail:function(){var a=$("#sponsored-inmail-context");
return(a.length>0&&a.attr("data-li-ad-unit-image-url"))
},toggleSponsoredInmailAd:function(a){var b=this;
if(a===true){window.setTimeout(function(){try{var d="",h=$("#sponsored-inmail-context"),c=h.attr("data-li-ad-unit-image-url"),f=h.attr("data-li-action-url");
b.rightAds1.hide();
b.rightAds2.hide();
if(f){d='<a target="_blank" href="'+f+'">'+'<img class="sponsored-inmail-img" alt="'+LI.Inbox.Util.getI18nString("sponsoredInMailAd")+'" src="'+c+'"/>'+"</a>"
}else{d='<img class="sponsored-inmail-img" alt="'+LI.Inbox.Util.getI18nString("sponsoredInMailAd")+'" src="'+c+'"/>'
}if(b.$sponsoredInMailAd.length<1){$(".extra .ads").append('<div id="sponsored-inmail-ad">'+d+"</div>");
b.$sponsoredInMailAd=$("#sponsored-inmail-ad")
}else{b.$sponsoredInMailAd.html(d);
b.$sponsoredInMailAd.show()
}}catch(g){}},0)
}else{b.rightAds1.show();
b.rightAds2.show();
b.$sponsoredInMailAd.hide();
b.$sponsoredInMailAd.html("")
}}})};LI.define("Inbox.Actions");
LI.Inbox.Actions={View:Backbone.View.extend({noAjaxActions:/replyToSender|replyAllMEBC|forward|introductionProceed/,removableActions:/trash|archive|deletePerm|recover/,invitationActions:/invitationAccept|invitationIgnore/,events:{"change .bulk-chk":function(){this.listEl.find("input:checkbox").prop("checked",$(".bulk-chk").prop("checked"));
this.checkBulkActions()
},"change .chk":function(a){if(!$(a.target).prop("checked")){$(".bulk-chk").prop("checked",false)
}else{if($(".chk:checked").length===$("#content .inbox-list .inbox-item").length){$(".bulk-chk").prop("checked",true)
}}this.checkBulkActions()
},"click a":"onSingleActionClick","click a.ignore-extra-action":"onIgnoreExtraActionClick","click [bulk-action]":"onBulkActionClick","click p.remove":"removeItem"},initialize:function(a){_.bindAll(this,"onLoad","updateAttributes","onSingleActionClick","onBulkActionClick","processSingleAction","processBulkAction","getSingleActionRequestCallback","getBulkActionRequestCallback","getBackfillRequestUrl","getNumItems","updateModel","emptyTrash","initInvitationItems","onIgnoreExtraActionClick","removeItem","checkItemCount","checkBulkActions");
this.model=a.model;
this.alert=a.alert;
this.listenTo(this.model,"inlinePageLoaded",this.onLoad)
},onLoad:function(){if($("#content").length){this.setElement("#content");
this.updateAttributes();
if(this.el.attr("id")==="invitations"){this.initInvitationItems(this.el)
}this.checkBulkActions()
}else{this.undelegateEvents()
}},updateAttributes:function(){this.el=$("#content div.content > div");
this.listEl=this.el.find(".inbox-list")
},onSingleActionClick:function(d){var c=$(d.target),f=c.data("action"),a=c.data("action-url"),b=c.closest(".inbox-item");
if(f){if(a&&!this.noAjaxActions.test(f)){d.preventDefault();
this.processSingleAction(b,f,a)
}else{if(b.hasClass("unread")){b.removeClass("unread");
LI.Inbox.Util.decrementCounts(1)
}}}},onBulkActionClick:function(c){var b=$(c.target),d=this.listEl.find("input:checkbox:checked").closest(".inbox-item"),a;
if(b.hasClass("action-icon")){b=b.parent()
}a=b.attr("bulk-action")||b.parent().attr("bulk-action");
c.preventDefault();
if(a==="emptyTrash"){if(this.listEl.find("li").length!==0){LI.Inbox.Util.toggleProgressIndicator(true);
this.emptyTrash()
}}else{if(d.length){LI.Inbox.Util.toggleProgressIndicator(true);
this.processBulkAction(d,a)
}}},processSingleAction:function(a,c,b){LI.Inbox.Util.trackAction("list_view-item_action",c,this.model.get("context").folder);
LI.Inbox.Util.toggleProgressIndicator(true,false);
a.addClass("item-removing").append('<div class="loading"></div>');
if(this.invitationActions.test(c)){b=b+"&ctx=inbox"
}this.model.cache.clearContent();
LI.RequestQueue.enqueue({method:"GET",url:b,callback:this.getSingleActionRequestCallback(a,c)})
},processBulkAction:function(c,b){LI.Inbox.Util.trackAction("list_view-bulk_action",b,this.model.get("context").folder);
var a=c.closest("form[name=bulkActionForm]")[0];
LI.RequestQueue.enqueue({method:"POST",url:"/inbox/bulk_action",form:a,postData:b+"=1",callback:this.getBulkActionRequestCallback(c,b)})
},getSingleActionRequestCallback:function(a,b){if(b==="star"){return{success:function(){a.addClass("flagged");
LI.Inbox.Util.toggleProgressIndicator(false,false);
a.find(".loading").remove()
},scope:this}
}else{if(b==="unstar"){return{success:function(){a.removeClass("flagged");
LI.Inbox.Util.toggleProgressIndicator(false,false);
a.find(".loading").remove()
},scope:this}
}else{if(this.invitationActions.test(b)){return{success:function(){a.removeClass("unread");
a.find("input.chk").remove();
if(b==="invitationAccept"){a.addClass("accept");
a.find(".shared-connections-snack").show()
}else{if(b==="invitationIgnore"){a.addClass("ignore")
}}$(".on-accept, .on-ignore").removeAttr("role");
a.attr("role","alert").focus();
var e=this.model.get("counts");
var c=parseInt(e.invitations,10);
if(c>10){var d=this;
$.ajax({url:this.getBackfillRequestUrl(1),beforeSend:function(f){f.setRequestHeader("X-IsAJAXForm",1);
f.setRequestHeader("timeZone",LI.Inbox.Util.timeZone)
}}).always(function(f){if(f&&f.content&&f.status&&f.status.toUpperCase()==="OK"){var g=$(f.content).find(".inbox-item.unread");
LI.Inbox.Util.formatTime(g);
d.initInvitationItems(g);
d.listEl.append(g)
}else{d.alert.show("failure",d.ERRORMSG)
}})
}this.model.set("counts",{messages:e.messages,invitations:c-1});
LI.Inbox.Util.toggleProgressIndicator(false,false);
a.find(".loading").remove()
},scope:this}
}}}return{success:function(){function d(){var e=this;
a.animate({height:"0px"},250,"swing",function(){e.listEl.height("").css("overflow","");
var f=a.hasClass("unread")?1:0;
e.removeItem(a);
e.updateModel(f,1);
e.checkBulkActions();
LI.Inbox.Util.toggleProgressIndicator(false,false)
})
}var c=this;
$.ajax({url:this.getBackfillRequestUrl(1),beforeSend:function(e){e.setRequestHeader("timeZone",LI.Inbox.Util.timeZone);
e.setRequestHeader("X-IsAJAXForm",1)
}}).always(function(f){var e=null,g;
if(f&&f.content&&f.status&&f.status.toUpperCase()==="OK"){if(b==="archive"){e=LI.Inbox.Util.getI18nString("actionMessageArchived")
}else{if(b==="trash"){e=LI.Inbox.Util.getI18nString("actionMessageDeleted")
}}if(e){c.alert.show("success",e)
}g=$(f.content).find(".inbox-item");
LI.Inbox.Util.formatTime(g);
c.listEl.height(c.listEl.height()).css("overflow","hidden").append(g);
d.call(c)
}else{c.alert.show("failure",c.ERRORMSG)
}})
},scope:this}
},getBulkActionRequestCallback:function(e,b){var d={success:function(h){var x=h.argument||{},w=x.responseFn,g=x.afterFn,q=$(h.responseText),u=q.find(".alert-msg"),p=q.find(".alert-type"),k=u?jQuery.trim(u.html()):"",m=p?jQuery.trim(p.html()):"";
if(w){var s=q.find(".response-list > li"),f=s.length,l,v,t,r,n;
for(r=0;
r<f;
++r){l=s.eq(r);
v=l.data("gid");
for(n=0;
n<e.length;
++n){t=e.eq(n);
if(v===t.data("gid")){w.apply(this,[l,t]);
break
}}}}if(g){g.apply(this,[q,m,k])
}if(!k){this.alert.clear()
}},scope:this};
var a=0;
switch(b){case"bulkTrash":case"bulkArchive":case"bulkPermanentDelete":case"bulkRecover":case"bulkInvitationAccept":case"bulkInvitationIgnore":var c=$();
d.argument={afterFn:function(k,i,g){var h=parseInt(k.find(".success-count").html(),10);
function j(){c.each(function(){this.removeClass("unread");
this.find("input.chk").remove();
if(b==="bulkInvitationAccept"){this.addClass("accept");
this.find(".shared-connections-snack").show()
}else{if(b==="bulkInvitationIgnore"){this.addClass("ignore")
}else{this.remove()
}}});
this.updateModel(a,h);
this.listEl.height("").css("overflow","");
this.alert.show(i,g);
$(".bulk-chk").prop("checked",false);
this.checkItemCount();
this.checkBulkActions();
LI.Inbox.Util.toggleProgressIndicator(false)
}if(h!==0){var f=this;
$.ajax({url:this.getBackfillRequestUrl(h),beforeSend:function(l){l.setRequestHeader("X-IsAJAXForm",1);
l.setRequestHeader("timeZone",LI.Inbox.Util.timeZone)
}}).always(function(l){if(l&&l.content&&l.status&&l.status.toUpperCase()==="OK"){var m=$(l.content).find(".inbox-item");
LI.Inbox.Util.formatTime(m);
f.listEl.height(f.listEl.height()).css("overflow","hidden").append(m)
}else{f.alert.show("failure",f.ERRORMSG)
}j.call(f)
});
this.model.cache.clearContent()
}},responseFn:function(f,g){g.addClass("item-removing");
if(g.hasClass("unread")){++a
}c.push(g)
}};
break;
case"bulkMarkRead":d.argument={afterFn:function(){LI.Inbox.Util.decrementCounts(a);
LI.Inbox.Util.toggleProgressIndicator(false)
},responseFn:function(f,g){if(g.hasClass("unread")){g.removeClass("unread");
++a
}}};
break;
case"bulkMarkUnread":d.argument={afterFn:function(){LI.Inbox.Util.decrementCounts(a);
LI.Inbox.Util.toggleProgressIndicator(false)
},responseFn:function(f,g){if(!g.hasClass("unread")){g.addClass("unread");
--a
}}};
break
}return d
},getBackfillRequestUrl:function(d){var c=this.model.get("context"),a=this.getNumItems()+c.startRow,b="/inbox/backfill/"+c.folder+"?startRow="+a+"&count="+d+"&subFilter="+c.filter+"&keywords="+c.keywords;
return b
},getNumItems:function(){return $("#content").find(".inbox-item").not(".item-removing").length
},updateModel:function(a,f){var b=this.model.get("counts");
var c=this.model.get("context");
if(c.folder==="invitations"){this.model.set({counts:{messages:b.messages,invitations:b.invitations-a}})
}else{if(c.folder==="messages"){this.model.set({counts:{messages:b.messages-a,invitations:b.invitations}})
}}var d=$("#message-list");
if(d){var e=this.model.get("page");
d.attr("data-count",c.count-f);
this.model.cache.update(e)
}},emptyTrash:function(){var b={success:function(d){var c;
var e={success:function(h){var g=$(h.responseText),f=g.find(".completed");
if(f&&parseInt(f.html(),10)){this.alert.show(g.find(".alert-type").html(),g.find(".alert-msg").html());
this.listEl.html("");
this.el.addClass("inbox-null");
window.clearInterval(c);
LI.Inbox.Util.toggleProgressIndicator(false);
this.checkBulkActions()
}},failure:function(f){window.clearInterval(c);
LI.Inbox.Util.toggleProgressIndicator(false);
this.checkBulkActions()
},scope:this};
c=window.setInterval(function(){LI.RequestQueue.enqueue({method:"GET",url:"/inbox/trash/check",callback:e})
},500)
},scope:this};
var a="csrfToken="+this.el.find("input[name=csrfToken]").val()+"&sourceAlias="+this.el.find("input[name=sourceAlias]").val();
LI.RequestQueue.enqueue({method:"POST",postData:a,url:"/inbox/trash/empty",callback:b})
},initInvitationItems:function(a){a.find(".button-group").each(function(b,c){new LI.Dropdown(c,{eventType:"click",triggerSelector:".trigger",activeClass:"active",mercyTime:300})
})
},onIgnoreExtraActionClick:function(d){d.preventDefault();
var a=$(d.target),c=a.attr("href"),e,b=this;
LI.Inbox.Util.sendAjax(c,{beforeSendFunction:function(f){f.setRequestHeader("X-IsAJAXForm",1)
}}).always(function(f){if(f&&f.content&&f.status.toUpperCase()==="OK"){e=$.trim($(f.content).find(".confirmation h4").text());
b.alert.show("success",dust.escapeHtml(e)||dust.escapeHtml(a.data("message")),true)
}else{b.alert.show("failure",dust.escapeHtml(LI.Inbox.Util.ERRORMSG),true)
}b.removeItem(a)
})
},removeItem:function(a){var b=a.target?$(a.target):a;
b.closest(".inbox-item").remove();
this.checkItemCount()
},checkItemCount:function(){if(this.listEl.find("li").length===0){this.el.addClass("inbox-null")
}},checkBulkActions:function(){var b=$(".bulkContainer-new li").filter('[bulk-action!="emptyTrash"]').find(".clear-button"),a=$(".bulkContainer-new").find(".disabled-dropdown"),d=a.find(".dropdown-trigger"),c=a.data("dropdownObj");
b=b.length>0?b:$("ul.bulkActions li").filter('[bulk-action!="emptyTrash"]');
$(".disabled-dropdown").each(function(e,f){$.data(f,"dropdownObj",new LI.Dropdown(f,{eventType:"hover",triggerSelector:".dropdown-trigger",activeClass:"active",mercyTime:300}))
});
if(b.length>0){if($(".chk:checked").length===0){if(a.length>0){a.off("mouseover",c._handleMouseOverEvent);
a.off("mouseout",c._handleMouseOutEvent);
d.off("focus",c._handleFocusEvent);
d.off("click",c._handleClickEvent);
d.off("mousedown",c._handleMousedownEvent)
}b.prop("disabled",true)
}else{if(a.length>0&&b.hasClass("disabled")){a.on("mouseover",c._handleMouseOverEvent);
a.on("mouseout",c._handleMouseOutEvent);
d.on("focus",c._handleFocusEvent);
d.on("click",c._handleClickEvent);
d.on("mousedown",c._handleMousedownEvent)
}b.prop("disabled",false)
}}}})};LI.define("Inbox.Common");
LI.Inbox.Common={View:Backbone.View.extend({initialize:function(a){_.extend(this,a);
this.listenTo(this.model,"inlinePageLoaded",this.onLoad);
LI.Inbox.Util.fixLink("body")
},onLoad:function(){this.enableDropdown();
this.enableTooltips();
LI.Inbox.Util.fixLink("#content")
},enableDropdown:function(){$(".dropdown").each(function(a,b){$.data(b,"dropdownObj",new LI.Dropdown(b,{eventType:"hover",triggerSelector:".dropdown-trigger",activeClass:"active",mercyTime:300}))
})
},enableTooltips:function(){var a=this;
if($("#content .inbox-list .inbox-actions").length){$("#content .inbox-list .inbox-actions li").each(function(b,c){if(!$(c).find(".hover-tooltip").length){dust.render("tooltipSpan",{content:c.innerHTML},function(e,d){c.innerHTML=d
})
}})
}$("#content .hover-tooltip").each(function(d,e){var b=$(e),f=$.trim(b.text()),g="id_"+d,c=b.closest("li");
if(!c.find(".callout-content").length){dust.render("tooltipCallout",{id:g,actionText:f},function(i,h){c.append(h)
});
tooltip=new LI.BalloonCallout(e,{width:"auto",id:g,orientation:"top",type:"tooltip-callout",delayOpen:true});
$("#"+g).prev().on("click",a.clearTooltips);
a.listenTo(a.model,"inlinePageLoaded",a.clearTooltips)
}})
},clearTooltips:function(){$(".bd").children().remove()
}})};LI.define("Inbox.Compose");
LI.Inbox.Compose={View:Backbone.View.extend({el:"#main",events:{"click .return-link":function(a){a.preventDefault();
if(this.onNavigationClick(a)){this.router.navigateBack()
}},'click a:not(".return-link, .context-link")':"onNavigationClick","submit .compose-form":"submitForm","keydown #ccInput, #ccInputHidden":function(b){var a=9;
if(b.keyCode===a){$("#ccInputHidden").focus()
}},"keydown #subject-composeForm":function(b){var a=9;
if(b.keyCode===a&&b.shiftKey){$("#ccInputHidden").focus()
}},"keyup #body-composeForm":function(a){this.$el.trigger("checkComposeHeight")
},"keyup #body-introRequestCompose":function(a){this.$el.trigger("checkComposeHeight")
},"checkComposeHeight":"checkComposeHeight","change #provideContact-receiverContact-accept_proposal_dc_katy":"toggleContactInfo"},connectionIdsDefaults:{idConnStore:"#recipients_id",nameConnStore:"#recipientNames_id"},connectionIds:this.connectionIdsDefaults,isReply:false,_validateSubjectLine:function(c){var b=$(c),a=b.find("#subject-composeForm");
if(a.length>0&&a.val().length>150){return false
}return true
},_validateComposeValue:function(f){var b=$(f),a=b.find("#body-composeForm"),d=this.model.get("composeByteLimit"),e;
function g(h){return encodeURI(h).split(/%..|./).length-1
}try{e=g(a.val())
}catch(c){e=a.val().length
}if(e>d){LI.setDataAttribute(a[0],"byte-count",e);
return false
}return true
},initialize:function(a){_.bindAll(this,"checkComposeHeight","onNavigationClick","submitForm","onBeforeUnload","toggleContactInfo");
_.extend(this,a);
this.listenTo(this.model,"inlinePageLoaded",this.onLoad);
this.showPromoSlot=a.showPromoSlot
},onLoad:function(){var b=$(".compose-form"),a=$("#body-composeForm"),e,d,c=this;
e=this.resolveConnectionIds();
d=$(e["nameConnStore"]).val();
c.isReply=(d&&$.trim(d)!=="")?true:false;
if(b.length){LI.Inbox.Util.setCounts(b,this.model);
window.onbeforeunload=this.onBeforeUnload;
if(a.length){this.initTypeahead()
}LI.Inbox.Util.initGhostLabels();
if(LI.browser.ie){LI.Inbox.ghostTextIE({ghostClass:"ie-ghost",beanStore:"ccCon",beanInput:"ccInput"})
}if(c.isReply){$("#ccInput").attr("placeholder","")
}c.$el.trigger("checkComposeHeight");
b.find('input[name="goback"]').remove();
$("#intro-connection-chooser").on("connectionChosen",function(f,g){c.populateIntroSubjectField(g)
});
LI.Inbox.Util.addWhiteSpaceReply("#body-composeForm");
if(c.isReply){a.focus().scrollTop(0);
a[0].selectionStart=0;
a[0].selectionEnd=0
}}},populateIntroSubjectField:function(d){var a,c,b;
a=d.selected.familiarName;
c=$("#intro-target-fname").val();
b=LI.Inbox.Util.getI18nString("introSubjectLine").replace("{:0}",a);
b=b.replace("{:1}",c);
b=$("<textarea />").html(b).text();
$("#subject-composeForm").val(b).show()
},onNavigationClick:function(b){var a=this.navigate();
if(!a.canNavigate&&!$(b.target).closest("#member-context").length){return window.confirm(a.message+"\n"+LI.Inbox.Util.getI18nString("navigateAway"))
}return true
},onBeforeUnload:function(){var a=this.navigate();
if(!a.canNavigate){return a.message
}},destroy:function(){window.onbeforeunload=null;
this.undelegateEvents();
this.stopListening()
},navigate:function(){return{canNavigate:!this.composeFormUnfinished(),message:LI.Inbox.Util.getI18nString("youHaveChangesMade")}
},resolveConnectionIds:function(){var b={idConnStore:"#connectionIds-msgForm",nameConnStore:"#connectionNames-msgForm"};
var a={idConnStore:"#connectionIds-accept_proposal_dc_katy",nameConnStore:"#connectionNames-accept_proposal_dc_katy"};
var c=$("#composeForm_id"),d=this.connectionIdsDefaults;
d=c.hasClass("msgToConns")?b:d;
d=c.hasClass("inmail")?a:d;
return d
},initTypeahead:function(b){var a={},d=this.model.loginMember,c=this;
if(d){a={displayName:c.htmlReencode(d.name),headLine:c.htmlReencode(d.name),id:d.memberID.toString(),subLine:c.htmlReencode(d.headline),imageUrl:d.picUrl,url:d.profileUrl}
}LI.Inbox.ComposeRecipientInput(document.getElementById("recipients-composeForm"),_.extend({focusOnInit:!c.isReply,selectionLimit:50,loginMember:a,ghostImgSrc:c.options.ghostImgSrc},c.resolveConnectionIds()))
},htmlReencode:function(a){return LI.htmlEncode(LI.htmlUnencode(a))
},submitForm:function(f){f.preventDefault();
var c=this,b=$(".compose-form"),a=b.attr("action"),d=b.attr("name");
if(!c._validateSubjectLine(".compose-form")){c.alert.show("failure",LI.Inbox.Util.getI18nString("correctErrors"));
$("#subject-composeForm-error").text(LI.Inbox.Util.getI18nString("composeSubjectLengthError"));
return false
}if(!c._validateComposeValue(".compose-form")){c.alert.show("failure",LI.Inbox.Util.getI18nString("correctErrors"));
$("#body-composeForm-error").text(LI.Inbox.Util.getI18nString("composeErrorMessage").replace("{:0}",LI.getDataAttribute($(".compose-form").find("#body-composeForm")[0],"byte-count")));
return false
}var e="";
LI.Inbox.Util.submitFormAjax(".compose-form",{isQueue:true}).done(function(m){if(c.showPromoSlot&&m&&m.content&&m.content.recipientIds){e=m.content.recipientIds[0]
}c.model.cache.clearContent();
$(".compose-form .error").text("");
if(m&&m.content&&m.content.success){c.router.navigateBack();
c.alert.show("success",m.content.success,false);
if(c.showPromoSlot){LI.Inbox.Util.signalPromo(c.model,e)
}}else{if(m&&m.errors&&m.errors.globalError){LI.Inbox.Util.toggleProgressIndicator(false);
c.alert.show("failure",m.errors.globalError);
if(m&&m.errors&&m.errors.fieldErrors){_.each(m.errors.fieldErrors,function(o,n){$("#"+n+"-error").text(o)
});
var k=$(".error"),i=$(".error:visible:first"),j=i.closest("li"),l=(j.find("input:first").length===1)?j.find("input:first"):j.find("textarea");
k.removeAttr("role");
i.attr("role","alert");
l.focus()
}}else{if(m&&m.content&&m.status&&m.status.toUpperCase()==="OK"){c.router.navigateBack();
var h=m.content.replace(/\s/g," ");
var g=/global-error.*?<strong>(.*?)<\/strong>/.exec(h);
if(g.length>1){c.alert.show("success",g[1],false);
if(c.showPromoSlot){LI.Inbox.Util.signalPromo(c.model,e)
}}}else{if(m&&m.redirectUrl&&m.status&&m.status.toUpperCase()==="OK"){c.router.navigateBack();
c.alert.show("success",LI.Inbox.Util.getI18nString("inboxSuccess"),false);
if(c.showPromoSlot){LI.Inbox.Util.signalPromo(c.model,e)
}}else{if(m&&m.indexOf("report.success")){c.router.navigateBack();
c.alert.show("success",LI.Inbox.Util.getI18nString("inboxSuccess"),false);
if(c.showPromoSlot){LI.Inbox.Util.signalPromo(c.model,e)
}}else{LI.Inbox.Util.toggleProgressIndicator(false);
c.alert.show("failure",LI.Inbox.Util.ERRORMSG)
}}}}}}).fail(function(){if(a==="/request"&&d==="accept_proposal_dc_katy"){c.alert.show("success",LI.Inbox.Util.getI18nString("inboxSuccess"),false);
c.router.navigateBack()
}})
},composeFormUnfinished:function(){var a=function(c){var b=$(c);
return b&&b.val()&&b.val().length>0
};
return _.find(["#recipients_id","#subject-composeForm","#body-composeForm"],a)!==undefined
},checkComposeHeight:function(){var f,g,b,a,e,h,d=this.model.get("composeHeightDeltaModifier"),c=this.model.get("composeHeightLimit");
f=$("#body-composeForm").length?$("#body-composeForm"):$("#body-introRequestCompose");
b=f.outerHeight();
g=f[0].scrollHeight;
e=f.css("line-height");
h=d*parseInt(e,10);
if((g>b)&&(b<c)){if((g+h)<c){a=g+h
}else{a=c
}f.height(a)
}},toggleContactInfo:function(a){$("#contact-info").toggle($(a.target).prop("checked"))
}})};LI.define("Inbox.Context");
LI.Inbox.Context={View:Backbone.View.extend({mode:{compose:false,detail:false,get:function(){if(this.compose){return"compose"
}if(this.detail){return"detail"
}}},enabled:{compose:false,detail:false,inMailCompose:false,inMailDetail:false},fields:"first_name,last_name,name,title,company",idCache:{},dataCache:{},contextCache:{},messageLoaded:{},activeContactId:undefined,noteData:{},reminderData:{},howYouMet:{},i18nValues:{"MemberContext":{},"Note":{},"Reminder":{},"IntroBean":{},"HistoryItem":{},"HowDidYouMeet":{}},i18nBlending:{"HistoryItem":function(b,a){if(b.intro_contact_name){a.introducedYou=a.introducedYou.replace("{:0}",LI.Inbox.Util.encodeHTMLOnce(b.intro_contact_name))
}if(b.intro_contact_title&&b.intro_contact_company){a.introductionHeadline=a.introductionHeadline.replace("{:0}",LI.Inbox.Util.encodeHTMLOnce(b.intro_contact_title));
a.introductionHeadline=a.introductionHeadline.replace("{:1}",LI.Inbox.Util.encodeHTMLOnce(b.intro_contact_company))
}if(b.formattedDate){a.reminder=a.reminder.replace("{:0}",b.formattedDate)
}return a
},"MemberContext":function(b,a){a.youAnd=a.youAnd.replace("{:0}",LI.Inbox.Util.encodeHTMLOnce(b.contact.familiarName));
if(b.connectedDate){a.connectedOn=a.connectedOn.replace("{:0}","<strong>"+b.connectedDate+"</strong>")
}if(b.reminderPromo){a.addReminderNotReady=a.addReminderNotReady.replace("{:0}",LI.Inbox.Util.encodeHTMLOnce(b.contact.familiarName))
}return a
}},getActiveContactId:function(){if(typeof this.activeContactId!=="undefined"){return this.activeContactId
}else{return false
}},events:{"click .toggle-see":"toggle","click .connection-container.message":"modalMessage","click .overview .how-you-met a":"addHowYouMetForm","click .overview .actions .add-note":"addNoteForm","click .overview .actions .add-reminder, .history .connection-container.reminder .edit, #set-reminder-link":"addEditReminderForm","click .form .how_we_met.save":"submitHowYouMet","click .form .note.save":"submitNote","click .form .note.edit-save":"submitNoteAgain","click .form .reminder.save":"submitReminder","click .form .reminder.edit-save":"submitReminderAgain","click .form .cancel":"cancelForm","click .history .connection-container.note .delete":"deleteNote","click .history .connection-container.note .edit":"editNote","click .history .connection-container.reminder .delete":"deleteReminder","click .history .connection-container.how_we_met .edit":"addHowYouMetForm","click .history .connection-container.how_we_met .delete":"deleteHowYouMetForm","click .intro-bean .remove":"removeIntroItem","click .history .connection-container.reminder .mark-complete":"markComplete","afterBeanSelected":"createContextByBean"},ajaxTrack:function(a){var b={pageKey:"contacts-relationship-input-action-toggle",event_type:"pageViewEventType",trackingInfo:{action:a.action},trackingCode:["inbox_",this.mode.get(),"-comm",a.trackingCode].join("")};
$.ajax({url:"/contacts/api/trackings/",type:"POST",beforeSend:this.ajaxCsrfToken,data:YAHOO.lang.JSON.stringify([b])})
},_trackNoteIcon:function(){this.ajaxTrack({action:"note",trackingCode:"-ctx-new_note"})
},_trackReminderIcon:function(){this.ajaxTrack({action:"reminder",trackingCode:"-ctx-new_reminder"})
},_trackReminderPromo:function(){this.ajaxTrack({action:"reminder",trackingCode:"-ctx-reminder_promo"})
},_trackHowYouMetQuestion:function(){this.ajaxTrack({action:"how_you_met",trackingCode:"-ctx-how_you_met"})
},_blendi18nValues:function(d,c,a){var b=$.extend({},c);
return a(d,b)
},initialize:function(a){if(a.enableContextualInbox||a.enableContextualCompose){_.extend(this,a);
this.setElement("#member-context");
this.listenTo(this.model,"inlinePageLoaded",this.onLoad)
}},onLoad:function(){var d=$(".compose-form"),b=$(".inbox-item-detail"),a,c,e;
dust.helpers.fmtnewlines=this.formatNewlines;
this.contextCache={};
this.geti18nValues();
if(b.length&&this.enableContextualInbox){this.mode.detail=true;
this.enabled.detail=true;
e=$("#content").find(".inbox-item-header > .from strong > a");
c=e.length>0?e.attr("href").match(/id=(\d*)/):null;
if(c){a=c[1]
}if(($(".inmail-header").length>0)&&(this.enableContextualInMail==="treatment")){this.enabled.inMailDetail=true
}if(a&&(this.enabled.inMailDetail||($(".inmail-header").length<1))){this.createContextByMemberId(a)
}}else{if(d.length&&this.enableContextualCompose&&!$("#composeForm_id").hasClass("inmail")){this.mode.compose=true;
this.enabled.compose=true;
this.createContextByMemberId($("#recipients-composeForm > .ccCon").first().attr("id"))
}else{$("#member-context").children().remove()
}}},geti18nValues:function(){var b=this,a=this.i18nValues;
a.MemberContext["seeAll"]=LI.Inbox.Util.getI18nString("contextualInboxSeeAll");
a.MemberContext["seeLess"]=LI.Inbox.Util.getI18nString("contextualInboxSeeLess");
a.MemberContext["seeMore"]=LI.Inbox.Util.getI18nString("contextualInboxSeeMore");
a.MemberContext["youAnd"]=LI.Inbox.Util.getI18nString("contextualInboxYouAnd");
a.MemberContext["connectedOn"]=LI.Inbox.Util.getI18nString("contextualInboxConnectedOn");
a.MemberContext["bothWorktedAt"]=LI.Inbox.Util.getI18nString("contextualInboxBothWorkedAt");
a.MemberContext["bothWentTo"]=LI.Inbox.Util.getI18nString("contextualInboxBothWentTo");
a.MemberContext["howDidYouMeet"]=LI.Inbox.Util.getI18nString("contextualInboxHowDidYouMeet");
a.MemberContext["addNote"]=LI.Inbox.Util.getI18nString("contextualInboxAddNote");
a.MemberContext["addReminder"]=LI.Inbox.Util.getI18nString("contextualInboxAddReminder");
a.MemberContext["addReminderNotReady"]=LI.Inbox.Util.getI18nString("contextualInboxAddReminderNotReady");
a.MemberContext["errorMsg"]=LI.Inbox.Util.getI18nString("contextualInboxErrorMsg");
a.MemberContext["modalErrTitle"]=LI.Inbox.Util.getI18nString("contextualInboxModalErrorTitle");
a.Note["save"]=LI.Inbox.Util.getI18nString("contextualInboxSave");
a.Note["cancel"]=LI.Inbox.Util.getI18nString("contextualInboxCancel");
a.Note["informationOnlyVisible"]=LI.Inbox.Util.getI18nString("contextualInboxInformationOnlyVisible");
a.Note["addNoteHere"]=LI.Inbox.Util.getI18nString("contextualInboxAddNoteHere");
a.Reminder["save"]=LI.Inbox.Util.getI18nString("contextualInboxSave");
a.Reminder["cancel"]=LI.Inbox.Util.getI18nString("contextualInboxCancel");
a.Reminder["informationOnlyVisible"]=LI.Inbox.Util.getI18nString("contextualInboxInformationOnlyVisible");
a.Reminder["whenShouldRemind"]=LI.Inbox.Util.getI18nString("contextualInboxWhenShouldRemind");
a.Reminder["whatShouldRemind"]=LI.Inbox.Util.getI18nString("contextualInboxWhatShouldRemind");
a.Reminder["oneDay"]=LI.Inbox.Util.getI18nString("contextualInboxOneDay");
a.Reminder["oneWeek"]=LI.Inbox.Util.getI18nString("contextualInboxOneWeek");
a.Reminder["oneMonth"]=LI.Inbox.Util.getI18nString("contextualInboxOneMonth");
a.IntroBean["removeIndividual"]=LI.Inbox.Util.getI18nString("contextualInboxRemoveIndividual");
a.HistoryItem["delete"]=LI.Inbox.Util.getI18nString("contextualInboxDelete");
a.HistoryItem["edit"]=LI.Inbox.Util.getI18nString("contextualInboxEdit");
a.HistoryItem["howYouMet"]=LI.Inbox.Util.getI18nString("contextualInboxHowYouMet");
a.HistoryItem["reminder"]=LI.Inbox.Util.getI18nString("contextualInboxReminder");
a.HistoryItem["introducedYou"]=LI.Inbox.Util.getI18nString("contextualInboxIntroducedYou");
a.HistoryItem["introductionHeadline"]=LI.Inbox.Util.getI18nString("contextualInboxIntroductionHeadline");
a.HowDidYouMeet["save"]=LI.Inbox.Util.getI18nString("contextualInboxSave");
a.HowDidYouMeet["cancel"]=LI.Inbox.Util.getI18nString("contextualInboxCancel");
a.HowDidYouMeet["informationOnlyVisible"]=LI.Inbox.Util.getI18nString("contextualInboxInformationOnlyVisible");
a.HowDidYouMeet["removeIndividual"]=LI.Inbox.Util.getI18nString("contextualInboxRemoveIndividual");
a.HowDidYouMeet["howWhenWhereMeet"]=LI.Inbox.Util.getI18nString("contextualInboxHowWhenWhereMeet");
a.HowDidYouMeet["whoIntroduced"]=LI.Inbox.Util.getI18nString("contextualInboxWhoIntroduced")
},createContextByMemberId:function(a){if(a){var c=this,d,b;
c.fetchContactId(a).done(function(e){d=c.idCache[a];
b=c.dataCache[d];
if(b.relationshipData){$.when(c.fetchMemberData(d),c.fetchConnectionData(a)).done(function(){if(b.connectionData&&b.memberData){c.render(d);
c.bindSharedConnectionsHovercard(a)
}})
}})
}},createContextByBean:function(b){var a=$("#recipients-composeForm > .ccCon.hl"),c=a.length<1?$("#recipients-composeForm > .ccCon:last"):a;
if(c.length>0&&this.enabled.compose){this.createContextByMemberId(c.attr("id"))
}},createContextByLastBean:function(a,b){if(b&&(b.idsArray.length>0)&&this.enabled.compose){this.createContextByMemberId(b.idsArray[b.idsArray.length-1])
}else{this.$el.slideUp();
this.$el.html("")
}},blendData:function(c){var r=this.dataCache[c].memberData,n=this.dataCache[c].connectionData,b=this.dataCache[c].relationshipData,f=[],a=[],l=new Date().setHours(0,0,0,0),h=this.mode.detail,k=2,e,j,q,o,m,g,p=this;
e=_.extend(b,r,n);
g=e.full&&e.full.length;
if(typeof e.full!=="undefined"){for(var d=0;
d<g;
d++){q=e.full[d];
e.full[d].formattedDate=this.formatDate(q.date*1000);
q.i18nValues=p._blendi18nValues(q,p.i18nValues.HistoryItem,p.i18nBlending.HistoryItem);
if((q.action==="connected")||(q.action==="added")){e.connectedDate=this.formatDate(q.date*1000)
}if(q.type==="how_we_met"){e.howWeMet=this.howYouMet[c]=q
}else{if(q.type==="note"){this.noteData[q.id]=q
}else{if(q.type==="reminder"){h=false;
this.reminderData[q.id]=q;
o=new Date(q.date*1000).setHours(0,0,0,0);
if(o<=l){e.full[d].markComplete=true;
if(o==l){e.full[d].today=true
}}}}}}if(g>1){m=e.full[g-1];
if(m.action!=="added"&&m.action!=="connected"){m.last=true
}else{e.full[g-2].last=true
}}if(!h){k++
}if((e.connectedDate&&(g+1>k))||(!e.connectedDate&&(g>k))){e.visible=[];
for(var d=0;
d<k;
d++){if((e.full[d].action==="connected")||(e.full[d].action==="added")){d++;
if(d>=g){break
}}e.visible.push(e.full[d])
}if(g>k){e.hidden=[];
for(var d=k;
d<g;
d++){e.hidden.push(e.full[d])
}}}else{e.visible=e.full
}e.reminderPromo=h
}this.dataCache[c].blendedData=e;
return this.dataCache[c].blendedData
},truncate:function(a,c){for(var b=c-3;
b>0;
b--){if(/\s/.test(a[b])){return a.substr(0,b)+"&hellip;"
}}},formatDate:function(a){if(typeof a!=="object"){a=new Date(+a)
}return[(a.getMonth()+1),"/",a.getDate(),"/",(a.getFullYear()+"").substr(-2,2)].join("")
},render:function(e){var b=this,a=b.dataCache[e],d=(typeof a.blendedData!=="undefined")?a.blendedData:b.blendData(e),c=b.contextCache[e];
d.i18nValues=b._blendi18nValues(d,b.i18nValues.MemberContext,b.i18nBlending.MemberContext);
if(typeof c!=="undefined"){b.el.innerHTML=c;
b.$el.slideDown()
}else{dust.render("memberContext",d,function(g,f){b.activeContactId=e;
b.contextCache[e]=f;
b.el.innerHTML=f;
b.$el.slideDown()
})
}},fetchContactId:function(a){var b=this,c=b.idCache[a];
if(typeof c!=="undefined"){return $.Deferred().resolve()
}return $.ajax({url:["/contacts/api/relationship/",a,"/"].join(""),success:function(d){if(!d.contact_id){b.dataCache["not-connected"]=b.dataCache["not-connected"]||{};
b.dataCache["not-connected"].relationshipData=false;
b.idCache[a]="not-connected"
}else{b.dataCache[d.contact_id]=b.dataCache[d.contact_id]||{};
b.dataCache[d.contact_id].relationshipData=d;
b.idCache[a]=d.contact_id
}}})
},fetchMemberData:function(b){var a=this,c=this.dataCache[b].memberData;
if(typeof c!=="undefined"){return $.Deferred().resolve()
}return $.ajax({url:["/contacts/api/contacts/",b,"/?fields=",a.fields].join(""),success:function(d){a.dataCache[b]=a.dataCache[b]||{};
a.dataCache[b].memberData=d
}})
},fetchConnectionData:function(a){var c=this,d=c.idCache[a],b=c.dataCache[d].connectionData;
if(typeof b!=="undefined"){return $.Deferred().resolve()
}return $.ajax({url:["/inbox/contact-details?contactId=",a,"&contactPic=shrink_100_100&commonPic=shrink_100_100"].join(""),success:function(e){if(e.content.data.contact){c.dataCache[d]=c.dataCache[d]||{};
c.dataCache[d].connectionData=e.content.data
}}})
},toggle:function(b){b.preventDefault();
var a=this;
a.$el.find(".preview .connection-container:last-child .connection-item").toggleClass("bordered");
a.$el.find(".see-more-content").slideToggle({complete:function(c){a.$el.find(".toggle-see").toggleClass("active")
}})
},modalMessage:function(e){e.preventDefault();
var b=this,a=$(e.target).closest(".connection-container.message"),c=a.attr("id").split("message-")[1],g=this.getActiveContactId(),f="LinkedIn",d;
if(!g){this.createContextByMemberId($(".from").data("member-id"));
return false
}$.when(this.getMessage(g,c,f)).done(function(h){if(b.injectMessage(c,h)){b.showMessage(c)
}else{b.showMessage(c,true)
}})
},getMessage:function(c,a,b){return $.ajax(["/contacts/services/get_message_div/?contact_id=",c,"&id=",a,"&source=",b].join(""))
},injectMessage:function(b,a){if(!this.messageLoaded[b]){document.getElementById(b).innerHTML=a;
this.messageLoaded[b]=true
}return true
},showMessage:function(d,b){var c,a;
if(b){c=document.getElementById("modal-message-error");
a=new LI.ModalDialogBox(void 0,{width:805,customClassName:"message-modal"});
a.open().then(function(){a.setDialogBodyContent(c.innerHTML);
a._$dialog.find("h3.title").text(a._$dialog.find("h4.title").text())
})
}else{c=document.getElementById(d);
a=new LI.ModalDialogBox(void 0,{width:805,customClassName:"message-modal"});
a.open().then(function(){a.setDialogBodyContent(c.innerHTML);
a._$dialog.find("h3.title").text(a._$dialog.find("h4.title").text())
})
}},bindSharedConnectionsHovercard:function(a){$(".see-more.context-link").attr("href",this.sharedConnectionsUrl.replace(/PID/,a));
var b=new LI.BalloonCallout(document.getElementById("shared-connections"),{width:288,id:"context-shared-connections",orientation:"top",type:"hovercard-callout",delayOpen:true})
},addHowYouMetForm:function(c){c.preventDefault();
this._trackHowYouMetQuestion();
var a=this,d=this.getActiveContactId(),b=this.howYouMet?this.howYouMet[d]:{};
if(!b){b={}
}b.i18nValues=a.i18nValues.HowDidYouMeet;
dust.render("howDidYouMeet",b,function(f,e){a.$el.find(".form").html(e).slideDown();
typeahead=new LI.Typeahead2(document.getElementById("how-you-met-intro-new"),{source:"TYPE_ALL_FIRST_DEGREE_CONNECTIONS",maxResultsDisplayed:8,renderAs:["DEFAULT","AUTOCHOOSE"],itemSelectEventHandler:function(){a.handleIntroItem.apply(a,arguments)
}})
})
},submitHowYouMet:function(b,c,i){b.preventDefault();
var k=this,j=$("#how-you-met-desc").val(),e=$("#how-you-met-intro-new").val(),h=e.length?['"intro_contact_id":',e,","].join(""):"",f=this.getActiveContactId(),a=["/contacts/api/contacts/",f,"/?source=profile&method=PUT&trk=inbox_",this.mode.get(),"-comm-ctx-save_how_you_met"].join(""),d=['{"how_we_met":{',h,'"description":"',this.stripNewLine(j),'"}}'].join(""),g;
i=i||"POST";
if(j){$.ajax({url:a,type:i,data:d,beforeSend:k.ajaxCsrfToken,success:function(l){if(l.status==="success"){l.how_we_met.noLink=true;
l.how_we_met.newItem=true;
l.how_we_met.last=true;
l.how_we_met.i18nValues=k._blendi18nValues(l.how_we_met,k.i18nValues.HistoryItem,k.i18nBlending.HistoryItem);
dust.render("historyItem",l.how_we_met,function(n,m){$("#how_we_met").slideUp().remove();
k.$el.find(".last").removeClass("last");
k.$el.find(".see-more-content").after(m);
k.$el.find(".form").html("").slideUp();
k.itemFadeIn($(".connection-container.new"));
g=$(".connection-container.new, .connection-container.new .icon-circle");
g.slideDown();
setTimeout(function(){g.removeClass("new")
},3500);
k.howYouMet[f]=l.how_we_met
})
}}})
}},deleteHowYouMetForm:function(e){e.preventDefault();
var a=this,g=this.getActiveContactId(),c=["/contacts/api/contacts/",g,"/?source=profile&method=PUT"].join(""),d="POST",b='{"how_we_met":{"intro_contact_id":"","description":""}}',f=$("#how_we_met");
$.ajax({url:c,type:d,data:b,beforeSend:this.ajaxCsrfToken,success:function(h){if(h.status==="success"){f.slideUp({complete:function(){f.html("")
}});
a.howYouMet[g]=undefined
}}})
},handleIntroItem:function(c,d){var a=this,b=d[2];
$.ajax({url:["/contacts/api/relationship/",b.id,"/"].join(""),success:function(e){b.contactId=e.contact_id;
b.i18nValues=a.i18nValues.IntroBean;
dust.render("introBean",b,function(g,f){$("#intro-contact").html(f).show();
$("#how-you-met-intro-new").hide().val(b.contactId)
})
}})
},removeIntroItem:function(a){$("#intro-contact").html("").hide();
$("#how-you-met-intro-new").val("").show()
},addNoteForm:function(e){e.preventDefault();
this._trackNoteIcon();
var d=this.$el.find(".overview > .actions"),b=d.find(".add-reminder > .icon"),c=d.find(".add-note > .icon"),f={},a=this.$el.find(".form");
b.addClass("inactive");
c.removeClass("inactive");
f.i18nValues=this.i18nValues.Note;
dust.render("note",f,function(h,g){a.slideUp().html(g).slideDown()
})
},submitNote:function(e,h){e.preventDefault();
var a=this,g=$("#note-desc").val(),f=this.getActiveContactId(),d=['{"text":"',this.stripNewLine(g),'","contact_id":"',f.toString(),'"}'].join(""),b,c;
if(h){b=["/contacts/api/contacts/",f,"/notes/",h,"/?source=profile&method=PUT&trk=inbox_",this.mode.get(),"-comm-ctx-save_note"].join("")
}else{b=["/contacts/api/contacts/",f,"/notes/?source=profile"].join("")
}if(g){$.ajax({url:b,type:"POST",data:d,beforeSend:a.ajaxCsrfToken,success:function(i){if(i.status==="success"){i=_.extend(i,{formattedDate:a.formatDate(i.date*1000),type:"note",noLink:true,id:i.note_id,newItem:true});
a.noteData[i.note_id]=i;
i.i18nValues=a._blendi18nValues(i,a.i18nValues.HistoryItem,a.i18nBlending.HistoryItem);
dust.render("historyItem",i,function(k,j){$("#note-"+h).slideUp().remove();
a.$el.find(".preview").prepend(j);
a.$el.find(".form").html("").slideUp();
a.$el.find(".inactive").removeClass("inactive");
a.itemFadeIn($(".connection-container.new"));
c=$(".connection-container.new, .connection-container.new .icon-circle");
c.slideDown();
setTimeout(function(){c.removeClass("new")
},3500)
})
}else{$("#context-note > .error").show()
}}})
}},submitNoteAgain:function(a){a.preventDefault();
this.submitNote(a,document.getElementById("context-note-id").value)
},deleteNote:function(b){b.preventDefault();
var a=this,c=this.getActiveContactId(),d=b.target.href.split("=")[1];
$.ajax({url:["/contacts/api/contacts/",c,"/notes/",d,"/?source=profile&method=delete"].join(""),type:"POST",beforeSend:a.ajaxCsrfToken,success:function(e){if(e.status==="success"){$("#note-"+d).slideUp().remove()
}}})
},editNote:function(e){e.preventDefault();
var g=e.target.href.split("=")[1],d=this.$el.find(".overview > .actions"),b=d.find(".add-reminder > .icon"),c=d.find(".add-note > .icon"),f=this.noteData[g]||{},a=this.$el.find(".form");
f.edit=true;
b.addClass("inactive");
c.removeClass("inactive");
f.i18nValues=this.i18nValues.Note;
dust.render("note",f,function(i,h){a.slideUp().html(h).slideDown()
})
},addEditReminderForm:function(a){a.preventDefault();
if(a.target.id==="set-reminder-link"){this._trackReminderPromo()
}else{this._trackReminderIcon()
}var b=a.target.href?a.target.href.split("=")[1]:undefined;
$actions=this.$el.find(".overview > .actions"),$reminderIcon=$actions.find(".add-reminder > .icon"),$noteIcon=$actions.find(".add-note > .icon"),$form=this.$el.find(".form");
currentDate=new Date(),reminderData=this.reminderData[b]||{};
if(b){reminderData.edit=true
}$reminderIcon.removeClass("inactive");
$noteIcon.addClass("inactive");
reminderData.i18nValues=this.i18nValues.Reminder;
dust.render("reminder",reminderData,function(d,c){$form.slideUp().html(c).slideDown()
})
},submitReminder:function(a,d,i,b){a.preventDefault();
var l=this,g=d?d+"/":"",f=this.getActiveContactId(),k=$("#reminder-desc").val()||"",h=$("#when-reminder-date").val(),c=new Date(),e=new Date(),b=b||["/contacts/api/contacts/",f,"/reminders/",d,"?source=profile&trk=inbox_",this.mode.get(),"-comm-ctx-save_reminder"].join(""),i=i||"POST",j;
if(h==="d"){e=e.setDate(e.getDate()+1)
}else{if(h==="w"){e=e.setDate(e.getDate()+7)
}else{if(h==="m"){e=e.setMonth(e.getMonth()+1)
}}}if(k||(i==="DELETE")){k=this.stripNewLine(k);
if(i==="DELETE"){j=undefined
}else{j=['{"description":"',k,'","due_date":',e/1000,',"recurring":false,"interval_description":null,"start_date":',c.getTime()/1000,"}"].join("")
}$.ajax({url:b,data:j,type:i,beforeSend:this.ajaxCsrfToken,success:function(m){if(m.status==="success"){if(m.date){m.formattedDate=l.formatDate(m.date*1000);
m.noLink=true;
l.reminderData[m.id]=m;
m.newItem=true;
m.i18nValues=l._blendi18nValues(m,l.i18nValues.HistoryItem,l.i18nBlending.HistoryItem);
dust.render("historyItem",m,function(o,n){$("#reminder-"+m.id).slideUp().remove();
l.$el.find(".preview").prepend(n);
l.$el.find(".form").html("").slideUp();
l.$el.find(".inactive").removeClass("inactive");
l.itemFadeIn($(".connection-container.new"));
newItem=$(".connection-container.new, .connection-container.new .icon-circle");
newItem.slideDown();
$("#set-reminder-link").remove();
setTimeout(function(){newItem.removeClass("new")
},3000)
})
}else{$("#reminder-"+d).slideUp().remove()
}}else{$("#context-reminder > .error").show()
}}})
}},submitReminderAgain:function(a){a.preventDefault();
this.submitReminder(a,document.getElementById("context-reminder-id").value,"PUT")
},deleteReminder:function(b){b.preventDefault();
var c=b.target.href.split("delete=")[1],a=["/contacts/api/contacts/",this.getActiveContactId(),"/reminders/",c,"/?source=profile"].join("");
this.submitReminder(b,c,"DELETE",a)
},cancelForm:function(a){a.preventDefault();
this.$el.find(".form").html("").slideUp();
this.$el.find(".inactive").removeClass("inactive")
},stripNewLine:function(a){return a.replace(/\r\n|\n|\r/g,"\\n")
},formatNewlines:function(b,c,a,e){var d=dust.helpers.tap(e.value,b,c);
d=d.replace(/\r\n|\n|\r/g,"<br>");
return b.write(d)
},itemFadeIn:function(b){var a=this;
dust.render("animationDiv",{},function(e,c){b.after(c);
var d=a.$el.find(".anim-blocker");
d.animate({height:b.height()},{complete:function(){d.fadeOut()
}})
})
},markComplete:function(d){d.preventDefault();
var h=d.target.href.split("mark-complete=")[1],a=this.reminderData[h],c=["/contacts/api/contacts/",this.getActiveContactId(),"/reminders/",h,"/?source=profile&method=PUT"].join(""),g="PUT",f=a.text,b=a.date,e=['{"description":"',f,'","recurring":false,"due_date":',b,',"completed":true}'].join("");
$.ajax({url:c,type:g,data:e,beforeSend:this.ajaxCsrfToken,success:function(i){$("#reminder-"+h).slideUp().remove()
}})
},ajaxCsrfToken:function(a){a.setRequestHeader("X_CSRF_TOKEN",(LI.readCookie("JSESSIONID")||"").replace(/"/g,""))
}})};LI.define("Inbox.Messages");
LI.Inbox.Messages={View:Backbone.View.extend({events:{"click li.inbox-item":"onInboxItemClick","click .detail-link":"onDetailLinkClick","click .dropdown-content:not(.bulk)":"onFilterChange"},initialize:function(c){var a=this,b=_.functions(a);
_.each(b,function(d){a[d]=_.bind(a[d],a)
});
_.extend(this,c);
this.listenTo(this.model,"inlinePageLoaded",this.onLoad)
},onLoad:function(a){var b=$("#message-list");
if(b.length){this.setElement("#message-list");
LI.Inbox.Util.formatTime(b);
LI.Inbox.Util.setCounts(b,this.model);
LI.Inbox.Util.updatePagination(b)
}else{this.undelegateEvents()
}},onInboxItemClick:function(d){var j=this,f=$(d.target),i=f.closest("li.inbox-item"),c=d.pageX,g=i.find("input").offset().left,b=g-(f.closest("li.inbox-item").find("div.date").offset().left+f.closest("li.inbox-item").find("div.date").width());
if(LI.Bidi){LI.Bidi.flip(function(){j.coordDiff=g-c
},function(){j.coordDiff=c-g
})
}else{j.coordDiff=g-c
}if(!f.is("a[data-action]")&&!f.is("input")&&(j.coordDiff>b)){d.preventDefault();
var h=i.find("a.detail-link"),a=h.attr("href");
if(a){this.model.set({switchContext:false});
if(h.hasClass("sponsored-inmail")){window.open(a,"_blank")
}else{window.location.href=a
}}}},onDetailLinkClick:function(a){this.model.set({switchContext:false})
},onFilterChange:function(c){var a=c.target.getAttribute("name").replace(/.*#/,""),b=(a.search(/subFilter=(\w+)/)>=0)?RegExp.$1:"";
LI.Inbox.Util.trackAction("list_view-filter",b,this.model.get("context").folder);
this.router.navigate(a,{trigger:true})
}})};LI.define("Inbox.Invitations");
LI.Inbox.Invitations={View:Backbone.View.extend({PARENT_LI_SELECTOR:"li.inbox-item.invitation-item",events:{"click .shared-connections":function(a){var b=$(a.target).parents(".shared-connection-block").find(".shared-connections-snack");
if(b.find("ul").length>0){b.toggle()
}else{this.fetchSharedConnections(b,function(){b.show()
})
}},"mouseover .shared-connections-snack a":function(a){this.sharedConnectionDetails(a,function(b){return b.find(".given-name").text()+" "+b.find(".family-name").text()
})
},"mouseout .shared-connections-snack a":function(a){this.sharedConnectionDetails(a,function(){return""
})
},"click .note-toggle":function(b){var a=$(b.target).parents("div.note"),c=a.parents(this.PARENT_LI_SELECTOR);
$summary=a.find(".summary-text");
if($summary.hasClass("truncated")){$summary.removeClass("truncated");
$(b.target).hide();
$(".note-toggle.full").show()
}else{$summary.addClass("truncated");
$(b.target).hide();
$(".note-toggle.summary").show()
}return false
},"click .mark-viewed":function(b){var a=$(b.target).data("url");
LI.RequestQueue.enqueue({method:"GET",url:a})
}},initialize:function(c){var a=this,b=_.functions(a);
_.each(b,function(d){a[d]=_.bind(a[d],a)
});
_.extend(this,c);
this.listenTo(this.model,"inlinePageLoaded",this.onLoad)
},sharedConnectionDetails:function(e,b){var a=$(e.target).parents("a");
var d=b(a);
var c=a.parents(".pictures").next();
c.text(d)
},fetchSharedConnections:function(e,d){var f=e.parents(this.PARENT_LI_SELECTOR);
var b=e.data("connections").toString().replace(/ /g,""),c=e.data("see-all-url"),a=e.data("see-all-text");
f.find(".shared-connections-snack .pictures").load("/search/sconns?sharedConnIds="+b,function(){var g=$(this).find("ul"),h=g.children();
if(h.size()>8){_.each(h.slice(8),function(j){$(j).remove()
});
g.append('<li class="see-all-shared"><a class="arrow-right" href="'+c+'">'+a+"</a></li>")
}f.find(".pictures img.photo").each(function(j,k){k.title=k.alt
});
if(d){d()
}})
},onLoad:function(c){var b=$("#invitations");
if(b.length){LI.Inbox.Util.setCounts(b,this.model);
LI.Inbox.Util.updatePagination(b);
this.setElement("#invitations");
var a=this;
$(".pymk").load("/pymk",function(){$(".pymk").each(function(d,f){if($(f).find("li.vcard").length>0){$(f).show();
LI.PymkRiver(f)
}})
});
$(".abook-promo").each(function(d,f){LI.Controls.parseFragment(f)
});
LI.Inbox.Util.formatTime($(this.el).find(".inbox-list"));
if(c.successMsg!==null){a.alert.show("success",c.successMsg,true)
}}else{this.undelegateEvents()
}}})};LI.define("Inbox.Sidebar");
LI.Inbox.Sidebar={View:Backbone.View.extend({el:".sidebar",events:{"click .search-button":"search","submit":"search","click a":"onLinkClick"},initialize:function(b){_.extend(this,b);
LI.Inbox.Util.initGhostLabels();
this.messagesSidebar=$("#sidebar").find("li.nav-messages a");
this.invitationsSidebar=$("#sidebar").find("li.nav-invitations a");
this.searchInput=$(".search-inbox").find(".search-keywords");
this.searchButton=$(".search-inbox").find(".search-button");
var a=this;
this.listenTo(this.model,"inlinePageLoaded",this.highlightSidebar);
this.listenTo(this.model,"change:counts",this.updateCounts);
this.searchInput.on("focus",function(){a.searchButton.addClass("focus")
}).on("focusout",function(){a.searchButton.removeClass("focus")
})
},highlightSidebar:function(b){var d=b.page;
var a=this.model.get("context");
var c=this.model.get("prefix");
$("li.active").removeClass("active");
if(LI.Inbox.Util.isComposePage(c,d)||LI.Inbox.Util.isDetailPage()){$("div.compose").removeClass("primary");
$("div.compose-new").removeClass("primary")
}else{$("div.compose").addClass("primary");
$("div.compose-new").addClass("primary");
$("li.nav-"+a.folder).addClass("active")
}},updateCounts:function(){var a=this,c=a.model.get("counts"),d=c.messages?"("+c.messages+")":"",b=c.invitations?"("+c.invitations+")":"";
this.messagesSidebar.find("span.count").html(d);
this.invitationsSidebar.find("span.count").html(b)
},search:function(c){c.preventDefault();
var a=this;
var b=$.trim($(".search-keywords").val());
if(b){LI.Inbox.Util.submitFormAjax("#inbox-search-form",{beforeSendFunction:function(d){d.setRequestHeader("X-IsAJAXForm",1);
d.setRequestHeader("timeZone",a.timeZone)
}}).always(function(d){if(d&&d.status&&d.status.toUpperCase()==="OK"){$("#content").replaceWith($("#content",d.content));
a.router.navigate("search?keywords="+b,{trigger:false});
LI.Inbox.Model.instance.onDataReady("inbox/","search")
}})
}},onLinkClick:function(c){var b=$(c.target).closest("a").attr("href");
var a=b.replace(/^.*#/,"");
if(a===Backbone.history.fragment){c.preventDefault();
LI.Inbox.Model.instance.cache.removeContent(this.model.get("prefix"),this.model.get("page"));
LI.Inbox.Model.instance.onPageChange()
}}})};LI.define("Inbox.MessageDetail");
LI.Inbox.MessageDetail={View:Backbone.View.extend({events:{"click .pre-icon":"onPrev","click .next-icon":"onNext","click .back-folder":"onBackFolder","click li[data-url]":"onAction","click .split-dropdown a":"onAction","click .on-action":"onAction","click .notInterestedBtn":"onNotInterested","click .proposal-cancel":"onProposalCancel","click .send-rejection":"sendRejection","change #decline-list input":"onSelectReason","click .attachment-item":"onAttachmentItem",'submit form[name="reject_proposal_no_ref"]':"submitRejectForm"},initialize:function(a){_.bindAll(this,"onLoad","initDiscovery","initRightRailGraph","initNav","onAction","getCurrentItemId","onPrev","onNext","next","onBackFolder","onNotInterested","submitRejectForm","onSelectReason","onProposalCancel","sendRejection","getContextUrl","onAttachmentItem","downloadAttachment","displayAttachmentErrorMsg");
_.extend(this,a);
this.listenTo(this.model,"inlinePageLoaded",this.onLoad)
},onLoad:function(d){var f=$(".inbox-item-detail");
if(f.length){var g=this.getCurrentItemId(),c=this.getContextUrl(g),a=this.model.cache.getContent("inbox/",c),b=$("a.markRead");
if(a&&b){var e=a.find("ol.inbox-list > li[data-gid="+g+"]");
if(e.hasClass("unread")){e.removeClass("unread");
LI.Inbox.Util.decrementCounts(1);
if(b.length&&this.model.get("enablePreload")){$.ajax({type:"POST",url:b.attr("href"),beforeSend:function(h){h.setRequestHeader("X-IsAJAXForm",1)
}})
}}}$(".inbox-item-body").focus();
this.setElement(".inbox-item-detail");
this.initDiscovery();
this.initRightRailGraph();
this.initNav();
this.initTooltips();
LI.Inbox.Util.setCounts(f,this.model);
if(LI.getQueryStringParam("rej")==="true"){this.onNotInterested()
}$(".attachment-error").each(function(h,j){LI.Controls.parseFragment(j)
})
}else{$(".graph-right-mail").remove();
this.undelegateEvents()
}},initDiscovery:function(){var a,e,b,d,h,c,g="discovery-prev",f="discovery-next";
a=document.getElementById("common-connections");
b={navPrevious:g,navNext:f,itemWidth:60,numVisible:1};
h=new LI.Discovery(a,b);
e=document.getElementById("common-company-connections");
d={navPrevious:g,navNext:f,itemWidth:60,numVisible:3};
c=new LI.Discovery(e,d)
},initRightRailGraph:function(){var b=$(".extra");
b.find(".graph-right-mail").remove();
var a=$(".graph-right-mail");
if($.trim(a.html())!==""){b.prepend(a)
}},initNav:function(){var a=this.model.cache.getRow(this.getCurrentItemId()),b=this.model.get("context").count;
if(a&&b&&a===1){$(".pre-icon").hide();
$(".next-icon").show()
}else{if(a&&b&&a===b){$(".next-icon").hide();
$(".pre-icon").show()
}else{$(".pre-icon, .next-icon").show()
}}},initTooltips:function(){var a=$("#more-info-sponsored-hovercard-trigger"),b;
if(a.length){b=new LI.Tooltip(a,{direction:"left",type:"hovercard",offsetX:5,tooltipContentID:"more-info-sponsored-hovercard"})
}},onAction:function(d){var c=$(d.target),b,a;
if(!c.is("a")&&c.parents("a").length){c=c.parents("a")
}b=c.attr("href")||c.data("url")||c.closest("li[data-url]").data("url"),a=this;
if(b&&b.indexOf("#")<0){d.preventDefault();
LI.Inbox.Util.sendAjax(b,{beforeSendFunction:function(e){e.setRequestHeader("X-IsAJAXForm",1)
},isQueue:true}).always(function(f){if(f&&f.content&&f.status&&f.status.toUpperCase()==="OK"){var g=$(f.content).find(".alert");
var h=g?g.find("p").text():null;
if(h){var e=g.hasClass("success")?"success":"failure";
a.alert.show(e,h,false)
}a.model.cache.clearContent();
a.next(true)
}})
}},getCurrentItemId:function(){var a=this.model.get("page");
return(a.search(/itemI[dD]=([\w_]+)/)>=0)?RegExp.$1:null
},onPrev:function(a){a.preventDefault();
var c=this.getCurrentItemId(),b=this;
if(c){this.model.cache.getPrevious(c,function(d){if(d){b.model.set({switchContext:false});
b.router.navigate(d,{trigger:true})
}})
}},onNext:function(a){a.preventDefault();
var b=this.getCurrentItemId();
this.next()
},next:function(c){var b=this.getCurrentItemId();
var a=this;
if(b){this.model.cache.getNext(b,function(d){if(d){a.model.set({switchContext:false});
a.router.navigate(d,{trigger:true})
}else{if(c){a.onBackFolder();
a.model.cache.remove(b)
}}})
}},onBackFolder:function(){var b=this.getCurrentItemId();
if(b){var a=this.getContextUrl(b);
if(!a){a=this.model.get("context").folder||"messages"
}this.router.navigate(a,{trigger:true})
}},onNotInterested:function(){var c=$(".notInterestedSection"),b=$(".notInterestedBtn"),d=$(".inbox-item-body-primary"),a=this;
if(b.hasClass("has-been-clicked")){d.hide(0,function(){c.show()
})
}else{window.setTimeout(function(){LI.Inbox.Util.toggleProgressIndicator(true);
d.hide(0,function(){var e=b.attr("reject-url")+"&nrd=true";
c.show();
c.load(e,function(g,f){if(f==="error"){h.hide(0,function(){d.show()
})
}b.addClass("has-been-clicked");
var h=$(".notInterestedSection");
h.find(".send-rejection").attr("disabled","true");
LI.Inbox.Util.toggleProgressIndicator(false)
})
})
},0)
}},submitRejectForm:function(b){b.preventDefault();
var a=this;
LI.Inbox.Util.submitFormAjax('form[name="reject_proposal_no_ref"]').done(function(e){a.model.cache.clearContent();
a.router.navigateBack();
if(e&&e.status&&e.status.toUpperCase()==="OK"&&e.content&&/global-error/.test(e.content)){var d=e.content.replace(/\s/g," ");
var c=/global-error.*?<strong>(.*?)<\/strong>/.exec(d);
if(c.length>1){a.alert.show("success",c[1],false)
}}})
},onSelectReason:function(){var a=$(".notInterestedSection");
a.find(".send-rejection").removeAttr("disabled")
},onProposalCancel:function(){$(".notInterestedSection").hide(0,function(){$(".inbox-item-body-primary").show()
})
},sendRejection:function(){LI.Inbox.Util.toggleProgressIndicator(true)
},getContextUrl:function(g){var f=this.model.cache.getRow(g);
var d=this.model.get("context");
var a=d.pageSize;
if(f){var b=Math.floor((f-1)/a)*a+1;
var c=d.folder;
var e="";
if(d.filter!==""&&d.filter!=="none"){e+=("&subFilter="+d.filter)
}if(d.keywords!==""){e+=("&keywords="+d.keywords)
}if(b!==1){e+=("&startRow="+b)
}if(e!==""){c+=("?"+e.substr("&".length))
}return c
}return null
},onAttachmentItem:function(a){var b=$(a.target).closest(".attachment-item");
if(b.attr("data-status")){a.preventDefault();
this.downloadAttachment(b,this.getCurrentItemId(),0)
}},downloadAttachment:function(b,e,d){var a=this;
var c=3;
$.ajax({url:b.attr("data-status"),success:function(f){if(e===a.getCurrentItemId()){var g=f.content.data.status;
if(g==="UNSAFE_CONTENT"||g==="VIRUS_DETECTED"){b.find(".attachment-link").removeAttr("href").addClass("disable-anchor");
b.find(".attachment-scan").hide();
b.find(".attachment-error").css("display","block")
}else{if(g==="VIRUS_NOT_DETECTED"){b.find(".attachment-scan").hide();
window.location.href=b.find("a").attr("href")
}else{if(g==="SCANNING"){b.find(".attachment-scan").show();
if(d<=c){window.setTimeout(function(){a.downloadAttachment(b,e,d+1)
},2000)
}else{a.displayAttachmentErrorMsg(b)
}}}}}},error:function(){if(d<=c){window.setTimeout(function(){a.downloadAttachment(b,e,d+1)
},2000)
}else{a.displayAttachmentErrorMsg(b)
}}})
},displayAttachmentErrorMsg:function(a){a.find(".attachment-link").removeAttr("href").addClass("disable-anchor");
a.find(".attachment-scan").hide();
a.find(".attachment-error").css("display","block")
}})};LI.define("Inbox.Props");
LI.Inbox.Props={View:Backbone.View.extend({el:".props-container",DISMISS_ACTION:"dismiss",PROFILE_ACTION:"profile",CLICK_ACTION:"action",IMPRESSION_ACTION:"impression",propsLimit:3,has_loaded:false,stubSample:{sessionId:null,impression:[],action:[],dismiss:[],profile:[]},currentTrackingObj:{},trackingTimeOut:{},events:{"click .remove-icon":"dismiss","click .send-message":"clickLinks","click a img":"clickProfileLinks","click .name":"clickProfileLinks"},initialize:function(){_.bindAll(this,"dismiss","render","showNextProp","i18nName","truncate","onLoad","closeContainer","openContainer","sendTrackingInfo","clickLinks","clickProfileLinks");
this.propsLimit=parseInt(this.options.propsLimit)||this.propsLimit;
this.listenTo(this.model,"inlinePageLoaded",this.onLoad)
},onLoad:function(){var a=this.model.get("page").split("?")[0];
if(a==="messages"){if(!this.has_loaded){this.getProps();
this.has_loaded=true
}else{}}else{this.has_loaded=false;
this.closeContainer()
}},sendTrackingInfo:function(b,c){var a=this;
if(_.isEmpty(this.currentTrackingObj)){$.extend(true,this.currentTrackingObj,this.stubSample)
}this.currentTrackingObj[c].push(b);
window.clearTimeout(this.trackingTimeOut);
this.trackingTimeOut=window.setTimeout(function(){_.each(a.currentTrackingObj,function(e,d){a.currentTrackingObj[d]=JSON.stringify(e)
});
$.ajax({url:"/inbox/props-tracking",beforeSend:function(d){d.setRequestHeader("X-IsAJAXForm",1)
},data:a.currentTrackingObj,type:"POST"});
a.currentTrackingObj={}
},200)
},closeContainer:function(){this.undelegateEvents();
$(".props-container").empty().removeClass("open")
},removeContainer:function(){this.undelegateEvents();
$(".props-container").empty().remove()
},openContainer:function(a){this.delegateEvents();
$(".props-container").append(a).addClass("open")
},getProps:function(){var a=this;
$.ajax({url:"/inbox/props",beforeSend:function(b){b.setRequestHeader("X-IsAJAXForm",1)
}}).always(function(b){if(b&&b.content&&b.status&&b.status.toUpperCase()==="OK"){a.stubSample.sessionId=b.content.data.sessionId;
if(b.content.data&&b.content.data.props&&b.content.data.props.length>0){a.render(b.content.data)
}}})
},i18nName:function(b,a){var d="<a class='name' href='"+dust.escapeHtml(b)+"'>"+dust.escapeHtml(a)+"</a>",c=LI.Inbox.Util.getI18nString("propHappyBirthdayName"),c=c.replace("{:0}",d);
return c
},truncate:function(c,d){var b=c.length>d,a=b?c.substr(0,d-1):c;
a=b?a.substr(0,a.lastIndexOf(" ")):a;
return b?a+"&nbsp;&hellip;":a
},dismiss:function(a){var b=this;
this.sendTrackingInfo($(a.target).parents("li").data(),this.DISMISS_ACTION);
$(a.target).parents("li").animate({height:"0",opacity:"0",queue:false},"1000",function(){$(this).remove();
if(b.$el.find(".props-people").children("li").length===0){b.closeContainer();
b.removeContainer()
}});
this.showNextProp()
},showNextProp:function(){var b=this,a=b.$el.find(".prop-hidden:eq(0)");
this.sendTrackingInfo(a.data(),this.IMPRESSION_ACTION);
a.slideDown({duration:"500",queue:false,complete:function(){a.removeClass("prop-hidden")
}})
},clickLinks:function(a){var b=this;
this.sendTrackingInfo($(a.target).parents("li").data(),this.CLICK_ACTION)
},clickProfileLinks:function(a){var b=this;
this.sendTrackingInfo($(a.target).parents("li").data(),this.PROFILE_ACTION)
},render:function(g){var b=this;
var d=LI.Inbox.Util.encodeUrl(LI.Inbox.Util.getI18nString("propsCongrats"));
var e={text_start_conversation:LI.Inbox.Util.getI18nString("propsInboxStartConversation")},c={text_remove_prop:LI.Inbox.Util.getI18nString("propsDismiss"),text_say_congrats:LI.Inbox.Util.getI18nString("propsSayCongrats"),text_congrats:d},a={text_remove_prop:LI.Inbox.Util.getI18nString("propsDismiss"),text_say_happy_birthday:LI.Inbox.Util.getI18nString("propsSayHappyBirthday"),text_happy_birthday:LI.Inbox.Util.getI18nString("propHappyBirthday"),text_congrats:d},f={text_remove_prop:LI.Inbox.Util.getI18nString("propsDismiss"),text_reach_out:LI.Inbox.Util.getI18nString("propsReachOut"),text_congrats:d},h={text_remove_prop:LI.Inbox.Util.getI18nString("propsDismiss"),text_say_congrats:LI.Inbox.Util.getI18nString("propsSayCongrats"),text_congrats:d};
this.$el.hide();
dust.render("props",{},function(j,i){if(!j){b.openContainer(i)
}});
dust.render("props",$.extend({},g,e),function(j,i){if(!j){b.$el.html(i)
}});
_.each(g.props,function(j,t,u){var y=b.model.attributes.loginMember.name;
if(t>b.propsLimit-1){j=$.extend({},j,{hiddenClass:"prop-hidden"})
}if(j.type==="JOB_CHANGE"){var n=b.truncate(LI.Inbox.Util.encodeHTMLOnce(j.target.headline),50),x=LI.Inbox.Util.i18nReplace([j.target.profileUrl,LI.Inbox.Util.encodeHTMLOnce(j.target.fullName),n],LI.Inbox.Util.getI18nString("propsHasNewJobText")),r=LI.Inbox.Util.encodeUrl(LI.Inbox.Util.i18nReplace([j.target.fullName,y],LI.Inbox.Util.getI18nString("propJobChangeMessage")));
dust.render("new_job",$.extend({},j,c,b.options,{"resolvedHeadlineTruncate":x,"new_job_msg":r}),function(A,z){if(!A){$(".props-people").append(z)
}})
}else{if(j.type==="BIRTHDAY"){var p=b.i18nName(j.target.profileUrl,j.target.fullName),s=j.date,q=LI.Inbox.Util.encodeUrl(LI.Inbox.Util.i18nReplace([j.target.fullName,y],LI.Inbox.Util.getI18nString("propBirthdayMessage")));
dust.render("happy_birthday",$.extend({},j,a,b.options,{"i18nUrlResolvedName":p},{"resolvedBirthDate":s,"happy_birthday_msg":q}),function(A,z){if(!A){$(".props-people").append(z)
}})
}else{if(j.type==="NEWS_ABOUT_NETWORK"){var w=j.details.articles[0].url,i=b.truncate(j.details.articles[0].summary,40),k=LI.Inbox.Util.i18nReplace([j.target.profileUrl,LI.Inbox.Util.encodeHTMLOnce(j.target.fullName),w,i],LI.Inbox.Util.getI18nString("propsInTheNews")),v=LI.Inbox.Util.encodeUrl(LI.Inbox.Util.i18nReplace([j.target.fullName,j.details.articles[0].url,y],LI.Inbox.Util.getI18nString("propNewsMentionMessage")));
dust.render("in_the_news",$.extend({},j,f,b.options,{"resolvedInTheNewsHeadline":k},{"resolvedInTheNewsLink":w,"news_mention_msg":v}),function(A,z){if(!A){$(".props-people").append(z)
}})
}else{if(j.type==="WORK_ANNIVERSARY"){var o=LI.Inbox.Util.i18nReplace([j.target.profileUrl,LI.Inbox.Util.encodeHTMLOnce(j.target.fullName),LI.Inbox.Util.encodeHTMLOnce(j.details.companyName)],LI.Inbox.Util.getI18nString("propWorkAnniversaryHeadline"));
if(b.options.englishWorkAnniversary&&parseInt(j.details.years)>1){o=["<a href='",j.target.profileUrl,"&trk=inbox_messages-comm-props_anniversary-prof_name' class='name'>",LI.Inbox.Util.encodeHTMLOnce(j.target.fullName),"</a>"," is celebrating ",j.details.years," years at ",LI.Inbox.Util.encodeHTMLOnce(j.details.companyName)].join("")
}else{if(b.options.englishWorkAnniversary&&parseInt(j.details.years)===1){o=["<a href='",j.target.profileUrl,"&trk=inbox_messages-comm-props_anniversary-prof_name' class='name'>",LI.Inbox.Util.encodeHTMLOnce(j.target.fullName),"</a>"," is celebrating 1 year at ",LI.Inbox.Util.encodeHTMLOnce(j.details.companyName)].join("")
}}var m=b.truncate(o,500),l=LI.Inbox.Util.encodeUrl(LI.Inbox.Util.i18nReplace([j.target.fullName,y],LI.Inbox.Util.getI18nString("propWorkAnniversaryMessage")));
dust.render("work_anniversary",$.extend({},j,h,b.options,{"i18nWorkAnniversaryHeadline":m,"work_anniversary_msg":l}),function(A,z){if(!A){$(".props-people").append(z)
}})
}}}}});
this.$el.find(".props-people > li:lt("+this.propsLimit+")").each(function(i,j){b.sendTrackingInfo($(j).data(),b.IMPRESSION_ACTION)
});
this.$el.slideDown("slow")
}})};LI.define("Inbox.Promo");
LI.Inbox.Promo={PromoModel:Backbone.Model.extend({displayThreshold:20,url:"/inbox/promo",initialize:function(a){this.inboxData=a.inboxData;
this.inboxModel=a.inboxData.model;
this.displayPromoOption=a.showPromoSlot;
_.bindAll(this,"parse","getData","displayPromoXPercentage");
this.listenTo(this.inboxModel,"messageSuccessful",this.getData)
},getData:function(d){var b=this;
if(d&&d.recipientId){this.set({recipient:_.extend({},this.get("recipient"),{id:d.recipientId})});
if(this.displayPromoOption===true||(typeof this.displayPromoOption==="number"&&this.displayPromoXPercentage())){var a={data:{recipientIds:b.get("recipient").id}},c={model:b,inboxData:b.inboxData};
this.fetch(a).done(function(e){if(b.get("type")==="ABOOK"){return new PromoAbookView(c)
}else{if(b.get("type")==="PYMK"){return new PromoPYMKView(c)
}}})
}}},parse:function(a){return _.extend({},this.attributes,a.content.data)
},displayPromoXPercentage:function(){return Math.ceil(Math.random()*100)<=this.displayPromoOption
}}),PromoBaseView:Backbone.View.extend({InboxData:null,model:null,isDataReady:false,hasMessageSent:false,DISMISS_ACTION:"dismiss",IMPRESSION_ACTION:"impression",CLICK_ACTION:"action",trackingStub:{sessionId:null,impression:[],action:[],dismiss:[]},trackingInfo:{location:"MessagesList",promoType:null},currentTrackingObj:{},trackingTimeout:{},promoTrackingEndpt:"/inbox/promo-tracking",initialize:function(a){this.InboxData=a.inboxData;
this.model=a.model;
this.trackingInfo.promoType=this.model.get("type");
this.trackingStub.sessionId=this.model.get("sessionId");
_.bindAll(this,"remove","onClickRemovePromo","renderThenTransition","sendTrackingInfo","renderDust");
this.listenTo(this.InboxData.model,"inlinePageLoaded",this.renderThenTransition())
},renderThenTransition:function(){var b=this;
b.currentTrackingObj={};
var a=b.render();
if(a){setTimeout(function(){b.$el.find(".promo-transition").addClass("promo-item")
},500);
this.sendTrackingInfo($.extend({},this.trackingInfo),this.IMPRESSION_ACTION)
}},renderDust:function(b,c,d){var a=this;
dust.render(b,c,function(f,e){a.setElement("#pagekey-inbox-skeleton #message-list .inbox-list");
a.$el.prepend(e);
$("#content").on("click",".closeX",a.onClickRemovePromo);
if(d&&_.isFunction(d)){d.call(a,f,e)
}})
},remove:function(){$("#content").off("click",".closeX",self.onClickRemovePromo);
this.$el.find(".promo-transition").remove()
},onClickRemovePromo:function(b){var a=this;
this.$el.find(".promo-transition").removeClass("promo-item");
this.$el.one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){a.remove()
});
this.sendTrackingInfo($.extend({},this.trackingInfo),this.DISMISS_ACTION)
},sendTrackingInfo:function(b,c){var a=this;
if(_.isEmpty(this.currentTrackingObj)){$.extend(true,this.currentTrackingObj,this.trackingStub)
}this.currentTrackingObj[c].push(b);
_.each(a.currentTrackingObj,function(e,d){a.currentTrackingObj[d]=JSON.stringify(e)
});
return $.ajax({url:a.promoTrackingEndpt,beforeSend:function(d){d.setRequestHeader("X-IsAJAXForm",1)
},data:a.currentTrackingObj,type:"POST"}).always(function(){a.currentTrackingObj={}
})
}})};
var PromoAbookView=LI.Inbox.Promo.PromoBaseView.extend({BaseView:LI.Inbox.Promo.PromoBaseView.prototype,initialize:function(){_.bindAll(this,"render","onClickAction","remove");
this.BaseView.initialize.apply(this,arguments)
},render:function(){if(this.model.get("numOfConnections")>=4){var a=this,c={},b=[this.model.get("recipient").profileUrl,LI.Inbox.Util.encodeHTMLOnce(this.model.get("recipient").familiarName)];
c={promoAbookText:LI.Inbox.Util.i18nReplace(b,LI.Inbox.Util.getI18nString("promoGrowYourNetwork")),linkText:LI.Inbox.Util.getI18nString("promoAbookActionText")};
this.BaseView.renderDust.call(a,"tl/apps/inbox/partial/promo/image_grid",$.extend({},this.model.attributes,c),function(e,d){$("#content").on("click",".infoAction",a.onClickAction)
});
return this.$el
}},onClickAction:function(b){b.preventDefault();
var c=$(b.target);
var a=c.attr("href");
this.BaseView.sendTrackingInfo($.extend({},this.BaseView.trackingInfo),this.BaseView.CLICK_ACTION);
window.location.href=a
},remove:function(){$("#content").off("click",".infoAction",self.onClickAction);
this.BaseView.remove.call(this)
}});
var PromoPYMKView=LI.Inbox.Promo.PromoBaseView.extend({BaseView:LI.Inbox.Promo.PromoBaseView.prototype,initialize:function(){_.bindAll(this,"render","onClickAction","remove");
this.BaseView.initialize.apply(this,arguments)
},render:function(){if(this.model.get("numOfConnections")>=4){var b=this,e={},a=_.map(this.model.get("connections"),function(f){return LI.Inbox.Util.encodeHTMLOnce(f.familiarName)
});
var d=[this.model.get("recipient").profileUrl].concat(LI.Inbox.Util.encodeHTMLOnce(this.model.get("recipient").familiarName),a);
var c=[this.model.get("recipient").familiarName];
e={promoPYMKText:LI.Inbox.Util.i18nReplace(d,LI.Inbox.Util.getI18nString("promoConnectWithNameAndXOthers")),linkText:LI.Inbox.Util.i18nReplace(c,LI.Inbox.Util.getI18nString("promoPYMKActionText"))};
this.BaseView.renderDust.call(b,"tl/apps/inbox/partial/promo/image_grid",$.extend({},this.model.attributes,e),function(g,f){$("#content").on("click",".infoAction",b.onClickAction)
});
return this.$el
}},onClickAction:function(b){b.preventDefault();
var c=$(b.target);
var a=c.attr("href");
this.BaseView.sendTrackingInfo($.extend({},this.BaseView.trackingInfo),this.BaseView.CLICK_ACTION);
window.location.href=a
},remove:function(){$("#content").off("click",".infoAction",self.onClickAction);
this.BaseView.remove.call(this)
}});LI.ZeppelinForm=function(X,N){var N={passwordResolutionUrl:N.passwordResolutionUrl||"",formID:N.formID||"nwmi-form",formImportMessageID:N.formImportMessageID||"import_msg",formEmailInputID:N.formEmailInputID||"email-nWMIForm",formEmailInputName:N.formEmailInputName||"",formEmailProgressID:N.formEmailProgressID||"wmi_progress",formPasswordDivID:N.formPasswordDivID||"pswd-div",formUsernameDivID:N.formUsernameDivID||"email-username",formSubmitButtonID:N.formSubmitButtonID||"resolve-btn",webmailAddrElId:N.webmailAddrElId||"webmail-addr",formDisclaimerMessageID:N.formDisclaimerMessageID||"disclaimer_msg",openInPopup:N.openInPopup||false,popupUrl:N.popupUrl||"",successUrl:N.successUrl||"",newGoBackValue:N.newGoBackValue||null,successMonitorUrl:N.successMonitorUrl||null,authOnlySuccessUrl:N.authOnlySuccessUrl||"",controlNameOverride:N.controlNameOverride||null,progressMessage:N.progressMessage||"",errorMessage:N.errorMessage||null,invalidEmailMessage:N.invalidEmailMessage||"",generalErrorMessage:N.generalErrorMessage||"",invalidLoginMessage:N.invalidLoginMessage||"",unsupportedEmailTypeMessage:N.unsupportedEmailTypeMessage||"",loginLimitMessage:N.loginLimitMessage||"",noContactsReturnedMessage:N.noContactsReturnedMessage||"",webmailUrlErrorMessage:N.webmailUrlErrorMessage||"",userEnteredWebmailUrlErrorMessage:N.userEnteredWebmailUrlErrorMessage||"",quickResolveDomains:{},domainPopupSizes:{"hotmail.com":{width:905,height:580},"live.com":{width:905,height:580},"msn.com":{width:905,height:580},"aol.com":{width:520,height:315},"default":{width:790,height:580}},exception:{},isPromo:N.isPromo||false,providerNameFieldID:N.providerNameFieldID||"",providerNameFieldName:N.providerNameFieldName||"",importerNameFieldID:N.importerNameFieldID||"",importerNameFieldName:N.importerNameFieldName||"",useGenieFieldID:N.useGenieFieldID||"",useGenieFieldName:N.useGenieFieldName||"",useZeppelinXFieldName:N.useZeppelinXFieldName||"",defaultProviderFieldName:N.defaultProviderFieldName||"",usernameFieldId:N.usernameFieldId||"",usernameFieldName:N.usernameFieldName||"",originNameFieldName:N.originNameFieldName||"",referrerFieldName:N.referrerFieldName||"referrer_alias",hasWebmailField:N.hasWebmailField||false,fandangoParam:N.fandangoParam||"fandango",importerProviderParam:N.importerProviderParam||"importerProvider",authOnly:N.authOnly||false,formTarget:N.formTarget||"zeppelin_popup",eventNotify:N.eventNotify||false,hidePopupForExchangeIMAP:N.hidePopupForExchangeIMAP||false,userEnteredEmailTrackingCode:N.userEnteredEmailTrackingCode||"",userChangedEmailTrackingCode:N.userChangedEmailTrackingCode||"",webmailURLPromptedTrackingCode:N.webmailURLPromptedTrackingCode||"",extraParamsFunc:N.extraParamsFunc||null,hidePasswordInit:N.hidePasswordInit||false,externalErrContainerId:N.externalErrContainerId||"",skipInitialResolve:N.skipInitialResolve||false,origins:N.origins||[],isNewAddConnectionsFlow:N.isNewAddConnectionsFlow||false,isGlobalNav:N.isGlobalNav||false,isNewLegalese:N.isNewLegalese||false,oauthAbookImportLegaleseId:N.oauthAbookImportLegaleseId||"",notOauthAbookImportLegaleseId:N.notOauthAbookImportLegaleseId||""},Z=null,s=null,E="",d="",ab=N.domainPopupSizes,u=ab["default"],J=u.width,S=u.height,e=new YAHOO.util.CustomEvent("error"),Q=new YAHOO.util.CustomEvent("emailResolved"),b=new YAHOO.util.CustomEvent("displayMsg"),l=YDom.get(N.formID),y=YDom.get(N.externalErrContainerId),L=Y$(".alt_unsupported_msg",y?y:l,true),O=YDom.get(N.formSubmitButtonID),aa=YDom.get(N.formImportMessageID),t=(N.formEmailInputName)?l[N.formEmailInputName]:YDom.get(N.formEmailInputID),G=(t)?t.value:"",M=YDom.getElementsByClassName("username-suggestion"),g=null,ac=(N.formEmailInputName)?l[N.formEmailInputName]:YDom.get(N.formEmailInputID),H=YDom.get(N.formPasswordDivID),m=Y$("input",H,true),h=YDom.get(N.webmailAddrElId),B=Y$("input",h,true),n=YDom.get("promo-subhead")||null,r=YDom.get("zeppelin-loading"),i="loading",W="error",U=false,R=("placeholder" in document.createElement("input")),I,T,z,c,w,f,v;
if(N.isNewLegalese){if(!N.hidePasswordInit){LI.show(N.notOauthAbookImportLegaleseId);
LI.hide(N.oauthAbookImportLegaleseId)
}else{LI.hide(N.notOauthAbookImportLegaleseId);
LI.show(N.oauthAbookImportLegaleseId)
}}N.useZeppelinXFieldNameOld=(N.useZeppelinXFieldName?N.useZeppelinXFieldName.replace("_","-"):"");
N.originNameFieldNameOld=(N.originNameFieldName?N.originNameFieldName.replace("_","-"):"");
if(N.newGoBackValue){f=new RegExp("[\\?&]goback=%2E([^&#]*)");
v=f.exec(N.successUrl);
N.successUrl=N.successUrl.replace(v[1],N.newGoBackValue)
}function k(){g=window.open("#",N.formTarget,"width="+J+",height="+S+",toolbar=0,location=0,toolbar=0,status=0,scrollbars=no")
}function a(ad){var ae=ad.split("@")[1];
if(ab[ae]){J=ab[ae].width;
S=ab[ae].height
}else{J=u.width;
S=u.height
}}function F(ad){var ae=ad.value;
if(!ae||(!R&&ae===ad.getAttribute("data-placeholder"))){setTimeout(function(){O.disabled=true
},0);
return false
}return true
}YEvent.on(M,"click",function(ad){var af=YDom.get(N.formUsernameDivID),ae=Y$("input",af,true);
if(af&&YDom.getStyle(af,"display")!=="none"){if(ae){ae.value=this.innerHTML
}YDom.removeClass(af,"hidden")
}});
var D=false;
YEvent.on(l,"submit",function(ad){var ak=Y$(".submit-spinner",l,true),af=ac.value;
if(D){YEvent.stopEvent(ad);
return
}D=true;
setTimeout(function(){D=false
},3000);
if(!ac.value){YEvent.stopEvent(ad);
return
}if(N.eventNotify){LI.ZeppelinFormInstance=null
}else{var aj=LI.Controls.getControl(l,N.controlNameOverride||"LI.ZeppelinForm");
LI.ZeppelinFormInstance=aj
}var ae,ah=l[N.originNameFieldName];
if(ah){ae=ah.value
}var ag=LI.Controls.getControl("addconnpolling","AddConnPolling");
if(!N.hidePopupForExchangeIMAP||(ae!=="webmailImportExchange"&&ae!=="webmailImportIMAP"&&!(YDom.hasClass(l,"async")))){YDom.setAttribute(l,"target",N.formTarget);
k()
}else{YDom.setAttribute(l,"target","LI_ifrm_abook_import_form_"+ae);
if(ag){ag.addAsync(ae);
ag.startAsyncTimer(ae)
}O.disabled=true;
if(ak){YDom.addClass(ak,"show");
if(LI.Events){var ai=function(){O.disabled=false;
YDom.removeClass(ak,"show");
LI.Events.unbind("add-conn-import-error",ai)
};
LI.Events.bind("add-conn-import-error",ai)
}}}LI.clearFormErrors(X);
aa.innerHTML="";
if(WebTracking){if(N.userEnteredEmailTrackingCode&&(G!=="")&&G!==af){WebTracking.trackUserAction(N.userEnteredEmailTrackingCode,{email:af,origin:ae})
}else{WebTracking.trackUserAction("fetch_import_start",{email:af,origin:ae})
}}});
YEvent.on(window,"unload",function(){if(g){g.close()
}});
w=N.extraParamsFunc||function(){return""
};
if(!N.isPromo){var q=null;
var I=function(ad){if(!ad||ad.value===E){return
}if(s!=null){window.clearTimeout(s);
s=null
}if(Z!=null){window.clearInterval(Z);
Z=null
}if(!ad.value){O.disabled=true
}E=YAHOO.lang.trim(ad.value);
if(!q){q=/^([a-zA-Z0-9_\-=\.\'\+]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,3})(\]?)$/i
}if(E.match(q)){Z=window.setInterval(function(){if(E===d){T(N)
}else{d=E
}},500)
}else{if(E.length>1){s=window.setTimeout(function(){var ae=N.invalidEmailMessage;
YDom.addClass(ad,W);
c(ae,false,N);
if(U){YDom.removeClass(r,i);
U=false
}},5000)
}else{if(U){YDom.removeClass(r,i);
U=false
}return
}}if(!U){YDom.addClass(r,i);
U=true
}O.disabled=true
};
T=function(){var af,ad,ai,aj;
LI.clearFormErrors(X);
if(L){YDom.addClass(L,"hidden")
}if(Z!=null){window.clearInterval(Z);
Z=null
}aa.innerHTML="";
YDom.removeClass(ac,W);
var ah=E.split("@")[1];
if(N.quickResolveDomains[ah]){af=N.quickResolveDomains[ah].domain;
ad=N.quickResolveDomains[ah].passwordRequired
}a(E);
function ae(ak){ag(ak.responseText)
}function ag(ak){var ay,az,aB,at,av,an,ar=false,am=E,aC=ak.origin,aA=l[N.originNameFieldName],al=l[N.originNameFieldNameOld],aq=YDom.get(N.formUsernameDivID),ap=(N.useGenieFieldName)?l[N.useGenieFieldName]:YDom.get(N.useGenieFieldID),aw=l[N.useZeppelinXFieldName],au=l[N.useZeppelinXFieldNameOld];
N.isEmailChanged=false;
if(s!=null){window.clearTimeout(s)
}if(U){YDom.removeClass(r,i);
U=false
}var ao=(N.importerNameFieldName)?l[N.importerNameFieldName]:YDom.get(N.importerNameFieldID),ax=(N.providerNameFieldName)?l[N.providerNameFieldName]:YDom.get(N.providerNameFieldID);
if(ao){if(ak.importerName){ao.value=ak.importerName
}else{ao.value=""
}}if(ax){if(ak.providerName){ax.value=ak.providerName
}else{ax.value=""
}}if(ak.error){WebTracking.trackUserAction("email-resolution-response-error");
c(N.generalErrorMessage);
return
}if(ak.email!==am){return
}if(ak.origin!==undefined){if(aA){aA.value=aC;
if(al){al.value=aC
}}if(N.formUsernameDivID){if(aq){if(aC==="webmailImportExchange"){YDom.removeClass(aq,"hidden");
LI.show(aq)
}else{YDom.addClass(aq,"hidden");
LI.hide(aq)
}}}}if(N.isNewAddConnectionsFlow){aB=N.formID;
if(aB&&(an=aB.lastIndexOf("-"))!==-1){av=aB.substring(an+1)
}if(av!==ak.origin&&aB.indexOf(ak.origin)===-1){if(av!=="anyemail"){ar=true
}else{for(ay=0,az=N.origins.length;
ay<az;
ay++){if(ak.origin===N.origins[ay]){ar=true;
break
}}}}}if(!(at=YDom.get("reimport-check-"+aC))){at=YDom.get("reimport-check-x-anyemail")
}if(N.isNewAddConnectionsFlow){if(!ar){if(ak.passwordRequired){LI.show(H);
LI.hide(at);
YDom.addClass(l,"async");
if(ap){ap.value=false
}if(N.isNewLegalese){LI.show(N.notOauthAbookImportLegaleseId);
LI.hide(N.oauthAbookImportLegaleseId)
}}else{LI.hide(H);
LI.show(at);
if(ap){ap.value=true
}if(N.isNewLegalese){LI.hide(N.notOauthAbookImportLegaleseId);
LI.show(N.oauthAbookImportLegaleseId)
}YDom.removeClass(l,"async")
}}}else{if(ak.passwordRequired){LI.show(H);
LI.hide(at);
if(ap){ap.value=false
}if(N.isNewLegalese){LI.show(N.notOauthAbookImportLegaleseId);
LI.hide(N.oauthAbookImportLegaleseId)
}}else{LI.hide(H);
LI.show(at);
if(ap){ap.value=true
}if(N.isNewLegalese){LI.hide(N.notOauthAbookImportLegaleseId);
LI.show(N.oauthAbookImportLegaleseId)
}}}if(ak.notSupported){x();
return
}if(ak.showPartnersNotice){LI.show(N.formDisclaimerMessageID)
}else{LI.hide(N.formDisclaimerMessageID)
}if(ak.rateLimit){c(N.loginLimitMessage);
return
}if(!N.hasWebmailField&&(ak.WEBMAIL_ADDRESS||ak.WEBMAIL_ADDRESS==="")){x();
return
}if(ak.ZEPPELINX_ROUTING){aw.value=ak.ZEPPELINX_ROUTING;
au.value=ak.ZEPPELINX_ROUTING
}else{YDom.setAttribute(aw,"value","false");
YDom.setAttribute(au,"value","false")
}if(N.isNewAddConnectionsFlow){if(ar){E=G
}}Q.fire(ak);
if(LI.Events&&!N.isGlobalNav){LI.Events.fire("zeppelin-form-email-resolved",ak,l,av)
}z()
}if(af){ai={"isCustomDomain":false,"type":af,"email":E,"passwordRequired":ad};
ag(ai)
}else{aj={custom:{exception:function(){return false
}},success:ae,failure:function(){ag({error:true})
}};
O.disabled=true;
LI.asyncRequest("GET",N.passwordResolutionUrl+"?email="+E+w(),aj)
}};
z=function(){if(ac.value&&((YDom.getStyle(H,"display")!=="none")?m.value:true)&&(h===null||((YDom.getStyle(h,"display")!=="none")?B.value:true))){O.disabled=false
}else{O.disabled=true
}};
d=ac.value;
if(!N.skipInitialResolve&&F(ac)){E=ac.value;
T(N)
}else{if(N.hidePasswordInit){LI.hide(H)
}else{LI.show(H)
}}YEvent.on(ac,"keyup",function(ad){I(YEvent.getTarget(ad))
});
YEvent.on([H,h],"keyup",z);
z();
if(LI.Events){LI.Events.bind("zeppelin-form-check-address",function(ad){if(ad===ac){I(ac)
}})
}YEvent.on(Y$(".change-email",l,true),"click",function(ad){YEvent.preventDefault(ad);
YDom.addClass(Y$(".email-display",l,true),"hidden");
YDom.removeClass(Y$(".email-address",l,true),"hidden");
if(WebTracking&&N.userChangedEmailTrackingCode){WebTracking.trackUserAction(N.userChangedEmailTrackingCode)
}})
}if(L){YEvent.on(Y$(".file_import_opener",l,true),"click",function(){LI.Events.fire("zeppelin-form-jump-to-file-upload")
})
}c=function(ah,ad){var af,ae,ag;
if(L){if(ah!==N.unsupportedEmailTypeMessage){YDom.addClass(L,"hidden")
}}if(ad){LI.injectAlert(ah,"success",N.formImportMessageID)
}else{e.fire();
af=N.formImportMessageID;
ae=(!af)?YDom.get("global-error"):YDom.get(af);
ae.innerHTML="";
ag="<span class='{type}'>{msg}</span>";
if(n){YDom.setStyle(n,"display","none");
n=null
}ah=LI.htmlEncode(ah);
ae.innerHTML=YAHOO.lang.substitute(ag,{msg:ah,type:"error"});
WebTracking.trackUserAction("display-error")
}b.fire()
};
function A(){if(g){g.focus();
setTimeout(function(){g.close()
},5)
}}function P(){A();
c(N.generalErrorMessage);
WebTracking.trackUserAction("general-error")
}function C(){A();
c(N.invalidLoginMessage);
WebTracking.trackUserAction("invalid-login-error")
}function j(){A();
c(N.noContactsReturnedMessage);
WebTracking.trackUserAction("no-contacts-returned-error")
}function x(){if(L){if(aa){aa.innerHTML=""
}YDom.removeClass(L,"hidden")
}else{c(N.unsupportedEmailTypeMessage);
YDom.addClass(ac,W)
}WebTracking.trackUserAction("email-resolution-unsupported-email-error")
}function Y(){A();
c(N.loginLimitMessage);
WebTracking.trackUserAction("login-limit-error")
}function V(){var ad=Y$("input",N.webmailAddrElId,true);
A();
if(N.webmailAddrElId){if(YDom.getStyle(YDom.get(N.webmailAddrElId),"display")==="none"){c(N.webmailUrlErrorMessage);
WebTracking.trackUserAction("webmail-url-error");
LI.show(N.webmailAddrElId);
if(ad){ad.value=""
}}else{c(N.userEnteredWebmailUrlErrorMessage);
WebTracking.trackUserAction("webmail-url-error")
}}}function p(ad,ae){if(WebTracking){WebTracking.trackUserAction("add_conn_client_success",{origin:ae,event:ad})
}if(N.successMonitorUrl){var af=l[N.referrerFieldName].value;
LI.asyncRequest("POST",N.successMonitorUrl,{custom:{error:function(ag){},exception:function(){return false
}}},"referrer="+af)
}}function o(ai,ae){A();
var af=l[N.originNameFieldName],ah=(N.providerNameFieldName)?l[N.providerNameFieldName]:YDom.get(N.providerNameFieldID),ag,ad;
if(af){ad=af.value
}if(N.authOnly&&N.authOnlySuccessUrl!==""){p("auth_only",ad);
window.location.href=N.authOnlySuccessUrl;
return
}if(ah){ag=ah.value
}if(N.successUrl.indexOf("?")<0){N.successUrl=N.successUrl+"?"
}if(ae){p("not_complete",ad);
window.location.href=N.successUrl+"&"+N.fandangoParam+"="+ae+"&"+N.importerProviderParam+"="+ag;
return
}p("success",ad);
window.location.href=N.successUrl+(ai?"&batchID="+ai:"")+(ag?"&"+N.importerProviderParam+"="+ag:"")+(ad?"&origin="+ad:"")
}function K(){return N.authOnly
}return{overrideDisplayMsg:function(ad){c=ad
},overrideGetExtraResolveEmailParams:function(ad){w=ad
},showGeneralError:P,showBadLoginError:C,showUnsupportedEmailError:x,showLoginLimitError:Y,showNoContactsReturnedError:j,showWebmailUrlErrorMessage:V,adjustPopupSize:a,openPopup:k,success:o,errorEvent:e,emailResolvedEvent:Q,displayMsgEvent:b,isAuthOnly:K,closePopup:true}
};LI.define("PymkRiver");
LI.PymkRiver=function(a,x){var o=this;
x=x||{};
x={riverHasDropList:(x.riverHasDropList===true)?true:false};
var k=0;
var s=false;
var g=true;
var j=false;
var e=[];
var w={};
this.onBeforeRowRemoved=new YAHOO.util.CustomEvent("beforeRowRemoved");
this.onRowRemoved=new YAHOO.util.CustomEvent("rowRemoved");
this.onRowAdded=new YAHOO.util.CustomEvent("rowAdded");
this.onNoMoreRows=new YAHOO.util.CustomEvent("noMoreRows");
this.onErrorMessageReceived=new YAHOO.util.CustomEvent("errorMessageReceived");
function n(i){return Y$("li.vcard.extra-row:first",i,true)
}function q(i){return Y$("li.vcard.extra-row",i)
}function v(){return Y$("li.vcard:not(.extra-row)",a)
}function y(){return Y$("li.vcard",a)
}function p(){if(!j){YDom.setStyle(a,"height",YDom.getStyle(a,"height"));
j=true
}}function t(){var i=v();
if(j&&!s&&(k==i.length||!g)){YDom.setStyle(a,"height","");
j=false
}}function z(A){YEvent.stopEvent(A);
var i=YEvent.getTarget(A);
if(!YDom.hasClass(i,"remove-row")||!i.nodeName=="A"){return
}var B=YDom.getAncestorByClassName(i,"vcard");
l(B)
}function l(B,i){var D=B,A=i||Y$(".remove-row",B)[0].href;
if(YDom.hasClass(D,"removing-row")){return
}YDom.addClass(D,"removing-row");
o.onBeforeRowRemoved.fire(D);
p();
e.push(A);
d();
var C=new YAnim(D,{opacity:{to:0}},0.3);
C.onComplete.subscribe(function(){YDom.setStyle(D,"height",D.clientHeight);
YDom.setStyle(D,"min-height","0");
var E=new YAnim(D,{height:{to:0}},0.3);
E.onComplete.subscribe(function(){D.parentNode.removeChild(D);
o.onRowRemoved.fire(D);
if(YDom.hasClass(D,"first")){var F=Y$("li.vcard:first",a,true);
if(F){YDom.addClass(F,"first")
}}b()
});
E.animate()
});
C.animate()
}function b(){var A=v();
var C=n();
if(C){var i,D;
YDom.removeClass(C,"extra-row");
i=parseInt(YDom.getStyle(C,"height"));
D=YDom.getStyle(C,"min-height");
YDom.setStyle(C,"height","0");
YDom.setStyle(C,"min-height","0");
YDom.setStyle(C,"display","block");
var B=new YAnim(C,{height:{to:i}},0.5);
B.onComplete.subscribe(function(){YDom.removeClass(C,"extra-row");
YDom.setStyle(C,"height","");
YDom.setStyle(C,"display","");
YDom.setStyle(C,"min-height",D);
t();
o.onRowAdded.fire(C)
});
B.animate()
}else{if(A.length===0){o.onNoMoreRows.fire(a)
}t()
}}function d(){if(s){return
}s=true;
var i=e.shift();
if(!i){s=false;
return
}var A=i.split("?");
if(A.length>0){i=A[0];
A=A[1]
}else{A=""
}YAHOO.util.Connect.initHeader("X-IsAJAXForm","1");
YAHOO.util.Connect.asyncRequest("POST",i,{success:function(B){var J=B.responseText,D;
try{D=LI.parseJSON(J);
J=D.content||""
}catch(I){J=""
}var E,L;
E=document.createElement("div");
E.innerHTML=J;
L=q(E);
empty=Y$("#no-results",E,true);
var K;
for(var F=0,H=L.length;
F<H;
F++){K=L[F];
if(!K.id.match(/[0-9]/)||!w[K.id]){YDom.removeClass(K,"first");
a.appendChild(K);
LI.Controls.parseFragment(K);
w[K.id]=true
}}var G=q();
if(G.length===0){g=false;
o.onNoMoreRows.fire(a);
if(empty){t();
o.onErrorMessageReceived.fire(empty)
}}else{var C=v();
if(C.length<k){b()
}}E=null;
s=false;
d()
},failure:function(B){s=false;
d()
},cache:false},A)
}var m=y();
k=v().length;
var h,c;
if(!x.riverHasDropList){YEvent.addListener(a,"click",function(A){var i=YEvent.getTarget(A);
if(YDom.hasClass(i,"remove-row")&&i.nodeName=="A"){YEvent.stopEvent(A);
z(A)
}})
}for(var r=0,u=m.length;
r<u;
r++){h=m[r];
if(h.id.match(/[0-9]/)){w[h.id]=true
}if(x.riverHasDropList){c=LI.Controls.getControl(Y$(".remove-list",m[r],true).id,"DropList");
c.onToggleClose.subscribe(function(i,B){var A=B[0].evt,C=YEvent.getTarget(A);
if(YDom.hasClass(C,"remove-row")&&C.nodeName=="A"){YEvent.stopEvent(A);
z(A)
}})
}}o.hideRow=l;
(function f(){if(LI.PymkRiverExperiment){return
}LI.PymkRiverExperiment=true;
var A=YDom.get("pymk"),E=YDom.hasClass,C=0,i="ontouchstart" in document.documentElement?"touchend":"click";
if(E(A,"pymk-new-design")){var G=E(A,"refresh-to-full"),H=E(A,"click-to-profile"),D=E(A,"click-to-connect"),B=E(A,"click-to-full-pymk"),I=E(A,"ignore-to-pymk"),F=Y$("#pymk .header")[0];
YEvent.on(F,i,function(){window.location.href=YDom.getAttribute(F,"data-url")
});
if(I){YEvent.addListener(a,i,function(K){var J=YEvent.getTarget(K),L=J.nodeName.toLowerCase();
if(E(J,"remove-row")&&L==="a"){if(++C>=2){window.location.href=YDom.getAttribute(F,"data-url-item")
}}})
}if(H||D||B){YEvent.addListener(a,i,function(M){var L=YEvent.getTarget(M),N=L.nodeName.toLowerCase(),J="nmp_pymk_click_result",K;
if(E(L,"vcard")&&N==="li"){if(B){window.location.href=YDom.getAttribute(F,"data-url-item-click")
}else{if(H){K=YDom.getAttribute(YDom.getChildren(L)[0],"href");
K=K.replace("nmp_pymk_photo",J);
window.location.href=K
}else{if(D){K=YDom.getAttribute(YDom.getFirstChild(YDom.getChildren(L)[2]),"href");
K=K.replace("nmp_pymk_connect",J);
window.location.href=K
}}}}})
}}})()
};LI.define("InboxAttachmentUtil");
LI.InboxAttachmentUtil=function(c,d){var f=$(d.submitButton),e=d.deleteUrl,h=d.existingAttachments?$.parseJSON(d.existingAttachments):[],k=d.maxNumber,j=$(c).find(".files-list");
function i(){var p,l={},n;
if(!$.isEmptyObject(h)){for(n=0;
n<h.length;
n++){p=h[n];
var o={};
var m="preload"+n;
o[m]={};
o[m].name=p.fileName;
o[m].size=parseInt(p.fileSize,10);
o[m].mediaId=p.mediaId;
l[m]=o
}}return l
}function a(l){if((l.match("^http://"))&&(document.location.protocol==="https:")){l=l.replace(/^http:\/\//i,"https://")
}return l
}function g(){var m,l;
l=$("#csrfToken_id");
m=l.length?l.val():$("input[name=csrfToken]").val();
return m
}function b(m){var l=j.find("li").length;
if(typeof m==="undefined"){m=1
}if(l>=(k-m)){$(c).find(".attach-file").addClass("uploader-disabled")
}else{$(c).find(".attach-file").removeClass("uploader-disabled")
}}d.csrfToken=g();
d.preloadFileList=i();
d.fileFilters=[{description:"Attachments",extensions:"*.csv;*.CSV;*.xls;*.XLS;*.xlsx;*.XLSX;*.doc;*.DOC;*.docx;*.DOCX;*.ppt;*.PPT;*.pptx;*.PPTX;*.pdf;*.PDF;*.txt;*.TXT;*.rtf;*.RTF;*.odf;*.ODF;*.html;*.HTML;*.htm;*.HTM;*.gif;*.GIF;*.tif;*.TIF;*.tiff;*.TIFF;*.jpeg;*.JPEG;*.jpg;*.JPG;*.png;*.PNG;*.bmp;*.BMP;*.dng;*.DNG"}];
d.uploadUrl=a(d.uploadUrl);
LI.AddAttachments(c,d);
f.click(function(){$(window).unbind("unload")
});
$("form.compose-form").on("DOMNodeRemoved",function(m){var n=$(m.target),l;
if(n.attr("name")==="mediaIds"){b(0);
l=[n.val()];
$.ajax({type:"POST",url:e,data:{"mediaIds":l},traditional:true})
}});
$("#add-attachment-html .file-upload-input").on("change",function(){b()
});
$(window).unload(function(){var l=$("input[name=mediaIds]").map(function(){return this.value
}).get();
$.ajax({type:"POST",url:e,data:{"mediaIds":l},async:false,traditional:true})
})
};LI.define("AddAttachments");
LI.AddAttachments=function(d,T){var p="disabled",z="uploader-overlay",Z="file-upload-input",F="upload-actions",r="file-added",X="uploader-disabled",ap="max-size-err",ac="max-count-err",u="virus-detected-err",ah="upload-err",o="file-uploaded",ad="files-count",L="files-list",w=30,an="file",y=YAHOO.widget,ai=YAHOO.lang,H=T.swfUrl||location.protocol+"static.licdn.com/scds/concat/common/u/lib/yui/2.8.1/uploader/assets/uploader.swf",V=T.uploadInfo||null,ag=T.uploadUrl||null,B=T.csrfToken||null,ae=T.persist||false,at=T.uploadButton,af=T.submitButton,ay=T.progressBar||true,aj=T.formName||null,R=T.maxSize||2,ar=T.maxNumber||5,k=T.singleFileUpload||false,am=T.fileNameTruncateCharCount||w,W=T.errorUploadMessage||"upload error",aA,aa=Y$("."+z,d,true),s=Y$("."+Z,d,true),l=T.attachmentDelimeter||"--XX--",C=Y$("."+ap,d,true),az=Y$("."+ac,d,true),av=Y$("."+u,d,true),ak=true,G=0,q=Y$("."+L,d,true),c=T.preloadFileList||[],ao=T.fileFilters||LI.AddAttachments.DEFAULT_FILTERS,j=Y$("."+F,d,true),ab=T.context||"attachment",f=T.actor||null,S=T.containerEntity||null,v=T.isSpreadsheetUserImport||false,aw=T.isAVCheckEnabled||false,J=T.avCheckUrl||null,n=T.avScanningMessage||"Scanning...";
T.useHtmlUploader=T.useHtmlUploader||false;
function aq(aC,aB){if(!aC){return
}if(aB){LI.show(aC)
}else{LI.hide(aC)
}}function A(aB){return(aB.replace(/\s/g,"-").replace(/\./g,"-").replace(/_/g,"-"))
}function P(aB){return aB.split(/(\\|\/)/g).pop()
}function M(aJ,aD,aL){var aC="",aK,aF=c[aD],aG="",aE="",aI="",aB="",aH="";
aJ=aJ.length>am?aJ.substring(0,am)+"...":aJ;
aJ=LI.htmlEncode(aJ);
if(!aF.uploadingDone){aC='<div class="upload-progress"><div class="progress-bar"></div><span class="percent-done">0%</span></div>'
}else{aG=" "+o
}if(aw&&!aF.scanningDone){aE='<div class="av-scanning" id="scanning-'+aD+'"><div class="av-loader"></div> '+n+"</div>";
aI='<span class="av-virus-detected" id="virus-detected-'+aD+'"></span>';
aH='<span class="av-file-safe" id="safe-content-'+aD+'"/></span>'
}aK=['<li class="file-name',aG,'" id="',aD,'">','<a href="#" data-file-id="',aD,'" class="remove-file">X</a>',aC,'<span class="error">',W,"</span>",'<span class="file-text"><i class="icon-attachment"></i>',aJ,"</span>",(aL!==0?'<span class="file-size"> ('+LI.AddAttachments.formatFileSize(aL)+")</span> ":""),aE,aI,aH,"</li>"].join("");
return aK
}function e(){var aB;
if(T.useHtmlUploader){aB=Y$("."+Z,d,true);
if(aB){YDom.addClass(aB,X);
aB.disabled=true
}}else{if(aA){aA.disable()
}if(j){YDom.addClass(j,X)
}}}function ax(){var aB;
if(T.useHtmlUploader){aB=Y$("."+Z,d,true);
if(aB){YDom.removeClass(aB,X);
aB.disabled=false
}}else{if(aA){aA.enable()
}if(j){YDom.removeClass(j,X)
}}}function i(){if(af){af.removeAttribute(p);
YDom.removeClass(af,p)
}}function h(){if(af){af.setAttribute(p,p);
YDom.addClass(af,p)
}}function a(){if(ak&&al()){i()
}else{h()
}}function al(){var aB=true,aD=false,aC;
for(aC in c){if(c.hasOwnProperty(aC)&&(c[aC].uploading||c[aC].error)){aB=false
}}if(aw){for(aC in c){if(c.hasOwnProperty(aC)&&(c[aC].scanning||c[aC].error)){aB=false
}if(c[aC].hasVirus){aD=true;
aB=false
}}}if(aD){aq(av,true)
}return aB
}function b(aG){var aB=0,aC=0,aE,aD=true,aF=false;
for(aE in aG){if(aG.hasOwnProperty(aE)){aB=aB+aG[aE].size;
aC++
}}aq(C,false);
aq(az,false);
aq(av,false);
if(aC===ar){aF=true
}if(aC>ar){aq(az,true);
aD=false;
aF=true
}if(aB>Math.pow(2,20)*R){aq(C,true);
aD=false;
aF=true
}if(aF){e()
}else{ax()
}ak=aD;
return aD
}function Y(){var aE=true,aC,aF,aB,aD=YDom.get(aj);
for(aC in c){if(c.hasOwnProperty(aC)){aF=c[aC];
aF[aC].preload=true;
aF[aC].uploadingDone=true;
au(aC,aF[aC]);
aB=document.createElement("input");
aB.type="hidden";
aB.name="mediaIds";
aB.id=aC+"_mediaPill";
aB.value=aF[aC].mediaId+l+aF[aC].name;
aD.appendChild(aB);
aE=false
}}if(!aE&&j){YDom.addClass(j,r)
}}function au(aC,aB){var aE=aB.name,aD=A(aE);
c[aC]=aB;
G++;
q.innerHTML+=M(aE,aC,aB.size)
}function g(aB){ax();
if(T.useHtmlUploader){}else{aA.setAllowMultipleFiles(!k);
aA.setFileFilters(ao)
}if(af&&typeof af==="string"){af=Y$(af,null,true)
}}function U(aB){if(WebTracking){var aC={"actor":f,"context":ab};
if(S){aC.container=S
}WebTracking.trackUserAction("upload_click",aC,true,0)
}}function Q(aB){YDom.setStyle(aa,"cursor","pointer")
}function E(aB){YDom.setStyle(aa,"cursor","auto")
}function I(aB){var aI=aB.fileList,aD="",aH=0,aE,aG,aF;
for(aE in aI){if(aI.hasOwnProperty(aE)&&!c[aE]){au(aE,aI[aE]);
aH++
}}if(WebTracking){var aC={"files_selected":aH,"actor":f,"context":ab};
if(S){aC.container=S
}WebTracking.trackUserAction("files_selected",aC,true,0)
}if(b(c)){if(T.useHtmlUploader){}else{x(c)
}}a();
if(j){YDom.addClass(j,r)
}}function t(aC){var aD,aE,aB;
if(ay){aD=T.useHtmlUploader?Math.round(aC.percent):Math.round(100*(aC.bytesLoaded/aC.bytesTotal));
if(aD===100){aD=99
}aE=aE=Y$("#"+aC.id+" .percent-done",d,true);
aE.innerHTML=aD+"%";
aB=Y$("#"+aC.id+" .progress-bar",d,true);
YDom.setStyle(aB,"width",aD+"%")
}}function m(aL){var aG,aF,aJ,aK,aC,aH=T.useHtmlUploader?aL.data:YAHOO.lang.JSON.parse(aL.data),aD=YDom.get(aj),aE=aH.value,aB=aH.filename,aI=Y$("#"+aL.id,q,true);
if(ay){aF=Y$("#"+aL.id+" .percent-done",d,true);
aF.innerHTML="100%";
aJ=Y$("#"+aL.id+" .progress-bar",d,true);
YDom.setStyle(aJ,"width","100%")
}if(aI){YDom.addClass(aI,o)
}if(v){aC=window.location.href.replace("importSpreadsheetPage","");
window.location.href=aC+"spreadsheetProcess?media="+aE
}if(aE!==null&&aE!==""){aK=document.createElement("input");
aK.type="hidden";
aK.name="mediaIds";
aK.id=aL.id+"_mediaPill";
aK.value=aE+l+LI.htmlEncode(aB);
aD.appendChild(aK)
}if(aw){D(aE,aL)
}c[aL.id].uploading=false;
c[aL.id].uploadingDone=true;
a()
}function D(aC,aB){c[aB.id].scanning=true;
c[aB.id].scanningDone=false;
c[aB.id].hasVirus=false;
$("#loader-"+aB.id).show();
$("#scanning-"+aB.id).css("display","inline-block");
$.ajax({url:J+"?mediaId="+aC,success:function(aD){var aE=aD.content.data.status;
if(aE==="UNSAFE_CONTENT"||aE==="VIRUS_DETECTED"){c[aB.id].scanning=false;
c[aB.id].scanningDone=true;
c[aB.id].hasVirus=true;
$("#scanning-"+aB.id).hide();
$("#virus-detected-"+aB.id).css("display","inline-block");
a()
}else{if(aE==="VIRUS_NOT_DETECTED"){c[aB.id].scanning=false;
c[aB.id].scanningDone=true;
$("#scanning-"+aB.id).hide();
$("#safe-content-"+aB.id).css("display","inline-block");
a()
}else{if(aE==="SCANNING"){window.setTimeout(function(){D(aC,aB)
},1000)
}}}},error:function(){O(aB)
}})
}function O(aB){var aC=YDom.get(aB.id);
YDom.addClass(aC,ah);
c[aB.id].uploading=false;
c[aB.id].error=true;
a();
return
}function x(aC){var aB;
for(aB in aC){if(aC.hasOwnProperty(aB)&&!aC[aB].uploadingDone&&!aC[aB].error){if(T.useHtmlUploader){}else{aC[aB].uploading=true;
aA.upload(aB,ag,"POST",{upload_info:V,store_securely:true},an)
}}}}function N(aD){var aE=YEvent.getTarget(aD),aC,aB;
YEvent.stopEvent(aD);
aC=aE.getAttribute("data-file-id");
q.removeChild(aE.parentNode);
if(!c[aC].preload){if(T.useHtmlUploader){}else{aA.cancel(aC);
aA.removeFile(aC)
}}delete c[aC];
aB=YDom.get(aC+"_mediaPill");
if(aB){aB.parentNode.removeChild(aB)
}G--;
if(G<1&&j){YDom.removeClass(j,r)
}if(b(c)){if(T.useHtmlUploader){}else{x(c)
}}a()
}function K(){var aC=0,aB;
while(aC<ar){aB="file"+aC;
if(!c.hasOwnProperty(aB)){break
}aC++
}return aB
}e();
if(T.useHtmlUploader){if(LI.MediaServerUploader){$(d).on("click",U).on("change","."+Z,function(aD){var aF=$(aD.target),aH,aG,aC,aE,aI={},aB=K();
if($.trim(aF.val())){aH=$("<form></form>").attr({method:"POST",action:ag,enctype:"multipart/form-data"}).css({"height":"1px","width":"1px","position":"absolute","left":"-1234em","top":"0","visibility":"hidden"});
aG=aF.clone(true);
aC=['<input type="hidden" name="upload_info" value="'+V+'" />','<input type="hidden" name="store_securely" value="true" />','<input type="hidden" name="isCSMode" value="false" />','<input type="hidden" name="persist" value="'+ae+'" />'];
if(B){aC.push('<input type="hidden" name="csrfToken" value="'+B+'" />')
}aC.push('<input type="submit" />');
aH.append(aC.join(""));
aF.after(aG).detach().appendTo(aH);
aE=new LI.MediaServerUploader(aH[0],{});
aI.fileList={};
aI.fileList[aB]={size:0,id:aB,name:P(aF.val()),mDate:(new Date()).toString(),cDate:(new Date()).toString()};
if(window.File&&window.FileReader&&window.FileList&&window.Blob){aI.fileList[aB].size=aF[0].files[0].size;
aI.fileList[aB].name=aF[0].files[0].name
}I(aI);
aH.appendTo(document.body).trigger("submit");
aH.on("progress-start",function(aJ,aK){t({id:aB,percent:0})
}).on("progress-update",function(aJ,aK){t({id:aB,percent:aK.percent})
}).on("progress-complete",function(aJ,aK){t({id:aB,percent:aK.percent})
}).on("mpr-upload-error",function(aJ,aK){O({id:aB,data:aK});
aH.remove()
}).on("mpr-upload-success",function(aJ,aK){m({id:aB,data:aK});
aH.remove()
})
}});
g()
}else{throw"LI.MediaServerUploader must be present for LI.AddAttachments to work."
}}else{y.Uploader.SWFURL=H;
aA=new y.Uploader(aa);
aA.addListener("contentReady",g);
aA.addListener("click",U);
aA.addListener("rollOver",Q);
aA.addListener("rollOut",E);
aA.addListener("fileSelect",I);
aA.addListener("uploadProgress",t);
aA.addListener("uploadCompleteData",m);
aA.addListener("uploadError",O)
}Y();
YEvent.on(q,"click",function(aB){var aC=YEvent.getTarget(aB);
if(YDom.hasClass(aC,"remove-file")){N(aB)
}})
};
LI.AddAttachments.ALL_FILTERS=[{description:"all",extensions:"*;"}];
LI.AddAttachments.DEFAULT_FILTERS=[{description:"Attachments",extensions:"*.csv;*.CSV;*.xls;*.XLS;*.xlsx;*.XLSX;*.doc;*.DOC;*.docx;*.DOCX;*.ppt;*.PPT;*.pptx;*.PPTX;*.pdf;*.PDF;*.txt;*.TXT;*.rtf;*.RTF;*.odf;*.ODF;*.html;*.HTML;*.htm;*.HTM;"}];
LI.AddAttachments.formatFileSize=function(c){var b=c,a=1024,d="K",h="M",f="G",g="B";
function e(i){return parseFloat(i).toFixed(1)
}if(c<=0){return 0
}if(b<a){return e(b)+g
}b=b/a;
if(b<a){return e(b)+d
}b=b/a;
if(b<a){return e(b)+h
}b=b/a;
return e(b)+f
};(function(a){LI.define("Profile2");
var b=(typeof window.console!=="undefined")?window.console:{log:a.noop()};
LI.Profile2.Render=(function(){var c={};
function e(j,i,f,h){var g;
if(typeof j.responseText==="string"){g=a.parseJSON(j.responseText)
}else{g=j.responseText
}if(g.content){g=g.content
}dust.render(i,g,function(l,k){if(l){b.log(l);
if(h){h(l)
}return
}if(f){f(k)
}})
}function d(g,i){var h,f;
if(typeof g.getResponseHeader==="function"){f=g.getResponseHeader(i)||""
}else{h=g.getResponseHeader||{};
if(h.hasOwnProperty(i)){f=h[i]
}}return f
}a.extend(c,{render:function(j){var h=j.response||{},i=j.template||"",f=j.success,g=j.error;
if(h&&i){this.getFizzyHeaderConcatTemplates(h,function(){e(h,i,f,g)
})
}},getFizzyHeaderConcatTemplates:function(g,l){if(!g){return
}var j="X-FS-TL",i="x-fs-tl",h="X-Fs-Tl",f=[],k;
k=d(g,j)||d(g,i)||d(g,h);
if(k){a.ajaxSetup({cache:true});
a.each(k.split(","),function(m,n){f.push(a.getScript(a.trim(n)))
});
a.ajaxSetup({cache:false});
if(l){a.when.apply(null,f).done(function(){l()
})
}}else{if(l){l()
}}}});
return c
})()
})(jQuery);(function(h){var g=h.requires("jquery"),d=h.requires("underscore"),c=h.imports("Controls"),b=h.requires("Events"),e,f,a=h.imports("Profile2");
g.fn.MiniProfile=function(k,j,i){e=e||h.imports("Bidi");
this.id=k;
this.$panel=j;
this.content="";
this.manager=i;
this.followToggler="";
e=e||h.imports("Bidi");
this.isRTL=e?e.flip(false,true):false
};
g.extend(g.fn.MiniProfile.prototype,{calculatePosition:function(I){var B=this,n=B.$panel,o=n.find(".new-miniprofile-content"),y=g(window).height(),H=g(window).width(),p=g(document).scrollTop(),j=g(document).scrollLeft(),v={},r=0,G=0,m=0,k=0,t,F,E={},x=B.manager.getDefaultShownBelow(),u=false,w=false,q,A=n.find(".company-miniprofile-content, .school-miniprofile-content").length,C=80,s=B.isRTL,l=s?(A?69:124):80,z=s?-159:(A?-70:-115),i=A?15:10,D=10;
g("img",I).each(function(J){I=g(this);
return false
});
r=I.innerHeight();
G=I.innerWidth();
n.css({"visibility":"hidden"}).removeClass("hidden");
m=o.outerHeight();
k=o.outerWidth();
n.addClass("hidden").css({"visibility":"visible"});
t={x:I.offset().left+(G/2),y:I.offset().top};
F={x:I.offset().left+(G/2),y:I.offset().top+r};
if(F.y+m<p+y){w=true
}if(t.y-m-C>p){u=true
}if(x&&w){v.bottom=true
}else{if(!x&&u){v.top=true
}else{if(w){v.bottom=true
}else{v.top=true
}}}q=(e)?e.flip(k,-1*k):k;
if(t.x+q+z<j+H){v.right=true
}else{if(t.x-q+l>j){v.left=true
}else{v.right=true
}}if(v.top){E.y=t.y-m-i
}if(v.bottom){E.y=F.y+i
}if((v.left&&!s)||(v.right&&s)){E.x=t.x-k+l
}if((v.right&&!s)||(v.left&&s)){E.x=t.x+z-D
}return{x:E.x,y:E.y,directions:v}
},id:function(){return this.id
},getContent:function(){return this.content
},show:function(j){var i=this;
i.$node=j;
i.manager.loadProfile(j,{success:function(n){var k=i.manager.config,l=i.manager,p=i.$panel,o=l.$lastSelectedNode,m;
if(n){i.content=n;
if(l.areDifferentLinkNodes(o,j)){return
}p.html(n);
if(c&&c.parseFragment){c.parseFragment(p.get(0))
}m=p.find(".company-miniprofile-content, .school-miniprofile-content");
if(m.length){f=f||h.imports("scripts.FollowToggler");
if(!i.followToggler){b.bind("follow-toggler:follow:success follow-toggler:unfollow:success",d.bind(i.afterFollowingCompany,i))
}if(f){i.followToggler=new f(m,{toggleContainerClass:"follow-actions-container",selectedClass:"current",companyId:i.id})
}}var q=i.calculatePosition(j);
if(q){p.css({"visibility":"hidden"}).removeClass("hidden").offset({top:q.y,left:q.x}).addClass("hidden").css({"visibility":"visible"});
i.setPointer(q.directions);
i.manager.showPanel(p)
}}}});
return i
},afterFollowingCompany:function(k,i){if(this.id===i._config.companyId){var j=g("<div>").append(i._$el.clone()).html();
this.manager.updateMiniProfileInCache(this.$node,j)
}},setPointer:function(n){var m=this.$panel,l=[],j,k;
l=[];
for(var i in n){l.push(i)
}m.find(".triangle").removeClass("top bottom left right").addClass(l.join(" "));
if(m.find(".miniprofile-shared-connections").length){j="triangle-bottom";
k="triangle-bottom-grey"
}else{j="triangle-bottom-grey";
k="triangle-bottom"
}m.find("."+j).removeClass(j).addClass(k)
}});
g.fn.MiniProfileManager=(function(j){var i={};
g.extend(i,{config:j,profileRegistry:{},defaultShownBelow:false,$panel:null,showPanelTimer:null,currentProfileId:null,mouseInsidePanel:false,mouseInsideLink:false,$lastSelectedNode:null,$lastMouseOverNode:null,isHiding:null,initPanel:function(){var k=this,l=k.config,m;
if(!k.$panel){m=g("<div></div>");
k.$panel=m;
m.attr("id",k.config.PANEL_ID_NAME);
g("body").append(m);
m.css("z-index",k.config.zIndex);
m.mouseenter(function(){k.mouseInsidePanel=true
});
m.mouseleave(function(){k.mouseInsidePanel=false
})
}},showPanel:function(k){k.removeClass("hidden")
},hidePanel:function(k){k.addClass("hidden")
},isPanelHidden:function(k){return k.hasClass("hidden")
},setDefaultShownBelow:function(k){this.defaultShownBelow=k
},getDefaultShownBelow:function(){return this.defaultShownBelow
},delayShowPanel:function(l,m){var k=this;
k.showPanelTimer=setTimeout(function(){if(k.mouseInsideLink){l.show(m)
}k.showPanelTimer=null
},j.SHOW_PANEL_DELAY)
},delayHidePanel:function(o,l){var k=this,m=k.config,n;
if(k.mouseInsidePanel){return
}k.isHiding=true;
setTimeout(function(){var p=k.areDifferentLinkNodes(l,k.$lastSelectedNode);
if((!k.mouseInsidePanel&&!k.mouseInsideLink)||(k.mouseInsideLink&&p)){k.hidePanel(o)
}if(k.isHiding){k.isHiding=false;
n=k.registerMiniProfile(k.$lastSelectedNode);
if(p){k.delayShowPanel(n,k.$lastSelectedNode)
}}},m.HIDE_PANEL_DELAY)
},loadProfile:function(l,u){var v=this,o=v.config,n="throw /*LI:DBE*/ 1;",m=l.attr(o.MINIPROFILE_JS_ATTRIBUTE_NAME),w=l.attr(o.MINIPROFILE_TEMPLATE_ATTRIBUTE_NAME)||"tl/shared/profile/mini_profile_shell",k=l.attr(o.MINIPROFILE_URL_ATTRIBUTE_NAME),r=(typeof window.console!=="undefined")?window.console:{log:g.noop()},p,t,s;
if(k){t=v.getProfileContent(k);
if(t){u.success(t);
return
}}if(m){g.getScript(m)
}var q=function(x){if(x){u.success(x);
g("body").trigger(o.NEW_CONTENT_EVENT)
}};
g.ajax({type:"GET",url:k,headers:{"X-IsAJAXForm":1},data:"",dataType:"text",success:function(C,x,y){var A,z=false,B=a,E=y.getResponseHeader("content-type")||"";
if(E.indexOf("html")!==-1){u.success(C)
}else{if(B&&B.Render){B.Render.render({template:w,response:y,success:q})
}else{if(w&&window.dust){try{C=C.replace(n,"");
A=g.parseJSON(C);
dust.render(w,A.content,function(G,F){if(G){return
}q(F)
})
}catch(D){}}}}},error:function(x,z,y){}})
},getProfileContent:function(k){var l=this.profileRegistry[k];
if(!l){return null
}return l.getContent()
},getMiniProfile:function(m){var k=this,l=m.attr(j.MINIPROFILE_URL_ATTRIBUTE_NAME);
return k.profileRegistry[l]
},registerMiniProfile:function(p){var l=this,n=l.config,o=l.getMiniProfile(p),k,m;
k=p.attr(n.MINIPROFILE_ID_ATTRIBUTE_NAME);
if(!k){k="LI-"+Math.floor(Math.random()*9999999);
p.attr(n.MINIPROFILE_ID_ATTRIBUTE_NAME,k)
}if(!o){m=p.attr(n.MINIPROFILE_URL_ATTRIBUTE_NAME);
o=new g.fn.MiniProfile(k,l.$panel,l);
l.profileRegistry[m]=o
}return o
},updateMiniProfileInCache:function(m,l){var k=m.attr(j.MINIPROFILE_URL_ATTRIBUTE_NAME);
this.profileRegistry[k].content=l
},areDifferentLinkNodes:function(n,m){var k=this,l=k.config;
return(!n||!m||n.attr(l.MINIPROFILE_ID_ATTRIBUTE_NAME)!==m.attr(l.MINIPROFILE_ID_ATTRIBUTE_NAME))
},handleMouseEvent:function(r){var s=this,n=s.config,m=g(r.target),o,q,k,p,l;
if(!s.$panel){s.initPanel()
}s.$lastMouseOverNode=m;
o=m.closest("."+n.MINIPROFILE_SEARCH_CLASS_NAME);
if(o.length){s.mouseInsideLink=true;
p=s.registerMiniProfile(o);
if(!s.currentProfileId||s.currentProfileId!==p.id){s.currentProfileId=p.id;
if(s.showPanelTimer){l=s.showPanelTimer;
window.clearTimeout(l);
l=null
}s.$lastSelectedNode=o;
if(s.isHiding){}else{s.isHiding=false;
s.delayShowPanel(p,o)
}}}else{s.mouseInsideLink=false;
if(s.mouseInsidePanel){return
}s.currentProfileId=null;
if(!s.isPanelHidden(s.$panel)&&s.$panel.find("."+n.MINIPROFILE_CONTENT_CLASS_NAME).length){s.delayHidePanel(s.$panel,s.$lastSelectedNode)
}}}});
return i
}({SHOW_PANEL_DELAY:500,HIDE_PANEL_DELAY:400,PANEL_ID_NAME:"lui-mini-profile-body",PANEL_ZINDEX:1007,MINIPROFILE_SEARCH_CLASS_NAME:"new-miniprofile-container",MINIPROFILE_CONTENT_CLASS_NAME:"new-miniprofile-content",MINIPROFILE_ID_ATTRIBUTE_NAME:"data-li-miniprofile-id",MINIPROFILE_JS_ATTRIBUTE_NAME:"data-li-getjs",MINIPROFILE_TEMPLATE_ATTRIBUTE_NAME:"data-li-tl",MINIPROFILE_URL_ATTRIBUTE_NAME:"data-li-url",NEW_CONTENT_EVENT:"show-mini-profile"}));
g(function(){var j=g(document);
function i(l){g.fn.MiniProfileManager.handleMouseEvent(l)
}(function k(){if(j.on){j.on("mouseover",i)
}}())
})
}(window.LIModules));LI.define("Inbox.ConnectionChooser.ConnectionChooserView");
LI.Inbox.ConnectionChooser.ConnectionChooserView=Backbone.View.extend({ESCAPE_KEY_CODE:27,UP_ARROW:38,DOWN_ARROW:40,TAB:9,events:{"click .chooser-box":"toggleConnectionChooser","keyup .chooser-box":"toggleChooserViaKeyboard","click .connection-order":"updateSortingOrder","click .connection-card":"onSelect","keyup .connection-card":"onEnterSelect","hover .connection-card":"onHover"},sorter:{strength:function(a){return a.toArray()
},abc:function(a){return a.sortBy(function(b){return b.get("fullName").toLowerCase()
})
}},initialize:function(){var b=this,a=_.functions(b);
_.each(a,function(c){b[c]=_.bind(b[c],b)
});
this.listenTo(this.model,"inlinePageLoaded",this.onLoad);
this.options.chooserState.bind("change:selected",this.renderBox);
this.options.chooserState.bind("change:order",this.renderConnectionsList);
this.options.sharedConnections.bind("reset",this.renderConnectionsList);
$("body").on("connection-chooser-loaded",function(d,c){b.setElement(c.element);
b.i18n=c.i18n;
b.ghostImageUrl=c.ghostImageUrl;
dust.render("connection_chooser",c,function(g,e){b.$el.html(e);
b.$box=b.$el.find(".chooser-box-content");
b.$list=b.$el.find(".chooser-list");
b.$input=b.$el.find("input");
b.formSubmitButton=$(c.submitBtn)[0];
b.formSubmitButton.disabled=true;
b.registerCloseTriggers();
b.registerKeyNavigation();
b.options.sharedConnections.reset(c.members);
if(c.middlemanId>0){var f=b.options.sharedConnections.profileById(c.middlemanId);
b.options.chooserState.set({selected:f})
}b.renderBox()
})
})
},onLoad:function(){var a=this,b;
b=a.options.chooserState.get("selected");
if(!$.isEmptyObject(b)){a.$el.trigger("connectionChosen",[{selected:b}])
}},registerCloseTriggers:function(){var a=this;
$("body").on("click",function(b){if($(b.target).closest("#intro-connection-chooser").length===0&&$(b.target).closest(".connection-chooser-select").length===0){a.$list.hide()
}});
$(document).on("keyup",function(d){var b=$(".connection-list"),c=b.attr("aria-hidden");
if(d.keyCode===a.ESCAPE_KEY_CODE&&c==="false"){a.toggleConnectionChooser();
$(".chooser-box").focus()
}})
},goToPrevItem:function(a){var b=a.prev(".connection-list > li");
if(b.is(":first")){b=$("li:last",".connection-list")
}$(".connection-card").removeClass("intro-connection-active");
b.addClass("intro-connection-active");
b.focus()
},goToNextItem:function(a){var b=a.next(".connection-list > li");
if(b.is(":last")){b=$("li:first",".connection-list")
}$(".connection-card").removeClass("intro-connection-active");
b.addClass("intro-connection-active");
b.focus()
},registerKeyNavigation:function(){var a=this;
var b=[38,40];
$(document).on("keydown",function(d){var c=d.which;
if($.inArray(c,b)>-1){d.preventDefault();
return false
}return true
});
$(document).on("keydown",".connection-list > li",function(c){c.preventDefault();
if(c.keyCode===a.UP_ARROW||(c.shiftKey&&c.keyCode===a.TAB)){a.goToPrevItem($(this))
}else{if(c.keyCode===a.DOWN_ARROW||c.keyCode===a.TAB){a.goToNextItem($(this))
}}})
},updateSortingOrder:function(c){var b=$(c.target).closest(".connection-order"),a=b.data("order");
this.options.chooserState.set({order:a})
},onHover:function(b){var a=$(b.target).closest(".connection-card");
$(".connection-card").removeClass("intro-connection-active");
a.addClass("intro-connection-active")
},selectItem:function(c){var f=$(c.target).closest(".connection-card"),d=f.data("connection-id").toString(),b=this.options.sharedConnections.profileById(d),a=this;
a.toggleConnectionChooser();
if(b){a.options.chooserState.set({selected:b})
}a.$el.trigger("connectionChosen",[{selected:b}]);
$(".intro-subject").focus()
},onSelect:function(a){this.selectItem(a)
},onEnterSelect:function(a){if(a.keyCode===13){this.selectItem(a)
}},toggleConnectionChooser:function(){this.$list.toggle();
var a=$(".connection-list"),b=a.attr("aria-hidden");
if(b==="true"){a.attr("aria-hidden","false");
this.$list.find("li.intro-connection-active:first").focus()
}else{a.attr("aria-hidden","true")
}},toggleChooserViaKeyboard:function(a){if(a.keyCode===13||a.keyCode===this.DOWN_ARROW){this.toggleConnectionChooser()
}},connectionsListData:function(){var c=this.ghostImageUrl,a=this.options.chooserState.get("order"),b=this.sorter[a](this.options.sharedConnections),d=_.map(b,function(e){var f=e.toJSON();
f.fullName=LI.htmlUnencode(f.fullName);
f.headline=LI.htmlUnencode(f.headline);
return _.extend({pictureUrl:c},f)
});
return _.extend({},this.i18n,{results:d,orderBy:a})
},renderConnectionsList:function(){var a=this;
dust.render("connection_chooser_list",this.connectionsListData(),function(c,b){a.$list.html(b);
a.$list.find("li:first").addClass("intro-connection-active")
})
},renderBox:function(){var b=this.options.chooserState.get("selected"),a=this,c=_.extend({pictureUrl:this.ghostImageUrl},this.i18n,b,{fullName:LI.htmlUnencode(b.fullName),headline:LI.htmlUnencode(b.headline)});
if(b&&b.id){this.$input.val(b.id);
this.formSubmitButton.disabled=false
}dust.render("connection_chooser_box",c,function(e,d){a.$box.html(d)
})
}});LI.define("Inbox.ConnectionChooser.ChooserState");
LI.Inbox.ConnectionChooser.ChooserState=Backbone.Model.extend({defaults:{order:"strength",selected:{}}});LI.define("Inbox.ConnectionChooser.SharedConnections");
LI.Inbox.ConnectionChooser.SharedConnections=Backbone.Collection.extend({initialize:function(){_.bindAll(this,"cacheProfiles","profileById");
this.bind("reset",this.cacheProfiles)
},cacheProfiles:function(){this.profiles=this.reduce(function(a,b){a[b.get("id")]=b.toJSON();
return a
},{})
},profileById:function(a){return this.profiles[a]
}});LI.define("Inbox.ComposeRecipientInput");
LI.Inbox.ComposeRecipientInput=function(c,z){z={ghostImgSrc:z.ghostImgSrc||"",idConnStore:z.idConnStore||null,nameConnStore:z.nameConnStore||null,idSeparator:" ",minInputSize:45,maxInputSize:200,focusOnInit:z.focusOnInit||false,loginMember:z.loginMember||{},beanManager:{selectionLimit:z.selectionLimit||50,idConnStore:z.idConnStore||null}};
var i=window.Bloodhound,e=$(c),f="25px",g=$(".ie-ghost",e).text(),q=$("<div/>",{id:"ccInputHolder"}).appendTo(e),x=$("<input/>",{type:"text",size:"2",placeholder:g,id:"ccInput",name:"ccInput","class":"has-ghost1","aria-label":LI.Inbox.Util.getI18nString("accEnterConnectionName"),value:"",dir:$("body").prop("dir")||"ltr"}).appendTo(q),B=$("#recipients-composeForm"),j=$("#typeaheadLabel"),u=null,s=null,d=null,m=null,p=null;
var l=8,t=46,o=37,a=13,w=39;
function v(){u=$("<input/>",{id:"ccInputHidden",value:"","aria-labelledby":"inputHiddenLabel"}).insertAfter(e);
if(z.idConnStore){s=$(z.idConnStore)
}if(z.nameConnStore){d=$(z.nameConnStore)
}var F="";
var E=new i({datumTokenizer:i.tokenizers.obj.whitespace("displayName"),queryTokenizer:i.tokenizers.whitespace,local:[z.loginMember],remote:{url:"/ta/my1stnetwork?query=%QUERY",replace:function(G,H){F=H;
return G.split("%QUERY").join(H)
},filter:function(G){return G.resultList
}},limit:8});
var D=new LI.AccessibleTwitterTypeahead($("#ccInput"),{dataset:"INBOXTA",bloodhoundEngine:E,i18nStrings:{zeroResults:LI.Inbox.Util.getI18nString("taNoSuggestions"),singleResult:LI.Inbox.Util.getI18nString("taOneSuggestion"),multipleResults:LI.Inbox.Util.getI18nString("taMultipleSuggestions")},labelId:"a11y-recipients-region"});
E.initialize();
var C={compile:function(G){return function(I){var H;
dust.render(G,$.extend(I,{ghostImgSrc:z.ghostImgSrc}),function(K,J){H=J
});
return H
}
}};
x.typeahead({hint:false,highlight:true,minLength:1},{name:"INBOXTA",displayKey:"displayName",source:E.ttAdapter(),templates:{suggestion:C.compile("tl/shared/typeahead/simpleTypeaheadWithImage")}}).on("typeahead:selected",function(){j.text("");
x.val(F);
A.apply(this,arguments)
}).on("typeahead:cursorchanged",function(G){x.val(F)
});
p=new LI.ComposeBeanManager(e.get(0),z.beanManager);
x.keydown(b);
u.keydown(n);
x.on("paste",function(G){if(LI.browser.ie){$(".ie-ghost",e).hide()
}});
e.on("click",k);
s.on("afterBeansUpdated",function(G,H){if(s&&H&&H.idsArray){s.val(H.idsArray.join(" "))
}if(d&&H&&H.recipArray){d.val(JSON.stringify(H.recipArray))
}if(s.val()===""){x.attr("placeholder",g).val("").show()
}$("#member-context").trigger("beansRedrawn",H)
});
u.on("afterBeanSelected",function(){u.focus();
x.val("").hide()
});
u.on("focus blur",function(G){B.toggleClass("focused-input",G.type==="focus")
});
x.on("focus blur",function(G){if(G.type==="blur"){x.val("")
}B.toggleClass("focused-input",G.type==="focus")
});
x.on("keypress",function(G){var H=x.width();
if(H<95){x.width(H+5)
}});
r();
y(z.focusOnInit);
h()
}function y(C){if(C===false){x.show().val("")
}else{x.show().val("").focus()
}}function A(C,G,E){var F;
if(E==="prefilled"){F=p.create(G.memberId,LI.Inbox.Util.encodeHTMLOnce(G.displayName),G.imageUrl)
}else{F=p.create(G.id,LI.Inbox.Util.encodeHTMLOnce(G.displayName),G.imageUrl)
}if(F){$(F).insertBefore(q);
var D=$(F).height();
$(F).children().height(D);
x.val("").attr("placeholder","").width(f).hide();
if(G.id){$("#ccInputHidden, #member-context").trigger("afterBeanSelected");
LI.Inbox.Model.instance.trigger("showContext",G.id)
}y(E!=="prefilled")
}}function r(){if(d.val()!==""&&$.parseJSON(d.val())){$.each($.parseJSON(d.val()),function(C,D){A(null,{displayName:D.fullName,imageUrl:D.imageUrl,memberId:D.memberId},"prefilled")
});
y(false)
}}function b(G){var F,H,D,E,C=x.val();
F=G.keyCode;
if(C.length<1){E=$(p.getSelected());
if(F===l||F===o){H=E.length>0?E.prev(".ccCon"):$("#recipients-composeForm .ccCon:last");
if(H.length>0){p.select(H)
}}else{if(F===w||F===t){D=E.next(".ccCon");
if(D.length>0){p.select(E.next(".ccCon"))
}}}}else{if(F===a){G.preventDefault()
}}h()
}function n(F){var E=F.keyCode,C,G,D=$(p.getSelected());
if(D.length>0){if(E===l||E===t){G=D.prev(".ccCon");
p.remove(D);
if(G.length>0){p.select(G)
}else{y()
}}else{if(E===w){C=D.next(".ccCon");
if(C.length>0){p.select(C)
}else{p.unSelect();
y()
}}else{if(E===o){if(D.index()>1){p.select(D.prev(".ccCon"))
}}else{if(E===a){F.preventDefault()
}else{p.unSelect();
y()
}}}}}h()
}function k(D){var C=$(D.target).context;
if(C.id===e.attr("id")){if(q.next()){e.append(q)
}p.unSelect();
y()
}else{if(!p.getSelected()){y()
}}h()
}function h(){var C=s.val().split(" "),D=$(".compose-form-content .lastwords.hidden-by-default"),E=$(".intro-header");
if(C.length<2||E.length){D.hide()
}else{D.show()
}}$(document).ready(v)
};LI.define("ComposeBeanManager");
LI.ComposeBeanManager=function(f,d){d={clsSlected:"hl",clsUnselected:"ccCon",clsClose:"ccCloseBtn",selectionLimit:d.selectionLimit,idConnStore:d.idConnStore||"#recipients_id"};
var g=this,h=f,a=[],c=[],e=null,b=$("#inputHiddenLabel");
this.select=function(j){if(e){g.unSelect()
}e=j;
var i=$(e);
i.addClass(d.clsSlected);
b.text(i.find(".beanName").text()+". "+LI.Inbox.Util.getI18nString("accUseBackspaceToDelete"));
b.focus();
$("#ccInputHidden, #member-context").trigger("afterBeanSelected")
};
this.unSelect=function(){if(e){$(e).attr("class",d.clsUnselected);
e=null
}};
this.getSelected=function(){return e
};
this.create=function(n,m,k){var j=$("<div/>",{id:n}),l=[],i={memberId:n,fullName:LI.Inbox.Util.encodeHTMLOnce(m)};
if(d.selectionLimit>a.length&&a.indexOf(n)===-1){j.addClass(d.clsUnselected);
if(k){l.push('<p class="beanHolder"><img src="'+k+'" class="recipientImage" /><span class="beanName">'+LI.Inbox.Util.encodeHTMLOnce(m)+"</span>")
}else{l.push('<p class="ccBean"><span class="beanName">'+LI.Inbox.Util.encodeHTMLOnce(m)+"</span>")
}l.push('<span class="'+d.clsClose+'">X</span></p>');
j.html(l.join(""));
if(n){a.push(""+n)
}c.push(i);
$(d.idConnStore).trigger("afterBeansUpdated",{idsArray:a,recipArray:c});
j.on("click",function(o){var p=o.target;
if(p.className===d.clsClose){g.remove(j.get(0))
}else{g.select(j.get(0))
}});
return j.get(0)
}return false
};
this.remove=function(j){var k=j||e,i;
if(h){if(k&&k.id){i=a.indexOf(k.id)
}else{if(k[0]&&$(k[0]).attr("id")){i=a.indexOf($(k[0]).attr("id"));
k=k[0]
}}if(i!==-1){a.splice(i,1);
h.removeChild(k)
}if($(k).attr("id")===$(e).attr("id")||$("."+d.clsUnselected,h).length<1){e=null
}$(d.idConnStore).trigger("afterBeansUpdated",{idsArray:a})
}}
};LI.define("Inbox.ghostTextIE");
LI.Inbox.ghostTextIE=function(a){a={ghostClass:a.ghostClass||null,beanStore:a.beanStore||null,beanInput:a.beanInput||null};
function d(){var f=$($("."+a.ghostClass).next());
f.focus(function(g){if($.trim($(g.currentTarget).val())===""){c($(g.currentTarget).prev().attr("id"))
}});
f.blur(function(g){e($(g.currentTarget).prev().attr("id"))
});
f.keydown(function(g){e($(g.currentTarget).prev().attr("id"))
});
f.keyup(function(g){if((g.keyCode===8)&&($.trim($(g.currentTarget).val())==="")){c($(g.currentTarget).prev().attr("id"))
}});
b(a.beanInput);
$("."+a.ghostClass+"#subject").hide();
$("."+a.ghostClass+"#message").hide()
}function c(f){if(f==="subject"){$("."+a.ghostClass+"#subject").show()
}else{if(f==="message"){$("."+a.ghostClass+"#message").show()
}}}function e(f){if(f==="subject"){$("."+a.ghostClass+"#subject").hide()
}else{if(f==="message"){$("."+a.ghostClass+"#message").hide()
}}}function b(f){var h=$("#"+f),g=$("."+a.ghostClass+"#to");
h.focus(function(i){if(($.trim($(i.currentTarget).val())==="")&&($("."+a.beanStore).length===0)){g.show()
}else{g.hide()
}});
h.blur(function(i){if($("."+a.beanStore).length===0&&$.trim($(i.currentTarget).val())===""){g.show()
}});
h.keypress(function(i){g.hide()
});
h.keyup(function(i){if((i.keyCode===8)&&($.trim($(i.currentTarget).val())==="")&&($("."+a.beanStore).length===0)){g.show()
}})
}$(document).ready(d)
};(function(){if(LI.BalloonCalloutManager!==undefined){return
}LI.define("BalloonCalloutManager");
LI.BalloonCalloutManager=(function(){var f=500,p=f,d=100,u="callout-overlay",y="callout-",n='<span class="callout-arrow"></span>',h={},j={zIndex:10,constraintoviewport:true},v=null,A=false,i=null,l=null,m=null,c=false,s={},g=new YAHOO.util.KeyListener(document,{keys:27},{fn:function(){if(i){i.close(null)
}}});
var b=function(C,B){h[C]=B
};
var x=function(B){delete h[B]
};
var q=function(){A=true
};
var r=function(){A=false;
k()
};
var w=function(J){var G=J.config,I,D;
if(m){window.clearTimeout(m);
m=null;
i=null;
YDom.removeClass(l,"shown")
}if(i){i.close()
}i=J;
if(G.relativeToTrigger===true){v.cfg.setProperty("constraintoviewport",false)
}if(G.zIndex!==null&&G.zIndex!==undefined){v.cfg.setProperty("zIndex",G.zIndex)
}f=G.persist?d:p;
YDom.setStyle(l,"width",G.width);
l.className=[G.type," ",y,G.orientation," ",G.id].join("");
if(!G.cacheCalloutContent&&G.id){v.setBody(document.getElementById(G.id).innerHTML+n)
}else{v.setBody(G.content+n)
}v.render(document.body);
v.cfg.setProperty("context",[J.el,G.overlayCorner,G.contextCorner]);
l.dimensions=o(l);
J.el.dimensions=o(J.el);
I=G.orientation.split("-");
D=s[I[0]](J.el,l,I);
D.dx+=G.offsetX;
D.dy+=G.offsetY;
YDom.setXY(l,[l.dimensions.x+D.dx,l.dimensions.y+D.dy]);
if(YAHOO.env.ua.ie===6){v.moveTo([l.dimensions.x+D.dx,l.dimensions.y+D.dy])
}YDom.addClass(l,"shown");
if(G.eventsOnInternalElements){var C=G.eventsOnInternalElements;
if(C.elementClass&&C.elementClass!==""){var F=YDom.getElementsByClassName(C.elementClass),H=F.length;
for(var E=0,B;
E<H;
E++){B=F[E];
YEvent.purgeElement(B,false,C.elementEvent);
YEvent.on(B,C.elementEvent,J[C.elementAction],J,true)
}}c=true
}if(G.persist){g.enable()
}};
s={top:function(H,C,B,E){var I=H.dimensions||o(H),G=C.dimensions||o(C),D,F;
E=E||{};
if(B[0]==="top"){E.dx=I.x+0.5*I.width-(G.x+0.5*G.width);
E.dy=I.y+I.height-G.y;
if(B[1]){this[B[1]](H,C,B,E)
}}else{D=Y$(".callout-arrow",C,true);
F=o(D);
F.height=F.height||0;
E.dy+=(0.5*G.height-0.5*F.height)
}return E
},right:function(H,C,B,E){var I=H.dimensions||o(H),G=C.dimensions||o(C),D,F;
E=E||{};
if(B[0]==="right"){E.dx=I.x-(G.x+G.width);
E.dy=I.y+0.5*I.height-(G.y+0.5*G.height);
if(B[1]){this[B[1]](H,C,B,E)
}}else{D=Y$(".callout-arrow",C,true);
F=o(D);
F.width=F.width||0;
E.dx+=(-0.5*G.width+0.5*F.width)
}return E
},bottom:function(H,C,B,E){var I=H.dimensions||o(H),G=C.dimensions||o(C),D,F;
E=E||{};
if(B[0]==="bottom"){E.dx=I.x+0.5*I.width-(G.x+0.5*G.width);
E.dy=I.y-(G.y+G.height);
if(B[1]){this[B[1]](H,C,B,E)
}}else{D=Y$(".callout-arrow",C,true);
F=o(D);
F.height=F.height||0;
E.dy+=(-0.5*G.height+0.5*F.height)
}return E
},left:function(H,C,B,E){var I=H.dimensions||o(H),G=C.dimensions||o(C),D,F;
E=E||{};
if(B[0]==="left"){E.dx=I.x+I.width-G.x;
E.dy=I.y+0.5*I.height-(G.y+0.5*G.height);
if(B[1]){this[B[1]](H,C,B,E)
}}else{D=Y$(".callout-arrow",C,true);
F=o(D);
F.width=F.width||0;
E.dx+=(0.5*G.width-0.5*F.width)
}return E
}};
var o=function(D){var C=YDom.getXY(D),F,B,E;
if(!C||!C.length){return{}
}F=D.getBoundingClientRect();
E=parseInt(F.right-F.left,10);
B=parseInt(F.bottom-F.top,10);
return{height:B,width:E,x:C[0],y:C[1]}
};
var z=function(C){var B=i&&!i.isActive();
if((!A&&B)||C){v.setBody("");
i=null;
YDom.removeClass(l,"shown");
g.disable()
}};
var k=function(){if(!m){m=window.setTimeout(function(){window.clearTimeout(m);
m=null;
z(false)
},LI.BALLOON_CALLOUT_HIDE_DELAY||f)
}};
var t=function(){z(true)
};
var e=function(){v=new YAHOO.widget.Overlay(u,j);
v.render(document.body);
l=YDom.get(u);
YEvent.on(l,"mouseover",q);
YEvent.on(l,"mouseout",r);
if(LI.Events&&typeof LI.Events.trigger==="function"){LI.Events.trigger("LI.BalloonCalloutManager:initialized")
}};
var a=function(){return i
};
YEvent.onDOMReady(function(){if(YAHOO&&YAHOO.widget&&YAHOO.widget.Overlay){e()
}else{var B;
if(!(LI&&LI.UrlPackage&&LI.UrlPackage.containerCore)){throw new Error("The package url for container-core does not exist.")
}B=LI.UrlPackage.containerCore;
YAHOO.util.Get.script(B,{onSuccess:e,onFailure:function(){throw new Error("Failed to load dependency: "+B)
}})
}});
return{register:b,destroy:x,overlay:v,show:w,hide:k,showing:a,forceClose:t}
})()
})();
LI.define("BalloonCallout");
LI.BalloonCallout=function(c,r){var p=LI.BalloonCalloutManager,b=null,f=350,d="hover",a=YDom.get("callout-overlay")||null,m={"left":["tl","tr",5,0],"right":["tr","tl",-5,0],"top":["tl","tl",0,5],"bottom":["bl","tl",0,-5],"top-left":["tl","bl",0,5],"top-right":["tr","br",0,5],"right-top":["tr","tl",-5,0],"right-bottom":["br","bl",-5,0],"bottom-right":["br","tr",0,-5],"bottom-left":["bl","tl",0,-5],"left-bottom":["bl","br",5,0],"left-top":["tl","tr",5,0]},n,k,h,g;
r=r||{};
if(c.tagName&&c.tagName.toLowerCase()==="a"&&c.href.indexOf("#")>-1){r.anchor=true;
r.id=c.href.substring(c.href.indexOf("#")+1)
}else{r.anchor=false
}r={anchor:r.anchor,width:r.width||300,id:r.id||"",overlayCorner:r.overlayCorner||null,contextCorner:r.contextCorner||null,orientation:r.orientation||"left-top",content:r.content||null,events:r.events||["mouseover","mouseout"],eventsOnInternalElements:r.eventsOnInternalElements||null,type:r.type||"balloon-callout",offsetX:r.offsetX||0,offsetY:r.offsetY||0,relativeToTrigger:r.relativeToTrigger||false,zIndex:r.zIndex,persist:r.persist||false,delayOpen:r.delayOpen||false,cacheCalloutContent:r.cacheCalloutContent!==undefined?r.cacheCalloutContent:true,toolTipTextAttr:r.toolTipTextAttr||null,openCallback:r.openCallback||null,closeCallback:r.closeCallback||null};
var o=function(s){YEvent.preventDefault(s);
if(r.persist){YEvent.stopPropagation(s)
}};
var q=function(s){this.persist=true;
if(YAHOO.util.Dom.hasClass(s.target,"callout-close")){j()
}};
var e=function(s){var t=false;
if(s.button){t=(s.button===2);
this.persist=t?true:false
}if(!this.persist){j.call(this,s)
}else{this.persist=false
}};
var i=function(){var t=this;
this.active=true;
YDom.addClass(c,d);
if(g){n=c.title;
c.title=""
}function s(){p.show(t);
t.openEvent.fire();
if(!a){a=YDom.get("callout-overlay")
}if(r.persist){YEvent.on(a,"click",q,t,true);
YEvent.on(document,"click",e,t,true);
var u=YDom.getElementsByClassName("callout-close",null,a);
if(u.length>0){u[0].focus()
}}else{YEvent.removeListener(a,"click",q);
YEvent.removeListener(document,"click",e)
}if(r.openCallback&&typeof(r.openCallback)==="function"){r.openCallback(t)
}}if(r.delayOpen&&!b){b=window.setTimeout(function(){b=null;
s()
},f)
}else{s()
}};
var j=function(s){var t=this;
this.active=false;
this.persist=false;
YDom.removeClass(c,d);
if(g){c.title=n
}if(r.delayOpen&&b){window.clearTimeout(b);
b=null
}if(s){p.hide()
}else{p.forceClose()
}if(r.persist){YEvent.removeListener(a,"click",q);
YEvent.removeListener(document,"click",e);
if(c){c.focus()
}}if(r.closeCallback&&typeof(r.closeCallback)==="function"){r.closeCallback(t)
}};
var l=function(s){this.active=!this.active;
if(this.active||this!==p.showing()){i.call(this,s)
}else{if(!r.persist||(r.events[0]!=="mouseover")){j.call(this,s)
}else{this.active=true
}}};
this.isActive=function(){return this.active
};
this.destroy=function(){if(r.anchor){YEvent.removeListener(c,"click",o)
}if(r.persist){YEvent.removeListener(c,r.events[0],l)
}else{YEvent.removeListener(c,r.events[0],i);
YEvent.removeListener(c,r.events[1],j)
}if(r.eventsOnInternalElements){var w=r.eventsOnInternalElements;
if(w.elementClass&&w.elementClass!==""){var t=YDom.getElementsByClassName(w.elementClass),v=t.length;
for(var u=0,s;
u<v;
u++){s=t[u];
YEvent.removeListener(s,w.elementEvent,w.elementAction)
}}}j();
p.destroy(c.id)
};
this.setContent=function(s){if(!s){s=document.getElementById(r.id).innerHTML
}r.content=s
};
if(!r.content){r.content=document.getElementById(r.id);
if(!r.content){throw"Could not find info element"
}else{k=r.content.innerHTML;
if(r.toolTipTextAttr){n=c.getAttribute(r.toolTipTextAttr);
k=k.replace("__PLACEHOLDER__",LI.htmlEncode(n))
}r.content=k
}}if(r.width!=="auto"){r.width+="px"
}if(r.anchor){YEvent.on(c,"click",o)
}if(!r.overlayCorner){r.overlayCorner=m[r.orientation][0]
}if(!r.contextCorner){r.contextCorner=m[r.orientation][1]
}r.offsetX+=m[r.orientation][2];
r.offsetY+=m[r.orientation][3];
this.openEvent=new YAHOO.util.CustomEvent("open");
YDom.generateId(c,"callout-trigger-");
g=(r.toolTipTextAttr==="title");
this.config=r;
this.el=c;
this.active=false;
this.close=j;
this.open=i;
this.toggle=l;
this.persist=false;
p.register(c.id,this);
if(r.persist){YEvent.on(c,r.events[0],l,this,true)
}else{YEvent.on(c,r.events[0],i,this,true);
YEvent.on(c,r.events[1],j,this,true)
}};
LI.Controls.register("LI.BalloonCallout");
LI.define("BalloonCalloutDelegator");
LI.BalloonCalloutDelegator=function(c,a){var b={};
a=a||{};
a.dataId=a.dataId?("data"+a.dataId):"data-li-tooltip-id";
function d(g,e){if(e&&!b[e.id]){a.id=g;
var f=new LI.BalloonCallout(e,a);
f.toggle();
b[e.id]=true
}}YEvent.on(c,"mouseover",function(e){var f=YEvent.getTarget(e),g=YDom.getAttribute(f,a.dataId);
if(!g&&YDom.getAttribute(f.parentNode,a.dataId)){f=f.parentNode;
g=YDom.getAttribute(f,a.dataId)
}if(g){YDom.generateId(f);
d(g,f);
YEvent.stopPropagation(e)
}})
};LI.RequestQueue={requests:[],activeRequest:null,dequeue:function(){return this.requests.shift()
},enqueue:function(b){if(!this.activeRequest||!YAHOO.util.Connect.isCallInProgress(this.activeRequest)){YAHOO.util.Connect.setForm(b.form);
this.activeRequest=LI.asyncRequest(b.method,b.url,b.callback,b.postData);
var a=window.setInterval(function(){if(!YAHOO.util.Connect.isCallInProgress(LI.RequestQueue.activeRequest)){var c=LI.RequestQueue.dequeue();
if(!c){LI.RequestQueue.activeRequest=null;
window.clearInterval(a)
}else{LI.RequestQueue.activeRequest=LI.asyncRequest(c.method,c.url,c.callback,c.postData)
}}},10)
}else{this.requests.push(b)
}return true
}};
YAHOO.register("LI.RequestQueue",LI.RequestQueue,{});(function(i){var e=i.requires("jquery"),k=i.requires("underscore"),b=i.requires("dust"),h=i.imports("Controls")||{},c=i.requires("BaseControl"),l=i.requires("i18n"),j=i.imports("Controls.parseFragment")||function(){},f=i.imports("environment"),d=null;
var g=function(m){if(d&&typeof d==="function"){d()
}d=m
};
var a=c.extend(function(q){var o={width:500,top:150,xOffset:0,yOffset:0,errorMessage:"We're sorry. Something unexpected happened and your request could not be completed. Please try again.",closeText:"Close",startText:"Dialog start",endText:"Dialog end",customClassName:undefined,dialogTemplate:"tl/shared/dialog",dialogCss:(f&&f.consumer2)?["css!scss/modules/dialog/dialog_standalone"]:["css!scss/modules/dialog_v3"],cssDependencies:null,templateDataUrl:null,centerVertically:false,fitDialogBoxToWindow:true},p="click",t="keyup",m="resize",n="dialog-body",s=50;
function r(){var w=[{key:"errorMessage",value:"dialogbox_error_generic"},{key:"closeText",value:"dialogbox_close"},{key:"startText",value:"dialogbox_start"},{key:"endText",value:"dialogbox_end"}],u=w.length,x=0,v={},y="";
for(;
x<u;
x++){y=l.get(w[x].value);
if(y){v[w[x].key]=y
}}return v
}return{beforeDecoration:function(){this._$dialog=undefined;
this._config=k.defaults(this._config,r(),o);
this._requiredTemplates=[this._config.dialogTemplate];
this._requiredCSS=k.flatten(k.compact([this._config.dialogCss,this._config.cssDependencies]));
this._href=this._config.templateDataUrl||this._$el.data("href")||this._$el.attr("href")
},attachEventListeners:function(){this._$el.on(p,k.bind(this._eventOpen,this))
},detachEventListeners:function(){this._$el.off(p)
},onResolve:function(u){this.open()
},_eventOpen:function(u){u.preventDefault();
this.open()
},_eventClose:function(u){u.preventDefault();
this.close()
},_keyupHandler:function(u){if(u.which===27){this._eventClose(u)
}},_resizeHandler:k.throttle(function(u){if(this._$dialog&&this._$dialog.length){this._$dialog.css(this._getPosition());
this._fitToWindow()
}},500),_attachEventListeners:function(){this._$dialog.on(p,".dialog-close",this._eventClose);
e(document).on(t,this._keyupHandler);
e(window).on(m,this._resizeHandler)
},open:function(){if(!this._opened){this._opened=true;
return e.when(this.loadDependencies(this._requiredTemplates),this.loadCss(this._requiredCSS)).then(g(k.bind(this.close,this))).then(k.bind(this._render,this)).then(k.bind(this.setFocusToDialog,this)).fail(k.bind(this.close,this))
}},close:function(){if(this._$dialog){this._$dialog.remove()
}this._rendered=false;
e(document).off(t,this._keyupHandler);
e(window).off(m,this._resizeHandler);
if(this._opened){this._opened=false;
this._$el.focus()
}},destroy:function(){this.close();
this.detachEventListeners();
q.destroy.apply(this,arguments)
},setFocusToDialog:function(){this._$dialog.attr("tabindex",-1);
this._$dialog.focus()
},_loadContent:function(){var v=e(this._href),u=v.html(),w=new e.Deferred();
if(v[0]||!this._href){w.resolve(u)
}else{w.reject()
}return w.promise()
},_buildMarkup:function(){return this._renderDialogMarkup().then(this._renderMarkUpSuccess,this._renderMarkUpFailure)
},_renderMarkUpSuccess:function(u){this._$dialog=e(u).prop("id","modeless-dialog");
if(this._config.customClassName){this._$dialog.addClass(this._config.customClassName)
}e("body").append(this._$dialog);
this._$dialog.css(this._getPosition());
this._rendered=true
},_renderMarkUpFailure:function(){throw new Error("Unable to render dialog markup")
},_loadContentSuccess:function(u){this.setDialogBodyContent(u)
},_loadContentFail:function(){this.setDialogBodyContent(this._config.errorMessage)
},setDialogBodyContent:function(u){this._$dialog.find("."+n).html(u);
j(this._$dialog);
this._$dialog.css(this._getPosition());
this._fitToWindow()
},_render:function(){return this._buildMarkup().then(this._loadContent).then(this._loadContentSuccess,this._loadContentFail).always(this._attachEventListeners)
},_renderDialogMarkup:function(){var v=new e.Deferred();
b.render(this._config.dialogTemplate,this._config,function u(x,w){if(x){v.reject(x)
}else{v.resolve(w)
}});
return v.promise()
},_getPosition:function(){var w=e(window),u=this._config.top,v=((w.innerWidth()/2)-(this._config.width/2))+this._config.xOffset;
if(this._config.centerVertically){u=((w.innerHeight()/2)-(this._$dialog.outerHeight()/2))+this._config.yOffset;
u=Math.max(u,this._config.top)
}return{left:v,top:u}
},_fitToWindow:function(){var u=e(window).innerHeight()-this._config.top-s,w=this._$dialog.find(".dialog-title").outerHeight(),v;
v=this._$dialog.clone().css("visibility","hidden");
v.find(".dialog-body").height("auto");
e("body").append(v);
if(v.height()>u&&this._config.fitDialogBoxToWindow){this._$dialog.find(".dialog-body").height(u-w)
}else{this._$dialog.find(".dialog-body").height("auto")
}v.remove()
}}
});
i.exports("DialogBox",a)
}(window.LIModules));
(function(f){var e=f.requires("jquery"),b=f.requires("underscore"),c=f.requires("dust"),a=f.requires("DialogBox");
var d=a.extend(function(k){var i={maskTemplate:"tl/shared/dialog_mask",fitToWindow:true,closeOnMaskClick:true},j="click",l="keyup",g="resize",h="focusin";
return{beforeDecoration:function(){k.beforeDecoration.call(this);
this._config=b.defaults(this._config,i);
this._requiredTemplates=[this._config.maskTemplate,this._config.dialogTemplate];
this._requiredCSS=b.flatten(b.compact([this._config.dialogCss,this._config.cssDependencies]));
this._$mask=undefined;
this._initialHtmlOverflowValue=undefined;
if(!this._config.fitToWindow){this._fitToWindow=function(){}
}},_maskClickHandler:function(m){if(e(m.target).is("#dialog-mask")){this._eventClose(m)
}},_attachEventListeners:function(){k._attachEventListeners.call(this);
if(this._config.closeOnMaskClick){this._$mask.on(j,this._maskClickHandler)
}e(document).on(h,this._trapFocus)
},close:function(){if(this._$mask){this._$mask.remove()
}e(document).off(l,this._keyupHandler);
e(window).off(g,this._resizeHandler);
e("html").css({overflow:this._initialHtmlOverflowValue});
this._rendered=false;
if(this._opened){this._opened=false;
this._$el.focus()
}},_buildMarkup:function(){return e.when(this._renderMaskMarkup(),this._renderDialogMarkup()).then(this._renderMarkUpSuccess,this._renderMarkUpFailure)
},_renderMarkUpSuccess:function(n,m){this._$mask=e(n);
this._$dialog=e(m);
this._$mask.append(this._$dialog);
if(!this._config.fitToWindow){this._$mask.css({"overflow-y":"auto"})
}e("body").append(this._$mask);
this._$dialog.css(this._getPosition());
this._rendered=true
},_render:function(){this._initialHtmlOverflowValue=e("html").css("overflow");
e("html").css({overflow:"hidden"});
return this._buildMarkup().then(this._loadContent).then(this._loadContentSuccess,this._loadContentFail).always(this._attachEventListeners)
},_renderMaskMarkup:function(){var n=new e.Deferred();
c.render(this._config.maskTemplate,this._config,function m(p,o){if(p){n.reject(p)
}else{n.resolve(o)
}});
return n.promise()
},_trapFocus:function(m){m.stopPropagation();
if(this._opened){if(this._$dialog.is(e(m.target))||this._$dialog.has(e(m.target)).length>0){return false
}else{this._$dialog.focus()
}}}}
});
f.exports("ModalDialogBox",d)
}(window.LIModules));